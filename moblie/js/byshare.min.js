 var AjaxFunUtils = function(){ var ajaxInit = function(options){ var settings = { url: '', type: "post", dataType: 'json', params: {ajax:1}, yzlogin:false, isloading:false, callback: function(){}, errCallback: function(){} }; if(options){ $.extend(true,settings,options); }; if(settings.yzlogin){ var loginflag = BaseInitClass.loginCheck(); if(!loginflag){ return false; } }; if(settings.isloading == true){ Loading.loadInit({status:1}); } $.ajax({ url:settings.url, type:settings.type, dataType: settings.dataType, data: settings.params , success: function(result) { if(settings.isloading == true){ Loading.loadInit({status:0}); } if(result.status == 900){ $(".loadingMask").remove(); AlertUtils.tips({ htmlmsg:'<div style="padding:30px">'+lang.js_base_login_tip+'</div>', callback:function(){ $(".btnTipsubmit").find(".buttonText").text(lang.js_base_login_btn); }, scallback:function(){ var loginhref = window.location.href; window.location.href = '/index/reg.html?loginurl='+loginhref+''; } }); return false; }else{ if(options.callback){ settings.callback(result) } } }, error: function(msg) { Loading.loadInit({status:0}); if (options.errCallback) { settings.errCallback(msg) }else{ AlertUtils.tips({ htmlmsg:'<div style="padding:30px">请求超时，请重试！</div>', type:0, scallback:function(){ window.location.reload(); } }); } } }); }; return {ajaxInit:ajaxInit}; }(); $.fn.loadDataUtils = function(options){ var container = this; var settings = { url:"", isPage:true, isOuto:false, isEmpty:true, isdz:false, resData:false, prev_text:lang.js_base_prev, next_text:lang.js_base_next, num_edge: 0, num_display: 3, prev_show:true, params: { 'page': 1, 'pagenum': 20}, loadCallback:function(){return 1}, getDataHtmlCallback:null, getNoDataHtmlCallback:null, callback:null }; if (options) { $.extend(settings, options); }; PageCallback(settings.params.page); function PageCallback(page_index){ if(settings.loadCallback() == 1){ var loadingHtml = '<div class="loading">Data loading...<div class="blank0"></div></div>'; container.append(loadingHtml); }else{ settings.loadCallback(); }; settings.params.page = page_index; if(settings.resData == false){ AjaxFunUtils.ajaxInit({ url: settings.url, params:settings.params, callback: loadDataCallBack, errCallback: settings.getNoDataHtmlCallback }); }else{ loadDataCallBack(settings.resData); }; }; function loadDataCallBack(result){ var mystatus = result.status; var totalCount = result.data.pagetotal; var logData = result.data.rows; var exrtitle = result.data.currency_exrtitle; var htmlStr=''; if(mystatus > 0 || !mystatus){ $.each(logData, function(index, o){ htmlStr += settings.getDataHtmlCallback(index,o,exrtitle); }); if(settings.isEmpty){ container.empty().append(htmlStr); }else{ container.append(htmlStr); if(settings.loadCallback == 1){ container.find(".loading").remove(); } }; if(totalCount > 1 && settings.isPage){ ShowPageing(settings.params.page,totalCount); }; if (options.callback) { settings.callback(); }; }else{ if(settings.loadCallback == 1){ container.find(".loading").remove(); }; }; }; function ShowPageing(index_page,oTotal){ if(settings.isPage && settings.isOuto){ var pagination = container.attr("id") + "_page"; var pageHtml = '<div class="blank0"></div><div class="pagination text-center" id="'+pagination+'"></div>'; if($("#" + pagination).size() <= 0){ container.after(pageHtml); }; var opagedivId = $('#' + pagination); opagedivId.empty(); }else if(settings.isPage && !settings.isdz){ var opagedivId = container.siblings('.pagination'); container.siblings('.pagination').empty().show(); }else{ var opagedivId = $('#pagination'); $('#pagination').empty().show(); }; if(opagedivId.html() == ''){ opagedivId.pagination(oTotal, { num_edge_entries: settings.num_edge, num_display_entries: settings.num_display, prev_show_always:settings.prev_show, current_page:index_page-1, prev_text:settings.prev_text, next_text:settings.next_text, callback: function (page_index, jq) { PageCallback(page_index+1); }, items_per_page: 1, link_to: 'javascript:void(0);' }); }; }; }; jQuery.fn.pagination = function(maxentries, opts){ opts = jQuery.extend({ items_per_page:10, num_display_entries:10, current_page:0, num_edge_entries:0, link_to:"#", prev_text:"Prev", next_text:"Next", ellipse_text:"...", prev_show_always:true, next_show_always:true, callback: function () { return false; }, IsFirst:true },opts||{}); return this.each(function() { function numPages() { return Math.ceil(maxentries/opts.items_per_page); }; function getInterval() { var ne_half = Math.ceil(opts.num_display_entries/2); var np = numPages(); var upper_limit = np-opts.num_display_entries; var start = current_page>ne_half?Math.max(Math.min(current_page-ne_half, upper_limit), 0):0; var end = current_page>ne_half?Math.min(current_page+ne_half, np):Math.min(opts.num_display_entries, np); return [start,end]; }; function pageSelected(page_id, evt){ current_page = page_id; drawLinks(); var continuePropagation = opts.callback(page_id, panel); if (!continuePropagation) { if (evt.stopPropagation) { evt.stopPropagation(); } else { evt.cancelBubble = true; } }; return continuePropagation; }; function drawLinks() { panel.empty(); var interval = getInterval(); var np = numPages(); var getClickHandler = function(page_id) { return function(evt){ return pageSelected(page_id,evt); } }; var appendItem = function(page_id, appendopts){ page_id = page_id<0?0:(page_id<np?page_id:np-1); appendopts = jQuery.extend({text:page_id+1, classes:"btn-border btn"}, appendopts||{}); if(page_id == current_page){ var lnk = jQuery("<span class='current'>"+(appendopts.text)+"</span>"); }else{ var lnk = jQuery("<a>"+(appendopts.text)+"</a>") .bind("click", getClickHandler(page_id)) .attr('href', opts.link_to.replace(/__id__/,page_id)); } if(appendopts.classes){lnk.addClass(appendopts.classes);} panel.append(lnk); }; if(opts.prev_text && (current_page > 0 && opts.prev_show_always)){ appendItem(current_page-1,{text:opts.prev_text, classes:'btn-border btn'}); }; if (interval[0] > 0 && opts.num_edge_entries > 0) { var end = Math.min(opts.num_edge_entries, interval[0]); for(var i=0; i<end; i++) { appendItem(i); } if(opts.num_edge_entries < interval[0] && opts.ellipse_text) { jQuery("<span>"+opts.ellipse_text+"</span>").appendTo(panel); } }; for(var i=interval[0]; i<interval[1]; i++) { appendItem(i); }; if (interval[1] < np && opts.num_edge_entries > 0) { if(np-opts.num_edge_entries > interval[1]&& opts.ellipse_text) { jQuery("<span>"+opts.ellipse_text+"</span>").appendTo(panel); } var begin = Math.max(np-opts.num_edge_entries, interval[1]); for(var i=begin; i<np; i++) { appendItem(i); } }; if(opts.next_text && (current_page < np-1 || opts.next_show_always)){ appendItem(current_page+1,{text:opts.next_text, classes:'btn-border btn'}); }; }; var current_page = opts.current_page; maxentries = (!maxentries || maxentries < 0)?1:maxentries; opts.items_per_page = (!opts.items_per_page || opts.items_per_page < 0)?1:opts.items_per_page; var panel = jQuery(this); this.selectPage = function(page_id){ pageSelected(page_id);}; this.prevPage = function(){ if (current_page > 0) { pageSelected(current_page - 1); return true; } else { return false; } }; this.nextPage = function(){ if(current_page < numPages()-1) { pageSelected(current_page+1); return true; } else { return false; } }; drawLinks(); if (!opts.IsFirst) { opts.IsFirst = false; opts.callback(current_page, this); }; }); }; var AlertUtils = function(){ var tips = function(options){ var settings = { htmlmsg:'', title:lang.js_base_tip, type:1, istop:false, position:"fixed", isShade:true, touchmove:0, callback:function(){}, scallback:function(){}, dcallback:function(){}, closeback:function(){}, w:"96%" }; if(options){ $.extend(settings,options); }; var tipHtml ='<div class="tipbox-in" data-index="0">'+ '<h1 class="tiptop">'+lang.js_base_tip+'</h1>'+ '<span class="ico02 tipclose closeBtn"></span>'+ '<form class="tipForm"><div class="tipcont">'+ '<div class="contbox">sdfdsfdsf</div>'+ '</div>'+ '<div id="tipbottom" class="tipbottom">'+ '<div class="fr formFooterButtons">'+ '<button class="btn-border btn rounded mr-5 btnCancel closeBtn" type="button">'+ '<span class="buttonText">'+lang.js_base_cancel+'</span>'+ '</button>'+ '<button type="button" class="btn btn-danger btnTipsubmit">'+ '<span class="buttonText">'+lang.js_base_confirm+'</span>'+ '</button>'+ '</div>'+ '<div class="blank0"></div>'+ '</div></form>'+ '</div>'; var tipDiv = document.createElement('div'); var num = $(".modalMask").size(); var myTipId = "tipbox_" + num; tipDiv.id = myTipId; tipDiv.className = "tipbox fade"; $("body").append(tipDiv); $("#" + myTipId).attr("data-index",num); $("#" + myTipId).append(tipHtml); $("#" + myTipId).find(".tiptop").html(settings.title); $("#" + myTipId).find(".tipcont").html(settings.htmlmsg); $("#" + myTipId).css("width", settings.w); if(settings.type == 0){ $("#" + myTipId).find(".btnCancel").remove(); }; if(options.callback){ settings.callback(); }; currentPosition({divId:myTipId,num:num,shade:settings.isShade,position:settings.position,istop:settings.istop,touchmove:settings.touchmove}); $("#" + myTipId).find(".closeBtn").unbind("click").bind("click",function(){ var numIndex = $(this).parents(".tipbox").attr("data-index"); var myIndeTipDiv = $(this).parents(".tipbox"); tipsClosed(myIndeTipDiv,numIndex); if(options.closeback){ settings.closeback(); }; }); $("#" + myTipId).find(".btnTipsubmit").unbind("click").bind("click",function(){ var numIndex = $(this).parents(".tipbox").attr("data-index"); var myIndeTipDiv = $(this).parents(".tipbox"); if(options.scallback){ settings.scallback(); }; tipsClosed(myIndeTipDiv,numIndex); if(options.dcallback){ settings.dcallback(); }; }); }; var newcurrentPosition = function(opt) { var mypos = opt.position; var len = $(".modalMask").size() *90 + 9999; var shodenum = opt.num; if(opt.shade){ addShade({num:shodenum,touchmove:opt.touchmove}); }; var _top = -($("#" + opt.divId).height()/2); var _left = -$("#" + opt.divId).width()/2; $("#" + opt.divId).css({ "left": '50%', "top": '50%', "margin-left":_left, "margin-top":_top, "position":mypos, "z-index":len + 1 }).show().addClass("loaded"); if(opt.callback){ opt.callback(); }; }; var currentPosition = function(opt) { var mypos = opt.position; if(mypos == "absolute"){ var c_left = getPageOffset().x + ($("body").width() - $("#" + opt.divId).width()) / 2; var c_top = getPageOffset().y + (getHeightBody() - $("#" + opt.divId).height()) / 2; }else{ var c_left = ($("body").width() - $("#" + opt.divId).width()) / 2; var c_top = (getHeightBody() - $("#" + opt.divId).height()) / 2; }; var len = $(".modalMask").size() *90 + 9999; var shodenum = opt.num; if(opt.shade){ addShade({num:shodenum,touchmove:opt.touchmove}); }; if (c_top <= 0 && !opt.istop) { c_top = 20; }else if(opt.istop){ c_top = 0; }; if (c_left <= 0 && !opt.istop) { c_left = 20; }else if(opt.istop){ c_left = 0; }; if(opt.isbottom == true){ $("#" + opt.divId).css({ "z-index":len + 1 }).show(); }else{ $("#" + opt.divId).css({ "left": c_left, "top": c_top, "position":mypos, "z-index":len + 1 }).show().addClass("loaded"); } if(opt.callback){ opt.callback(); }; }; var centerDiv = function(options){ var settings = { divId:'', isShade:true, w:"96%", type:0, istop:false, isbottom:false, position:"absolute", p_new:0, touchmove:0, callback:function(){}, zcallback:function(){}, closeback:function(){} }; if(options){ $.extend(settings,options); }; var num = $(".modalMask").size(); $("#" + settings.divId).attr("data-index",num); $("#" + settings.divId).css({"width":settings.w}); if(options.callback){ settings.callback({num:num}); }; if(settings.p_new == 1){ newcurrentPosition({divId:settings.divId,num:num,shade:settings.isShade,position:settings.position,callback:settings.zcallback,istop:settings.istop,touchmove:settings.touchmove,isbottom:settings.isbottom}); }else{ currentPosition({divId:settings.divId,num:num,shade:settings.isShade,position:settings.position,callback:settings.zcallback,istop:settings.istop,touchmove:settings.touchmove,isbottom:settings.isbottom}); } $(".closeBtnHtml").unbind("click").bind("click",function(){ var mynumIndex = $(this).parents(".tipbox").attr("data-index"); var myIndeTipDiv = $(this).parents(".tipbox"); centerDivClosed({"indexTipDiv":myIndeTipDiv,"indexNum":mynumIndex,"type":settings.type}); var num = $("#bigcategorybox").attr("data-index"); AlertUtils.centerDivClosed({indexNum:num,indexTipDiv:$("#bigcategorybox"),type:1}); if(options.closeback){ settings.closeback(); } }); }; var tipsClosed = function(indeTipDiv,indexNum,callback){ var myIndeNum = indexNum; var myIndeTipDiv = indeTipDiv; myIndeTipDiv.remove(); $("#modalMask_" + myIndeNum).remove(); if(callback){ callback(); }; }; var centerDivClosed = function(options){ var settings = { indexNum:'', indexTipDiv:'', type:0, callback:function(){} }; if(options){ $.extend(settings,options); }; if(settings.type == 1){ settings.indexTipDiv.remove(); $("#modalMask_" + settings.indexNum).remove(); }else if(settings.type == 2){ settings.indexTipDiv.hide(); $("#modalMask_" + settings.indexNum).remove(); }else{ settings.indexTipDiv.hide(); $("#modalMask_" + settings.indexNum).hide(); }; if(options.callback){ settings.callback(); }; }; var addShade = function(opt){ var myIndex = opt.num; var len = opt.num *90 + 9998; var shadDiv = document.createElement('div'); shadDiv.id = "modalMask_" + myIndex; shadDiv.className = "modalMask"; $("body").append(shadDiv); $("#modalMask_" + myIndex).show().css({"z-index":len}); if(opt.touchmove == 1){ $('#modalMask_' + myIndex).bind("touchmove",function(e){ e.preventDefault(); }); } }; var getPageOffset = function() { var pageOffset = {}; if (window.innerWidth) { pageOffset.x = window.pageXOffset; pageOffset.y = window.pageYOffset; } else if (document.documentElement && document.documentElement.clientWidth) { pageOffset.x = document.documentElement.scrollLeft; pageOffset.y = document.documentElement.scrollTop; } else if (document.body.clientWidth) { pageOffset.x = document.body.scrollLeft; pageOffset.y = document.body.scrollTop; }; return pageOffset; }; return {tips:tips, centerDiv:centerDiv, tipsClosed:tipsClosed, centerDivClosed:centerDivClosed }; }(); var checkInputFun = { validatetype:0, myIt:{}, regulars: { "email": [/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/, lang.js_base_email], "password": [/^[\@A-Za-z0-9\!\#\$\%\^\&\*\.\~]{6,22}$/, lang.js_base_password], "mobile": [/^((134[0-8]{1})|(13[0,1,2,3,5,6,7,8,9]\d)|(15[0,1,2,3,5,6,7,8,9]\d)|(17[0|1|2|3|(5-9)]\d)|(18[0|1|2|3|(5-9)]\d)|(14[5,7]\d))\d{7}$/, lang.js_base_mb], "code": [/^[A-Za-z0-9]{4}$/, lang.js_base_code], "money" : [/^\d+(\.\d{1,2})?$/,lang.js_base_money], "moneyandempty" : [/^(?:(?!0)\d*|0|\s*)(?:\.\d+)?$/,lang.js_base_money], "num" : [/^(\d+){1,13}$/,''], "everyone": [/^(\w+)$/, lang.js_everyone], "mailmoblie":[/^(1[34578]\d{9})|(([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2}))$/, lang.js_base_mb] }, inputs:{ "isempty":{isempty: [0],focusMsg: '',rightMsg: "",errorMsg:'valid'}, "Email":{type: "email",focusMsg: '',rightMsg: ""}, "Pwd":{type: 'password',focusMsg: '',rightMsg: ""}, "Pwd1":{type: 'eq',focusMsg: '',rightMsg: "",errorMsg: "",eqto: 'Pwd'}, "Code":{type: "code",focusMsg: '',rightMsg: ""}, "Money":{type: "money",focusMsg: '',rightMsg: ""}, "moneyandempty":{type: "moneyandempty",focusMsg: '',rightMsg: ""}, "num":{type: "num",focusMsg: '',rightMsg: ""}, "Mobile":{type: "mobile",focusMsg: '',rightMsg: ""}, "mailmoblie":{type: "mailmoblie",focusMsg: '',rightMsg: ""} }, tipStatu: function (type, inp, msg) { if(inp.data("tip")){ if(checkInputFun.validatetype == 0){ inp.removeClass('right_validate error_validate').addClass(type + "_validate"); inp.parents(".validatebox").removeClass('right_validate error_validate').addClass(type + "_validate"); }else{ inp.data("tip").removeClass("focus_tip right_tip error_tip ajax_checking_tip").addClass(type + "_tip").html(msg ? msg : "").css({ "top": -2, "right":5 }); } } }, checkEq: function (set, inp, thiz) { if (set.type == "eq" && set.eqto) { if (inp.val() !== "" && (inp.val() == inp.parents("form").find("[data-validate='" + set.eqto + "']").val())) { checkInputFun.tipStatu("right", inp, set.rightMsg); return true; } else { checkInputFun.tipStatu("error", inp, set.errorMsg); return false; } } else { return true; } }, isempty: function (set, inp) { var vlen = inp.val().length; if (set.isempty) { if (vlen > 0) { checkInputFun.tipStatu("right", inp, set.rightMsg); return true; } else { checkInputFun.tipStatu("error", inp, set.errorMsg); return false; } } else { return true; } }, checkLength: function (set, inp) { var vlen = inp.val().length; if (set.length) { var len = set.length; if (vlen >= set.length[0] && vlen <= set.length[1]) { checkInputFun.tipStatu("right", inp, set.rightMsg); return true; } else { checkInputFun.tipStatu("error", inp, set.errorMsg); return false; } } else { return true; } }, checkBet: function (set, inp) { if (set.between) { var bet = set.between; if (inp.val() >= set.between[0] && inp.val() <= set.between[1]) { checkInputFun.tipStatu("right", inp, set.rightMsg); return true; } else { checkInputFun.tipStatu("error", inp, set.errorMsg); return false; } } else { return true; } }, checkReg: function (set, inp,callback,mycallback) { if (checkInputFun.regulars[set.type]) { if(set.type=='mailmoblie'){ var reg = checkInputFun.regulars['email']; }else{ var reg = checkInputFun.regulars[set.type]; } if (reg[0].test(inp.val())) { $(inp).removeClass("err_border"); checkInputFun.tipStatu("right", inp, set.rightMsg); if (mycallback) { mycallback(); } return true; } else { if(set.type=='mailmoblie'){ var reg = checkInputFun.regulars['mobile']; if (reg[0].test(inp.val())) { $(inp).removeClass("err_border"); checkInputFun.tipStatu("right", inp, set.rightMsg); if (mycallback) { mycallback(); } return true; } } $(inp).addClass("err_border"); checkInputFun.tipStatu("error", inp, reg[1]); return false; } } else { return true; } }, ajaxCheck: function (set, inp,callback) { if (set.ajaxCheck) { var ajaxCheck = set.ajaxCheck,result = false; for(var i in ajaxCheck.data){ ajaxCheck.data[i] = $("#" + i).val(); } $.ajax({ url: ajaxCheck.url, type: "post", dataType: 'json', timeout:5000, async:false, data: ajaxCheck.data, success: function (d) { if (d.status == 1) { if (callback) { callback(); } checkInputFun.tipStatu("right", inp, d.Msg); result = true; } else if (d.State == 0) { checkInputFun.tipStatu("error", inp, d.Msg); result = false; }else { result = false; } }, error: function () { checkInputFun.tipStatu("error", inp, "Network Error"); result = false; } }); return result; } else { return true; } }, initContext: function (inp, it) { if (!inp.data("tip") && inp.attr("data-validate") && it[inp.attr("data-validate")]) { var tip = $("<p class='input_tip'></p>"); inp.data("tip", tip).data("set", it[inp.attr("data-validate")]); inp.after(tip); } }, mycheckIn: function (inp, form, callback, mycallback) { if (inp.data("tip")) { var set = inp.data("set"); return (checkInputFun.checkReg(set, inp, callback, mycallback) && checkInputFun.checkEq(set, inp, form) && checkInputFun.checkBet(set, inp) && checkInputFun.checkLength(set, inp) && checkInputFun.ajaxCheck(set, inp, callback)&& checkInputFun.isempty(set, inp)); } else { return true; } }, smycheckIn: function (inp, form, callback, mycallback) { if (inp.data("tip")) { var set = inp.data("set"); return (checkInputFun.checkReg(set, inp, callback, mycallback) && checkInputFun.checkEq(set, inp, form) && checkInputFun.checkBet(set, inp) && checkInputFun.checkLength(set, inp)&& checkInputFun.isempty(set, inp)); } else { return true; } } }; $.fn.checkInput = function (settings) { if (!settings.inputs) { settings.inputs = checkInputFun.inputs; }; var dfs = { validatetype:0, inputs: {}, regulars: {}, button: "", buttonDiv: "", onButtonClick: $.noop, beforeSubmit: $.noop, submitBtnFn: $.noop, mycallback: $.noop, checkAll: $.noop }; var sets = $.extend(true, dfs, settings); checkInputFun.inputs = $.extend(true, checkInputFun.inputs, sets.inputs); var it = checkInputFun.inputs; checkInputFun.validatetype = sets.validatetype; checkInputFun.myIt = it ; checkInputFun.regulars = $.extend(true, checkInputFun.regulars, sets.regulars); var thiz = $(this); this.undelegate("input,textarea,select", "blur").delegate("input,textarea,select", "blur", function () { var isCallback = $(this).attr('data-callback'); var myismust = $(this).attr('data-ismust'); var myVal = $(this).val(); if(!myismust || myVal!=''){ if (isCallback == 1) { checkInputFun.mycheckIn($(this), thiz,'',sets.mycallback); }else{ checkInputFun.mycheckIn($(this), thiz); } }else{ $(this).data("tip").hide(); } checkInputFun.inputs; }); this.undelegate("input,textarea,select", "focus").delegate("input,textarea,select", "focus", function () { checkInputFun.initContext($(this), it); $(this).siblings(".input_tip").show(); var set = $(this).data("set"); if ($(this).data("tip") && set.focusMsg) { checkInputFun.tipStatu("focus", $(this), set.focusMsg); } }); this.submit(function (e) { var result = true; var form = $(e.target); $.each(form.find("input,textarea,select"), function (i, n) { var myismust = $(this).attr('data-ismust'); var myVal = $(this).val(); if(!myismust || myVal!=''){ checkInputFun.initContext($(n), it); $(n).siblings(".input_tip").show(); result = (checkInputFun.smycheckIn($(n), thiz) && result); } }); if (result) { e.preventDefault(); sets.submitBtnFn(thiz); return false; } else { e.preventDefault(); sets.beforeSubmit(e, result, form); return false; } }); if (sets.button) { this.find(sets.button).unbind("click").bind("click", function (e) { var $mythis = $(this); var result = true; var form = $(e.target); $.each(thiz.find("input,textarea,select"), function (i, n) { var myismust = $(this).attr('data-ismust'); var myVal = $(this).val(); if(!myismust || myVal!=''){ checkInputFun.initContext($(n), it); $(n).siblings(".input_tip").show(); result = (checkInputFun.smycheckIn($(n), thiz) && result); }; }); if (result) { e.preventDefault(); sets.submitBtnFn(thiz,$mythis); return false; } else { e.preventDefault(); sets.beforeSubmit(e, result, form); return false; }; }); }; if (sets.buttonDiv) { $("body").delegate(sets.buttonDiv, "click", function (e) { var result = true; var form = $(e.target); $.each(thiz.find("input,textarea,select"), function (i, n) { var myismust = $(this).attr('data-ismust'); var myVal = $(this).val(); if(!myismust || myVal!=''){ checkInputFun.initContext($(n), it); $(n).siblings(".input_tip").show(); result = (checkInputFun.smycheckIn($(n), thiz) && result); }; }); if (result) { e.preventDefault(); sets.submitBtnFn(thiz); return false; } else { e.preventDefault(); sets.beforeSubmit(e, result, form); return false; }; }); }; return this; }; $.fn.selectUtils = function(options){ var settings = { id: '', deNum:0, isDef:false, callback: null }; if (options) { $.extend(settings, options); } var tag_select = this; var div_show = tag_select.find('.select_option'); var ul_option = div_show.find('ul'); var select_showbox = tag_select.find('.select_showbox'); var select_analog = tag_select.find('.select_analog'); var li_option = ul_option.find('li'); var thisW = tag_select.width(); div_show.css({"width":thisW-20}); if(settings.isDef == true){ var li_def = ul_option.find("li:eq("+settings.deNum+")"); var val_def = li_def.text(); var index_def=li_def.attr('data-value')?li_def.attr('data-value'):li_def.val(); li_def.addClass("active"); select_showbox.find('span').text(val_def).addClass("active"); select_showbox.find('span').siblings('em').addClass("active"); tag_select.find('.select_showbox .select_analog').val(index_def); }; var toggleFun = function(){ select_showbox.toggle(function(){ $(this).css({"z-index":99}); div_show.show().css({"z-index":99}); },function(){ $(this).css({"z-index":0}); div_show.hide().css({"z-index":0}); }); }; toggleFun(); $(document).bind('click',function(e){ var target = $(e.target); if(target.closest(tag_select).length == 0){ div_show.hide(); toggleFun(); }; }); li_option.on('click',function(){ $(this).addClass('active').siblings().removeClass('active'); var value=$(this).text(); var value_val=$(this).attr('data-value')?$(this).attr('data-value'):$(this).val(); select_showbox.attr('data-value',value_val); select_showbox.find('span').text(value).addClass("active"); select_showbox.find('span').siblings('em').addClass("active"); tag_select.find('.select_showbox .select_analog').val(value_val); div_show.hide(); toggleFun(); if(settings.callback){ settings.callback(value,value_val); }; }); li_option.hover(function(){ $(this).addClass('hover').siblings().removeClass('hover'); },function(){ $(this).removeClass('hover'); }); }; (function(){ $.fn.timeShow = function(options){ var $this = this; var $thisShow = $this.find(".item-tag"); var settings = { loadTime:3000, waitTime:5000, callback:function(){} }; var startTime = null; var flag = false; var stopflag = false; if(options){ $.extend(settings,options); }; var startInit = function(){ stopTime(); startShow(); $this.toggle(function(){ $thisShow.addClass("loaded"); stopflag = true; },function(){ $thisShow.removeClass("loaded"); stopflag = false; }); }; var startShow = function(){ if(!stopflag){ if(flag == false){ flag = true; $thisShow.addClass("loaded"); }else{ $thisShow.removeClass("loaded"); flag = false; } }; startTime = setTimeout(startShow,settings.loadTime); }; var stopTime = function(){ clearInterval(startTime); }; startInit(); }; })(); $.fn.countdownUtils = function(options){ var container = this; var settings = { timers:60, callback:function(){}, beforecall:function(){}, type:0 }; var timerHtml = '<span class="day_show">00 天 </span><span class="hour_show">00 时 </span><span class="minute_show">00 分 </span><span class="second_show">00 秒 </span>'; if(options){ $.extend(settings,options); }; var intDiff = parseInt(settings.timers); var fday=0, fhour=0, fminute=0, fsecond=0; $(container).html(timerHtml); if(options.beforecall){ settings.beforecall(); } switch(settings.type){ case 1: container.find('.second_show').hide(); break; case 2: container.find('.second_show').hide(); container.find('.minute_show').hide(); break; case 3: container.find('.second_show').hide(); container.find('.minute_show').hide(); container.find('.hour_show').hide(); break; case 4: container.find('.day_show').hide(); container.find('.minute_show').hide(); container.find('.hour_show').hide(); default: break; } function timerInt(){ var day=0, hour=0, minute=0, second=0; if(intDiff > 0){ day = Math.floor(intDiff / (60 * 60 * 24)); hour = Math.floor(intDiff / (60 * 60)) - (day * 24); minute = Math.floor(intDiff / 60) - (day * 24 * 60) - (hour * 60); second = Math.floor(intDiff) - (day * 24 * 60 * 60) - (hour * 60 * 60) - (minute * 60); }else{ window.clearInterval(int); if(options.callback){ settings.callback(container); } }; if (minute <= 9) minute = '0' + minute; if (second <= 9) second = '0' + second; container.find('.day_show').html(day+" 天 "); container.find('.hour_show').html(hour+' 时 '); container.find('.minute_show').html(minute+' 分 '); container.find('.second_show').html(second+' 秒 '); intDiff--; }; var int=window.setInterval(timerInt,1000); }; (function(){ $.fn.fixedTop = function(options){ var $this = this; var settings = { isdiv:false, showDiv:"", topHeight:20, maxHeight:999999, scallback:function(){}, ecallback:function(){} }; if(options){ $.extend(settings,options); }; if(options.showDiv){ var $thisDiv = settings.showDiv; settings.maxHeight = $thisDiv.height(); } var fixedTop = function(){ if(settings.isdiv){ nvnexttop = $this.offset().top-document.body.scrollTop; var dofixed = nvnexttop <= settings.topHeight; }else{ var nvnexttop = document.body.scrollTop-settings.topHeight || document.documentElement.scrollTop-settings.topHeight; var dofixed = nvnexttop >= settings.topHeight && nvnexttop <= settings.maxHeight; } if(dofixed){ if(options.scallback){ settings.scallback($this); } }else{ if(options.ecallback){ settings.ecallback($this); } }; }; var attachEvent = function(obj, evt, func, eventobj) { eventobj = !eventobj ? obj : eventobj; if(obj.addEventListener) { obj.addEventListener(evt, func, false); } else if(eventobj.attachEvent) { obj.attachEvent('on' + evt, func); } }; attachEvent(window, 'scroll', fixedTop); }; })(); (function(){ $.fn.hoverAndClickShow = function(options){ var $this = this; var settings = { method:"hover", autoClose:true, callback:function(){}, bcallback:function(){} }; if(options){ $.extend(settings,options); }; if(settings.method =="hover"){ $this.hover(function(){ $(this).find(".hide").addClass("show"); $(this).find(".addover").addClass("hover"); $(this).css({"z-index":99}).addClass("loadedShow"); $(this).find(".hideclose").unbind("click").bind("click",function(){ $(this).parents($this).removeClass("show"); }); if(options.callback){ settings.callback($(this)); } },function(){ $(this).find(".hide").removeClass("show"); $(this).find(".addover").removeClass("hover"); $(this).css({"z-index":0}).removeClass("loadedShow"); }); }; if(settings.method =="click"){ var $thisClick = $this.find(".cilckItem"); $thisClick.unbind("click").bind("click",function(){ var $cthis = $(this); event.stopPropagation(); var $thisSibling = $(this).siblings(".hide"); if($thisSibling.is(":hidden")){ $thisSibling.addClass("show"); $thisSibling.parents($this).css({"z-index":99}).addClass("loadedShow"); $(this).find(".ico-add").addClass("ico-del"); if(options.callback){ settings.bcallback($cthis); } }else{ $thisSibling.removeClass("show"); $thisSibling.parents($this).css({"z-index":0}).removeClass("loadedShow"); $(this).find(".ico-add").removeClass("ico-del"); } if(settings.autoClose){ $thisSibling.find(".hideclose").unbind("click").bind("click",function(){ $(this).parents($thisSibling).removeClass("show"); $(this).parents($thisSibling).parents($this).removeClass("loadedShow"); }); $(document).bind('click',function(e){ var target = $(e.target); if(target.closest($thisSibling).length == 0){ $thisSibling.removeClass("show"); $thisSibling.parents($this).css({"z-index":0}).removeClass("loadedShow"); }; }); }; if(options.callback){ settings.callback($this); }; }); }; }; })(); (function(){ $.fn.plus = function(options){ var $this = this; var settings = { defaultNum : 1, gradation : 1, isInt : true, decimal : 2, minNum : 1, maxNum : 1000000000000, callback:function(){return false;} }; if (options) { $.extend(settings, options); } var $plus = $this.find(".plus"); var $minus = $this.find(".minus"); var $number = $this.find(".number"); var tempNum =settings.defaultNum; init(); function init(){ settings.decimal=settings.isInt?0:settings.decimal; }; $plus.unbind("click").bind("click",function(){ var $thisNumber = $(this).siblings(".number").find("input"); var ynum=num = Number($thisNumber.val()); num=num+settings.gradation; num=checkBoundary(settings.maxNum,settings.minNum,num); $thisNumber.val(num); if(options.callback){ settings.callback(num,$(this),ynum); } }); $minus.unbind("click").bind("click",function(){ var $thisNumber = $(this).siblings(".number").find("input"); var ynum=num = Number($thisNumber.val()); num = num-settings.gradation; num = checkBoundary(settings.maxNum,settings.minNum,num); $thisNumber.val(num); if(options.callback){ settings.callback(num,$(this),ynum); } }); $number.unbind("click").bind("keyup",function(){ var num=$(this).val(); var $this = $(this); if(num==""){ tempNum=settings.defaultNum; return false; }else if(!checkNum(num,settings.isInt)||!checkMax(settings.maxNum,parseInt(num))){ $(this).val(tempNum); AlertUtils.tips({ htmlmsg:'<div style="padding:30px">输入错误，请重新输入。</div>', type:0 }); return false; }; if(options.callback){ settings.callback(num,$(this)); } }); $number.change(function(){ var num=$(this).val(); if(num==""){ tempNum=settings.defaultNum; return false; }else if(!checkNum(num,settings.isInt)||!checkMax(settings.maxNum,parseInt(num))){ $(this).val(tempNum); AlertUtils.tips({ htmlmsg:'<div style="padding:30px">The number you entered exceeds the maximum value or not in the correct format</div>' }); return false; }; if(options.callback){ settings.callback(num,$(this)); } }); $number.on("blur",function(){ if($(this).val()==""){ $(this).val(settings.defaultNum); return false; }; $(this).val(Number($(this).val()).toFixed(settings.decimal)); }); function checkBoundary(maxNum,minNum,value){ value=value > maxNum ? maxNum : value; value=value < minNum ? minNum : value; return value; }; function checkNum (value,isInt){ if(isInt){ var reg=/^-?[1-9]\d*$/; return reg.test(value); }else{ return !isNaN(value); } }; function checkMax(maxNum,value){ return maxNum > value; }; }; })(); $.fn.scrollPosition=function(options){ var $this = this; var settings = { time:1000, method:'click', callback:function(){} }; if(options){ $.extend(settings,options); }; $this.bind(settings.method,function(){ var indexPosition = $("#" + $(this).attr("data-op")); $(this).siblings().removeClass("selected"); $(this).addClass("selected"); $("html,body").animate({scrollTop:indexPosition.offset().top - 100},settings.time); }); }; $.fn.goTopExUtils = function(){ var $this = this; $this.bind("click",function(){ $("html,body").animate({scrollTop:0},100); $this.hide(); }); var getScrollTop = function(){ return (document.body.scrollTop+document.documentElement.scrollTop); }; var setScrollTop = function(value){ if(navigator.appName=="Netscape" && navigator.userAgent.toUpperCase().indexOf("CHROME")>0){ document.body.scrollTop=value; }else{ document.documentElement.scrollTop=value; } }; window.onscroll=function(){getScrollTop()>0?$this.fadeIn():$this.fadeOut();}; }; $.fn.toggleUtils = function(options){ var $this = this; var settings = { isOpen:false, callback:function(){} }; if(options){ $.extend(settings,options); }; if(settings.isOpen){ $this.addClass("on"); $this.children(".ui-Checkbox").val("1"); } $this.unbind("click").bind("click",function(){ var flag = $(this).hasClass("on"); if(!flag){ $(this).addClass("on"); $(this).children(".ui-Checkbox").val("1"); if(options.callback){ settings.callback(flag); } }else{ $(this).removeClass("on"); $(this).children(".ui-Checkbox").val("3"); if(options.callback){ settings.callback(flag); } } }); }; (function($){ $.fn.serializeJson=function(){ var serializeObj={}; var array=this.serializeArray(); var str=this.serialize(); $(array).each(function(){ if(serializeObj[this.name]){ if($.isArray(serializeObj[this.name])){ serializeObj[this.name].push(this.value); }else{ serializeObj[this.name]=[serializeObj[this.name],this.value]; } }else{ if($("input[name="+this.name+"]").attr("isarray") == "true"){ serializeObj[this.name]=new Array(); serializeObj[this.name].push(this.value); }else { serializeObj[this.name]=this.value; } } }); return serializeObj; }; })(jQuery); var MasonryUtils = function(){ var masonryInit = function(options){ var settings = { masonry:'masonry', navSelector:'.pager', nextSelector:'.pager .pager-next a', itemSelector:'.item', resize:true, islazy:true, ispage:true, threshold:1000, failurelimit:20, issearch:false, skip_invisible : false, pathParse:'', w:1, h:4, callback:null }; /**/ if(options){ $.extend(settings,options); } var $container = $('#' + settings.masonry),sTimer; var $itemSelector =$container.find(".item"); var itemlen = $itemSelector.length; $("img.avatar_lazy").checkImgExists(function(obj,imgurl){ var $myopj = obj; var myimgurl = imgurl; var $thisp = $myopj.parent(".useravatar_bg"); $thisp.css({"background": "url("+myimgurl+") no-repeat","background-size": "cover"}); }); if(itemlen <= 0){ return false; } var doublerow = function(otype){ $container.find("img.lazy-mas").lazyload({ effect: "fadeIn", threshold : settings.threshold, failurelimit:settings.failurelimit }); }; var singlerow = function(){ shareAndLike(); showhideDiv(); editBtn(); $container.find("img.lazy-mas").lazyload({ effect: "fadeIn", threshold : settings.threshold, failurelimit:settings.failurelimit }); }; if(settings.islazy == 1){ doublerow(); }else{ singlerow(); } if(settings.ispage){ var searchflag = false; if(settings.issearch){ searchflag = true; } $container.infinitescroll({ navSelector: settings.navSelector, nextSelector: settings.nextSelector, itemSelector: settings.itemSelector, donetext: '<p style="padding-top:15px">No more pages to load.</p>', loadingImg: static_url + '/moblie/images/loading.gif', loading:{ finished:function(){ $('#data-loading').animate({opacity: .8}, 2000).fadeOut('normal'); } }, bufferPx : 400, pixelsFromNavToBottom:450, searchflag:searchflag, pathParse:settings.pathParse, errorCallback: function () { jQuery('#data-loading').animate({opacity: .8}, 2000).fadeOut('normal'); } }, function(arrayOfNewElems){ if(settings.islazy == 1){ $(arrayOfNewElems).each(function(index, element) { if(index%2==0){ $container.find(".rightbox").append($(this)); }else{ $container.find(".leftbox").append($(this)); } $(this).find("img.lazy-mas").lazyload({ threshold : settings.threshold, failurelimit:settings.failurelimit }); }); }else{ $(arrayOfNewElems).appendTo($container); $("img.avatar_lazy").checkImgExists(function(obj,imgurl){ var $myopj = obj; var myimgurl = imgurl; var $thisp = $myopj.parent(".useravatar_bg"); $thisp.css({"background": "url("+myimgurl+") no-repeat","background-size": "cover"}); }); singlerow(); } if(options.callback){ settings.callback(); } } ); } function showhideDiv(){ $(".rowitemTag").each(function(index, element) { $(this).setTagPos(); }); } if(options.callback){ settings.callback(); } }; var editBtn = function(){ $(".btn-edit").unbind("click").bind("click",function(){ var $thisParent = $(this).parents(".rowitem"); var shid = $(this).attr("data-shid"); var boradid = $(this).attr("data-boradid"); ShareUtils.editShareInit({shid:shid,thisParent:$thisParent,boradid:boradid}); }); }; var shareAndLike = function(){ BaseInitClass.followBtn(); commentBtnBind(); $(".btn-send").unbind("click").bind( "click", function () { var shid = $(this).parents(".byshid").attr("data-shid"); var boradid = $(this).attr("data-typeid"); AjaxFunUtils.ajaxInit({url: '/share/show_f_page.html?page=sendMessage', isloading:true, yzlogin:true, type: "GET", dataType: 'html', params:{}, callback: function(data){ $("body").append(data); AlertUtils.centerDiv({"divId":"SendFrinedTipbox","type":1,w:"96%","callback":function(){ clickUserSelect(); var flag = 1; $('.sendInput').bind('input', function(){ var $thisIput = $(this); var val = $thisIput.val(); if(val && flag){ flag = 0; AjaxFunUtils.ajaxInit({ url:"/search/search_user_byname.html", params:{name:val}, callback:function(res){ flag = 1; if(res.status){ var resUser = res.data; var htmlUser = ''; $.each(resUser,function(index,o){ var avatar = o.avatar; var lihtml='<li class="userFlag" data-uid="'+o.suid+'">'+ '<a class="userCircleAvatar">'+ '<div class="fl mr-10">'+ '<img class="avatar avatar_loading" src="'+avatar[2]+'" data-original="'+avatar[1]+'">'+ '</div>'+ '<div class="fl">'+ '<h4 class="title">'+o.allname+'</h4>'+ '</div>'+ '</a>'+ '</li>'; htmlUser +=lihtml; }); $("#sendList").html(htmlUser); $("#sendList").find(".avatar_loading").each(function(index, element) { $(this).checkImgExists(); });; clickUserSelect(); } } }) } }); function clickUserSelect(){ var messageText=''; $("#sendList").find(".userFlag").on('click',function(){ messageText = $("#message").val(); var uid = $(this).attr("data-uid"); var mynumIndex = $("#SendFrinedTipbox").attr("data-index"); AlertUtils.centerDivClosed({ "indexTipDiv":$("#SendFrinedTipbox"), "indexNum":mynumIndex, "type":1 }); MsgMod.msgInit({shid:shid,boradid:boradid,uid:uid,message:messageText}); }); }; }}); } }); }); $(".btn-repeat").unbind("click").bind("click", function () { var shid = $(this).parents(".byshid").attr("data-shid"); var ishid = $(this).parents(".byshid").attr("data-ishid"); var bigimgurl = $(this).attr("data-bigimgurl"); var title = $(this).attr("data-title"); var url = $(this).attr("data-url"); AjaxFunUtils.ajaxInit({ url: '/common/gettpl.html?name=sns_repeat&ch=sns', isloading:true, yzlogin:true, type: "GET", dataType: 'html', params:{}, callback: function(data){ $("body").append(data); AlertUtils.centerDiv({ divId:"sns_repeat", type:1, callback:function(){ var thishost = "http://" + window.location.host; baiduShare({ bdPic:bigimgurl, bdText:title, url:thishost + "/share/sharepage.html?shid=" + shid + "&ukey="+ukey+"", title:title, desc:title, summary:title }); znshare({ shid:shid, ishid:ishid, callback:function(){ var mynumIndex = $("#sns_repeat").attr("data-index"); AlertUtils.centerDivClosed({indexNum:mynumIndex, indexTipDiv:$("#sns_repeat"),type:1 }); } }); $("#byshare_weixin").unbind("click").bind("click",function(){ shareweinxtip({}); }); } }) } }); }); $(".btn-praise").unbind("click").bind("click", function () { var islike = $(this).attr("data-like"); var shid = $(this).parents(".byshid").attr("data-shid"); var $this = $(this); var $rowitem_zhan = $(this).parents(".byshid").find(".rowitem-zhan"); var $zhannum = $(this).parents(".byshid").find(".zhannum"); var zhannum = Number($zhannum.attr("data-zhannum")); var $avatar_list = $(this).parents(".byshid").find(".avatar-list"); AjaxFunUtils.ajaxInit({url:"/share/like.html", yzlogin:true, params:{shid:shid,likevalue:islike}, callback:function (result) { if(result.status){ if(islike==1){ $this.removeClass("current"); $this.attr("data-like","0"); $this.find(".btn-praise-text").text(lang.js_shareView_like); if(zhannum <= 0){ zhannum = 0; }else{ zhannum = zhannum - 1; } $zhannum.text(zhannum).attr("data-zhannum",zhannum); }else{ $this.addClass("current"); $this.attr("data-like","1"); $this.find(".btn-praise-text").text(lang.js_shareView_unlike); zhannum = zhannum + 1; $zhannum.text(zhannum).attr("data-zhannum",zhannum); } getlikelist(zhannum); } }, errCallback:function(){ $this.removeClass("btn-loading"); } }); function getlikelist(ozhannum){ AjaxFunUtils.ajaxInit({url: '/share/sharelikes.html?shid=' + shid, type: "GET", yzlogin:true, dataType: 'html', params:{}, callback: function(data){ $avatar_list.html(data); if(ozhannum > 0){ $rowitem_zhan.show(); $avatar_list.find("img.avatar_lazy").checkImgExists(function(obj,imgurl){ var $myopj = obj; var myimgurl = imgurl; var $thisp = $myopj.parent(".useravatar_bg"); $thisp.css({"background": "url("+myimgurl+") no-repeat","background-size": "cover"}); }); }else{ $rowitem_zhan.hide(); } } }); }; }); }; return {masonryInit:masonryInit,shareAndLike:shareAndLike,editBtn:editBtn}; }(); $.fn.inputSearch = function(options){ var $this = this; var settings = { url:'', callback:function(){}, bcallback:function(){} }; if(options){ $.extend(settings,options); }; var flag = 1; $this.unbind('input').bind('input', function(){ var $thisIput = $(this); var val = $.trim($thisIput.val()); var $tosuid = $thisIput.siblings('.tosuid'); $tosuid.val(''); var flagNull = isNull(val); if(flagNull){ $thisIput.siblings(".userCircleSelect").hide(); return false; } ajaxSearch(); function ajaxSearch(){ AjaxFunUtils.ajaxInit({ url:settings.url, params:{name:val}, callback:function(res){ if(res.status){ var resUserData = res.data; var num = $thisIput.siblings(".userCircleSelect").size(); if(num <= 0){ var $creatDiv = $('<div class="userCircleSelect ui-Typeahead sendfried"></div>'); $thisIput.after($creatDiv); } var boxhtml=''; $.each(resUserData,function(index,o){ if(options.callback){ boxhtml +=settings.callback(index,o); }; }); var $creatUl = $('<ul class="userList results">'+boxhtml+'</ul>'); $creatUl.html(boxhtml); $thisIput.siblings(".userCircleSelect").html($creatUl).show(); if(options.bcallback){ settings.bcallback($thisIput,$creatDiv,$creatUl,$tosuid); } }else{ var $creatUl = $('<ul class="userList results"><li class="userFlag"><h4 class="title">'+val+'</h4></li></ul>'); $thisIput.siblings(".userCircleSelect").html($creatUl); if(options.bcallback){ settings.bcallback($thisIput,$creatDiv,$creatUl,$tosuid); } } } }); } }); }; $.fn.addTagUtils = function(options){ var $thisImg = this; var $thisShade = $("#addTagFromBox"); var settings = { index:0, isOri:false, maxNum:3, proportion:1, boradid:'', shid:'', ishid:'', share:'', callback:function(){} }; if(options){ $.extend(settings,options); } $thisImg.unbind("click").bind("click",function(e){ var ev = e; oneAddHot(ev,$(this)); }); if(!settings.isOri){ $("#isOri").remove(); }; var oneAddHot = function(evt,$othis){ var $myothis = $othis; var $this = $myothis.parents(".showPicImg"); $thisShade.fadeIn(); $this.find(".redy-tag").remove(); var myEvt = evt; var $dataTag = $this.find(".item-tag"); var num = $dataTag.size(); var $thisHeight = $this.height(); var $thisAddTag = $thisShade.find(".addTagList"); var addTagTop = ($thisHeight - $thisAddTag.height())/2; $dataTag.find(".item-tag-box").addClass("hide"); $dataTag.find(".item-tag-box").parents(".item-tag").css({"z-index":0}); $thisAddTag.css({"top":addTagTop}); $thisAddTag.find(".addTagBtn").unbind("click").bind("click",function(){ var tagType = $(this).attr("data-type"); $thisShade.fadeOut(function(){ createTagCont(myEvt,num,tagType,$this); }); }); $("#addTagFromBox").unbind("click").bind("click",function(){ $thisShade.fadeOut(); }) }; var createTagCont = function(e,num,type,$othis){ var $this = $othis; var addTagDiv = document.createElement('div'); var myTagType = type; var xx = e.pageX; var yy = e.pageY; var l_left = xx - $this.offset().left; var t_top = yy - $this.offset().top; var cpageX = parseInt(l_left/settings.proportion); var cpageY = parseInt(t_top/settings.proportion); var cpageXY = {cpageX:cpageX,cpageY:cpageY}; addTagDiv.id = "addTagDiv_" + settings.index + '_'+ num; addTagDiv.className = "item-tag redy-tag darg-tag"; $this.append(addTagDiv); var $indexAddDiv = $("#addTagDiv_" + settings.index + '_'+ num); $indexAddDiv.attr("data-val",0); var htmlUrl = "/common/gettpl.html?name=tagTip&ch=sns"; if(myTagType == "cus"){ htmlUrl = "/common/gettpl.html?name=customizedTip&ch=buy"; }else if(myTagType == "place"){ htmlUrl = "/common/gettpl.html?name=placeTip&ch=sns"; }else if(myTagType == "people"){ htmlUrl = "/common/gettpl.html?name=peopleTip&ch=sns"; }; AjaxFunUtils.ajaxInit({url: htmlUrl,type: "GET",dataType: 'html',params:{},callback: function(data){ $indexAddDiv.append(data).css({"left":l_left,"top":t_top}).fadeIn(); setTagZb($indexAddDiv); hoverAndDrag({proportion:settings.proportion, parent:$this, indexDiv:$indexAddDiv, opageXY:cpageXY, type:myTagType, shid:settings.shid, ishid:settings.ishid, boradid:settings.boradid, share:settings.share, ismjx:settings.ismjx }); }}); function setTagZb($ODIV){ $ODIV.find(".Coordinate").val(cpageX+'|'+cpageY); $ODIV.attr("data-left",cpageX); $ODIV.attr("data-top",cpageY); var p_w = $indexAddDiv.parent(".showPicImg").width(); var p_h = $indexAddDiv.parent(".showPicImg").height(); var this_w = $indexAddDiv.find(".item-tag-box").width(); var this_h = $indexAddDiv.find(".item-tag-box").height(); var box_l = (p_w - this_w)/2 - l_left; var box_t = (p_h - this_h)/2 - t_top; $indexAddDiv.find(".item-tag-box").css({"left":box_l,"top":box_t}); var tag_form_w = $indexAddDiv.find(".item-tag-show").width()+10; var flag_w = p_w - l_left - tag_form_w; if(flag_w < 0){ $indexAddDiv.find(".item-tag-show").css({"right":24,"left":"auto"}); $indexAddDiv.find(".item-tag-show").find(".tip").addClass("tagRight"); } } if(options.callback){ settings.callback(); }; }; }; var hoverAndDrag = function(options){ var settings = { proportion:'', parent:'', indexDiv:'', iswebsite:'', opageXY:'', type:'', shid:'', ishid:'', share:'', boradid:'', ismjx:0 }; if(options){ $.extend(true,settings,options); }; var delSubHotTag = function(){ var $myparent = settings.parent; var $myindexDivBox = settings.indexDiv; var fpageXY = settings.opageXY.cpageX + '|' + settings.opageXY.cpageY; var myTagType = settings.type; customizedFrom($myindexDivBox,myTagType); }; function customizedFrom($myindexDivBox,myTagType,callback){ $myindexDivBox.find(".addTagTipBtn").unbind("click").bind("click",function(){ var flag = isNull($myindexDivBox.find("input").val()); if(flag){ return false; }else{ sendTagData($myindexDivBox); } }); function sendTagData($omyindexDivBox){ if($omyindexDivBox){ $myindexDivBox = $omyindexDivBox; } $myindexDivBox.attr("data-val",1); if(myTagType == "cus"){ $myindexDivBox.find(".item-tag-label-ico").removeClass("item-tag-label-ico").addClass("ico ico-sCustomized"); } if(myTagType == "tag"){ $myindexDivBox.find(".item-tag-label-ico").removeClass("item-tag-label-ico").addClass("ico ico-stag"); } if(myTagType == "people"){ $myindexDivBox.find(".item-tag-label-ico").removeClass("item-tag-label-ico").addClass("ico ico-sPeople"); } if(myTagType == "place"){ $myindexDivBox.find(".item-tag-label-ico").removeClass("item-tag-label-ico").addClass("ico ico-sPlace"); } var indexTitle = $myindexDivBox.find(".byshareInputName").val(); $myindexDivBox.attr("data-type",myTagType); $myindexDivBox.find(".cilckItem").attr("data-type",myTagType); $myindexDivBox.find(".tip").html('<span>'+indexTitle+'</span>'); $myindexDivBox.addClass("loaded"); $myindexDivBox.find(".item-tag-show").removeClass("hide"); $myindexDivBox.find(".item-tag-box").addClass("hide").hide(); $myindexDivBox.find(".tag_itembox").removeClass("show"); $myindexDivBox.removeClass("redy-tag").addClass("item-hover"); if(callback){ callback(); } ShareUtils.isNextFun(settings); dargTag($myindexDivBox); mdHover(); } }; function searchAllTag(){ if(settings.type == "tag"){ $('.searchTag').inputSearch({ url:'/search/search_liketag.html', callback:function(index,o){ var lihtml='<li class="userFlag" data-uid="1">'+o.tagtxt+'</li>'; return lihtml; }, bcallback:function($thisIput,$creatDiv,$creatUl,$tosuid){ $creatUl.find(".userFlag").on('click',function(){ var value=$(this).text(); var value_val=$(this).attr('data-value')?$(this).attr('data-value'):$(this).val(); var tosuidVal = $(this).attr("data-uid"); $thisIput.attr('value',value); $tosuid.attr('value',tosuidVal); $(this).parents(".userCircleSelect").hide(); }); } }); }else if(settings.type == "people"){ $('.people').inputSearch({ url:'/search/search_user_byname.html', callback:function(index,o){ var avatar = o.avatar; var lihtml='<li class="userFlag" data-uid="'+o.suid+'">'+ '<a class="userCircleAvatar">'+ '<div class="fl mr-10">'+ '<img class="avatar avatar_loading" src="'+avatar[2]+'" data-original="'+avatar[1]+'">'+ '</div>'+ '<div class="fl">'+ '<h4 class="title">'+o.allname+'</h4>'+ '</div>'+ '</a>'+ '</li>'; return lihtml; }, bcallback:function($thisIput,$creatDiv,$creatUl,$tosuid){ $creatUl.find(".userFlag").on('click',function(){ var value=$(this).find("h4").text(); var value_val=$(this).attr('data-value')?$(this).attr('data-value'):$(this).val(); var tosuidVal = $(this).attr("data-uid"); $thisIput.attr('value',value); $tosuid.attr('value',tosuidVal); $(this).parents(".userCircleSelect").hide(); }); } }); }else if(settings.type == "place"){ $('.place_bak').inputSearch({ url:'/search/search_likepalce.html', callback:function(index,o){ var lihtml='<li class="userFlag" data-uid="1">'+o.CityName+'</li>'; return lihtml; }, bcallback:function($thisIput,$creatDiv,$creatUl,$tosuid){ $creatUl.find(".userFlag").on('click',function(){ var value=$(this).text(); var value_val=$(this).attr('data-value')?$(this).attr('data-value'):$(this).val(); var tosuidVal = $(this).attr("data-uid"); $thisIput.attr('value',value); $tosuid.attr('value',tosuidVal); $(this).parents(".userCircleSelect").hide(); }); } }); }else if(settings.type == "cus"){ AjaxFunUtils.ajaxInit({ url: '/goods/goodscats.html', callback:function(res){ var resData = res.data; $.each(resData,function(index,o){ var li_o = '<li value="'+o.catid+'">'+o.catname+'</li>'; $(".CategoryList").append(li_o); }); $(".select_box").selectUtils({"callback":function(){ var select_analog = $(".select_box").find('input'); checkInputFun.initContext(select_analog, checkInputFun.myIt); select_analog.siblings("p").show(); checkInputFun.mycheckIn(select_analog); }}); } }); }; }; var dargTag = function($omyindexDivBox){ var $cilckItem = $omyindexDivBox.find(".cilckItem"); var $thisparents = $cilckItem.parents(".showPicImg"); $cilckItem.draggable({ containment:$thisparents, start:function(){ }, stop: function(event, ui) { var $thisui = $(this); var $thisuiParent = $thisui.parent(".item-tag"); var $showPicImg = $thisui.parents(".showPicImg"); var pLeft = $thisuiParent.position().left; var pTop = $thisuiParent.position().top; var Left = pLeft + $thisui.position().left; var Top = pTop + $thisui.position().top; var l = Left/settings.proportion; var t = Top/settings.proportion; $thisuiParent.find(".Coordinate").val(l + '|' + t); $thisuiParent.attr("data-left",l); $thisuiParent.attr("data-top",t); var img_w = $showPicImg.width(); var this_w = $thisuiParent.find(".item-tag-form").width()+12; var isleft = (Left + this_w)-img_w>0?1:0; var isright = (this_w - Left )>0?1:0; var tag_form_w = $thisuiParent.find(".item-tag-form").width()+10; if(isleft){ $thisuiParent.find(".item-tag-form").css({"right":24,"left":"auto"}); $thisuiParent.find(".item-tag-form").find(".tip").addClass("tagRight"); } if(isright){ $thisuiParent.find(".item-tag-form").css({"left":24,"right":"auto"}); $thisuiParent.find(".item-tag-form").find(".tip").removeClass("tagRight"); } } }); }; $(".delTipBtn").unbind("click").bind("click",function(){ $(this).parents(".item-tag").remove(); settings.indexDiv.find(".item-tag").each(function(index, element){ var myIndex = index; $(this).attr("id","addTagDiv_" + myIndex); }); ShareUtils.isNextFun(settings); }); var mdHover = function(){ $(".cilckItem").unbind("click").bind("click",function(){ var tagType = $(this).attr("data-type"); var $thissib = $(this).siblings(".item-tag-box"); var $thisp = $(this).parents(".item-hover"); AlertUtils.tips({ w:"80%", htmlmsg:'<div style="padding:30px">'+lang.js_base_deltag+'</div>', scallback:function(){ $thisp.remove(); ShareUtils.isNextFun(settings); } }); }); }; delSubHotTag(); if(settings.share){ mdHover(); dargTag(settings.indexDiv); } }; var closeUpload = function(){ var $thisDiv = $("#uploadid"); var mynumIndex = $thisDiv.attr("data-index"); AlertUtils.centerDivClosed({indexNum:mynumIndex, indexTipDiv:$thisDiv,type:1 }); }; var browser = { versions: function() { var u = navigator.userAgent, app = navigator.appVersion; return { trident: u.indexOf('Trident') > -1, presto: u.indexOf('Presto') > -1, webKit: u.indexOf('AppleWebKit') > -1, gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, iPad: u.indexOf('iPad') > -1, webApp: u.indexOf('Safari') == -1 }; }(), language: (navigator.browserLanguage || navigator.language).toLowerCase() }; var ShareUtils = function(){ var addShareInit = function(oarrData,options){ var myarrData = oarrData; var settings = { color:'', share:'share', iswebsite:'', isOri:false, shid:'', ishid:'', boradid:'', opageXY:'', proportion:1, ismjx:0, callback:function(){} }; if(options){ $.extend(true,settings,options); }; var proportion = 1; if(!settings.iswebsite){ closeUpload(); }; if(settings.share == 'share'){ sharePicAjax(); } function sharePicAjax(){ AjaxFunUtils.ajaxInit({url: '/share/show_f_page.html?page=shareTipFirst', isloading:true, yzlogin:true, type: "GET", dataType: 'html', params: {shid:settings.shid,share:settings.share}, callback: function(data){ $("body").append(data); $("#continueBtn").remove(); var imgHeight = getHeightDiv(); var isshow = $("#slide_01tip").find(".showPicImg").size()>1?1:0; AlertUtils.centerDiv({ divId:"shareFirstTipbox", type:1, w:"100%", position:"fixed", istop:true, callback:function(){ if(options.callback){ settings.callback(); } } }); $("#boxslider").boxslider({ isshow:isshow, autoplay:false, callback:function(){ countPicData(imgHeight); if(settings.share == 'shere'){ $("#showPic").find(".showPicImg").each(function(index, element) { $(this).setTagPos(); }); } } }); ShareUtils.isNextFun(settings); } }); }; if(settings.share == 'up'){ upPicAjax(); } function upPicAjax(){ AjaxFunUtils.ajaxInit({url: '/share/show_f_page.html?page=shareTipFirst', isloading:true, yzlogin:true, type: "GET", dataType: 'html', params:{}, callback: function(data){ $("body").append(data); AlertUtils.centerDiv({ divId:"shareFirstTipbox", type:1, w:"100%", position:"fixed", istop:true, callback:function(){ if(options.callback){ settings.callback(); } } }); showPicList(myarrData); } }); }; function getHeightDiv(){ var imgHeight = 0; var tiptopH = $("#tiptop").height(); var tipbottomH = $("#tipbottom").height(); if (browser.versions.ios || browser.versions.iPhone || browser.versions.iPad) { var bodyHeight = window.screen.availHeight; imgHeight = bodyHeight - tiptopH -tipbottomH-60; }else if (browser.versions.android) { var bodyHeight = getHeightBody(); imgHeight = bodyHeight - tiptopH -tipbottomH-40; }else{ var bodyHeight = getHeightBody(); imgHeight = bodyHeight - tiptopH -tipbottomH-40; } return imgHeight; } function imgTagOption($oshowDiv){ $oshowDiv.find(".olddata").each(function(index, element) { var oldLeft = $(this).attr("data-left"); var oldTop = $(this).attr("data-top"); var newLeft = oldLeft*settings.proportion; var newTop = oldTop*settings.proportion; var p_w = $(this).parent(".showPicImg").width(); var p_h = $(this).parent(".showPicImg").height(); var this_w = $(this).find(".item-tag-box").width(); var this_h = $(this).find(".item-tag-box").height(); var box_l = (p_w - this_w)/2 - newLeft; var box_t = (p_h - this_h)/2 - newTop; $(this).find(".item-tag-box").css({"left":box_l,"top":box_t}); var tag_form_w = $(this).find(".item-tag-show").width()+10; var flag_w = p_w - newLeft - tag_form_w; if(flag_w < 0){ $(this).find(".item-tag-show").css({"right":24,"left":"auto"}); $(this).find(".item-tag-show").find(".tip").addClass("tagRight"); } settings.opageXY = {cpageX:oldLeft,cpageY:oldTop}; $(this).css({"left":newLeft,"top":newTop}); }); } function getImgWidth(ow,oh,omaxW,omaxH){ var maxW = omaxW; var maxH = omaxH; var show_width = ow; var show_height = oh; if(show_height > maxH){ show_width = (maxH*show_width)/show_height; show_height = maxH; }; if(show_width > maxW){ show_height = (maxW*show_height)/show_width; show_width = maxW; } return {width:show_width,height:show_height}; }; function showPicList(oarrData){ var simgHtml = ''; var bimgHtml = ''; $.each(oarrData,function(index,o){ var b_imgUrl = o.src; var s_imgUrl = o.src; var color = ''; var lihtml = '<li data-bimgurl="'+o.key+'" data-simgurl="'+o.key+'" data-w="'+o.width+'" data-h="'+o.height+'" data-sw="'+o.swidth+'" data-sh="'+o.sheight+'" data-index="'+index+'">'+ '<em class="ico ico-userclose" data-index="'+index+'"></em>'+ '<a class="imghoverMask" href="javascript:void(0);">'+ '<span class="hoverMask"></span>'+ '<img src="'+b_imgUrl+'" />'+ '</a>'+ '</li>'; var radiohtml = '<input class="defrdio" type="radio" name="isface" id="isface_'+index+'" value="1" />'; if(index == 0){ radiohtml = '<input class="defrdio" type="radio" name="isface" id="isface_'+index+'" value="1" checked="checked"/>'; } var showPicImgBox = '<li data-width="'+o.width+'"><form id="form_'+index+'" method="post" action="javascript:void(0);" data-w="'+o.width+'" data-h="'+o.height+'" data-sw="'+o.swidth+'" data-sh="'+o.sheight+'" data-bimgUrl="'+o.key+'" data-simgUrl="'+o.key+'" data-color="'+color+'" data-imgrel="'+o.key+'" class="showPicImg" style="width:'+o.width+'px;height:'+o.height+'px;">'+ '<span class="defpic">'+radiohtml+'<label for="isface_'+index+'">设为封面</label></span>'+ '<img class="picImg" src="'+b_imgUrl+'" style="width:'+o.width+'px height:'+o.height+'px">'+ '<input type="hidden" value="" name="relBoxSize" class="relBoxSize">'+ '</form></li>'; bimgHtml +=showPicImgBox; }); $("#slide_01tip").html(bimgHtml); var imgHeight = getHeightDiv(); var isshow = $("#slide_01tip").find(".showPicImg").size()>1?1:0; $("#boxslider").boxslider({ isshow:isshow, autoplay:false, callback:function(){ countPicData(imgHeight); if(settings.share == 'shere'){ $("#showPic").find(".showPicImg").each(function(index, element) { $(this).setTagPos(); }); } } }); ShareUtils.isNextFun(settings); }; function countPicData(oimgHeight){ $("#showPic").find(".showPicImg").each(function(index, element) { var $showDiv = $(this); var width = Number($showDiv.attr("data-w")); var height = Number($showDiv.attr("data-h")); var show_height = height; var show_width = width; var maxW= $("body").width(); var maxH = oimgHeight; if(show_height > maxH){ show_width = (maxH*show_width)/show_height; show_height = maxH; }; if(show_width > maxW){ show_height = (maxW*show_height)/show_width; show_width = maxW; } if(show_height < maxH){ var margin_top = (maxH - show_height)/2; var h = maxH-margin_top; $showDiv.css({"margin-top":margin_top}); } $("#showPic").css({"height":maxH}); $showDiv.parent("li").css({"width":maxW}); $showDiv.css({"width":show_width,"height":show_height}); $showDiv.find(".picImg").css({"width":show_width,"height":show_height}); $showDiv.find(".defrdio").unbind("click").bind("click",function(){ $("#showPic").find(".defrdio").attr("checked",false); $(this).attr("checked",true); }); var thisproportion = show_width/Number(width); settings.proportion = thisproportion; var $thisItem = $showDiv.find(".item-tag"); if(settings.share == "share"){ imgTagOption($showDiv); } hoverAndDrag({proportion:thisproportion, parent:$showDiv, indexDiv:$thisItem, opageXY:settings.opageXY, type:'', shid:settings.shid, ishid:settings.ishid, share:true, iswebsite:settings.iswebsite, ismjx:settings.ismjx }); $showDiv.fadeIn(); $showDiv.siblings(".showPicImg").hide(); $("#addTagFromBox").hide(); $showDiv.find(".picImg").addTagUtils({ index:index, isOri:settings.isOri, proportion:thisproportion, boradid:settings.boradid, shid:settings.shid, ishid:settings.ishid, share:settings.share, ismjx:settings.ismjx, callback:function(){} }); }); } function showPics(index,$thisLi,oimgHeight) { $thisLi.siblings("li").find(".imghoverMask").removeClass("current"); $thisLi.find(".imghoverMask").addClass("current"); var $showDiv = $("#showPic").find(".showPicImg").eq(index); var width = Number($showDiv.attr("data-w")); var height = Number($showDiv.attr("data-h")); var show_height = height; var show_width = width; var maxW= $("body").width(); var maxH = oimgHeight; if(show_height > maxH){ show_width = (maxH*show_width)/show_height; show_height = maxH; }; if(show_width > maxW){ show_height = (maxW*show_height)/show_width; show_width = maxW; } var thisproportion = show_width/Number(width); settings.proportion = thisproportion; if(show_height < maxH){ var margin_top = (maxH - show_height)/2; var h = maxH-margin_top; $("#showPic").css({"margin-top":margin_top,"height":h}); }else{ $("#showPic").css({"height":maxH}); } $showDiv.css({"width":show_width,"height":show_height}); $showDiv.find(".picImg").css({"width":show_width,"height":show_height}); var $thisItem = $showDiv.find(".item-tag"); if(settings.share == "share"){ imgTagOption($showDiv); } hoverAndDrag({proportion:thisproportion, parent:$showDiv, indexDiv:$thisItem, opageXY:settings.opageXY, type:'', shid:settings.shid, ishid:settings.ishid, share:true, iswebsite:settings.iswebsite, ismjx:settings.ismjx }); $showDiv.fadeIn(); $showDiv.siblings(".showPicImg").hide(); $("#addTagFromBox").hide(); $showDiv.find(".picImg").addTagUtils({ index:index, isOri:settings.isOri, proportion:thisproportion, boradid:settings.boradid, shid:settings.shid, ishid:settings.ishid, share:settings.share, ismjx:settings.ismjx, callback:function(){} }); } function switchShow(oimgHeight){ var $thisLi = $("#showPic_samll").find("li").eq(0); $("#showPic_samll").find("li").unbind("click").bind("click",function(){ var $thisLi = $(this); var index = $(this).index(); showPics(index,$thisLi,oimgHeight); }); showPics(0,$thisLi,oimgHeight); }; }; var isNextFun = function(options){ var settings = { boradid:'', share:'', ishid:'', shid:'', ismjx:0 }; if(options){ $.extend(true,settings,options); } var isVal = $("#showPic").find(".item-tag").attr("data-val"); $("#shareFirstTipbox").find(".btn-one").removeClass("btn-danger-gray").addClass("btn-next"); selectImg(settings.boradid); function selectImg(){ $(".btn-next").unbind("click").bind("click",function(){ var dataList = []; var imgLen = $("#showPic").find(".showPicImg").size(); $("#showPic").find(".showPicImg").each(function(index, element) { var $thisShow = $(element); var mydataFrom = $thisShow.serializeJson(); mydataFrom.width = $thisShow.attr("data-w"); mydataFrom.height = $thisShow.attr("data-h"); mydataFrom.swidth = $thisShow.attr("data-sw"); mydataFrom.sheight = $thisShow.attr("data-sh"); mydataFrom.src = $thisShow.attr("data-bimgurl"); mydataFrom.imgrel = $thisShow.attr("data-imgrel"); mydataFrom.thumbpic = $thisShow.attr("data-simgurl"); mydataFrom.color = $thisShow.attr("data-color"); mydataFrom.shid = $thisShow.attr("data-shid"); dataList.push(mydataFrom); if(index === imgLen - 1){ var num = $("#shareFirstTipbox").attr("data-index"); AlertUtils.centerDivClosed({indexNum:num, indexTipDiv:$("#shareFirstTipbox"),type:1 }); ShareUtils.addShareInitTwo({dataFrom:dataList, boradid:settings.boradid, share:settings.share, shid:settings.shid, ishid:settings.ishid, ismjx:settings.ismjx }); } }); }); }; }; var addShareInitTwo = function(options){ var settings = { dataFrom:{}, thumbpic:'', boradid:'', share:'', shid:'', ishid:'', ismjx:0, callback:function(){} }; if(options){ $.extend(true,settings,options); } AjaxFunUtils.ajaxInit({url: '/share/show_f_page.html?page=shareTip', isloading:true, type: "GET", dataType: 'html', params: {share:settings.share}, callback: function(data){ $("body").append(data); if(options.callback){ settings.callback(); } var BodyHeight = getHeightBody()- 40; $("#shareTipbox").find(".tipcont").css({"height":BodyHeight}); $("#shareTipbox").find(".group_categoryList").css({"height":BodyHeight-213}); AlertUtils.centerDiv({ divId:"shareTipbox", type:1, w:"100%", position:"fixed", istop:true, callback:function(){ shareBind(settings); } }); $(".cover-img img").attr("src", settings.thumbpic); $("#picurlid").val(settings.thumbpic); } }); }; var shareSuccess = function(options){ var settings = { shid:'', pic:'', title:'', dataFrom:{}, share:'', callback:function(){} }; if(options){ $.extend(settings,options); } var href = window.location.href; if(settings.share == 'caiji' || settings.share == 'jietu'){ href = "/"; } AjaxFunUtils.ajaxInit({url: '/share/show_f_page.html?page=shareSuccessTip', type: "GET", isloading:true, dataType: 'html', params:{}, callback: function(data){ $("body").append(data); if(options.callback){ settings.callback(); } AlertUtils.centerDiv({ "divId":"shareSuccessTipbox", "type":1, "callback":function(){ var thishost = "http://" + window.location.host; baiduShare({ bdPic:settings.pic, bdText:settings.title, url:thishost + "/share/sharepage.html?shid=" + settings.shid, title:settings.title, desc:settings.title, summary:settings.title }); $("#byshare_weixin").unbind("click").bind("click",function(){ shareweinxtip({}); }); $("#shareSuccessTipbox").find("#seeItNow").attr("href","/share/sharepage.html?shid=" + settings.shid); }, closeback:function(){ window.location = '/share/sharepage.html?shid=' + settings.shid; } }); } }); }; var addShareUrl = function(options){ var settings = { callback:function(){return false} }; if(options){ $.extend(settings,options); } AjaxFunUtils.ajaxInit({url: '/common/gettpl.html?name=addWebUrl&ch=sns', type: "GET", yzlogin:true, isloading:true, dataType: 'html', params:{}, callback: function(data){ $("body").append(data); AlertUtils.centerDiv({divId:"addWebUrl",type:1,w:400}); $(".btnTipsubmit").unbind("click").bind("click",function(){ var url = $("#webUrlInput").val(); if(url==''){ $("#webUrlInput").siblings(".input_tip").show(); return false; }else{ $("#webUrlInput").siblings(".input_tip").hide(); window.location.href = '/share/get_website_pics.html?websiteurl='+url; } }); } }); if(options.callback){ settings.callback(); } }; var editShareInit = function(options){ var settings = { thisParent:'', shid:'', boradid:'', callback:function(){} }; if(options){ $.extend(settings,options); } var href = window.location.href; AjaxFunUtils.ajaxInit({url: '/share/show_f_page.html?page=editShareTip&shid='+settings.shid, type: "GET", isloading:true, dataType: 'html', params:{}, callback: function(data){ $("body").append(data); if(options.callback){ settings.callback(); } AlertUtils.centerDiv({divId:"editShareTipbox",type:1,callback:function(){ $("#editShareFrom").checkInput({ "button":'.editShareBtn', submitBtnFn: function (from,index) { Loading.loadInit({status:1}); var act = $(index).attr("data-type"); var dataFrom = from.serializeJson(); dataFrom.shid = settings.shid; if(act == 'del'){ var actUrl = '/share/del_pin.html'; } if(act == 'edit'){ var actUrl = '/share/edit_pin.html'; } AjaxFunUtils.ajaxInit({ "url":actUrl, "params":dataFrom, "callback":function (result) { Loading.loadInit({status:0}); if(result.status){ var mynumIndex = $("#editShareTipbox").attr("data-index"); AlertUtils.centerDivClosed({ "indexTipDiv":$("#editShareTipbox"), "indexNum":mynumIndex, "type":1 }); AlertUtils.tips({ htmlmsg:'<div style="padding:30px">'+result.msg+'</div>', type:0, scallback:function(){ window.location.href = href; } }); }else{ AlertUtils.tips({ type:0, htmlmsg:'<div style="padding:30px">'+result.msg+'</div>' }); Loading.loadInit({status:0}); } } }) } }) }}); shareBind({boradid:settings.boradid,ishid:settings.ishid,shid:settings.shid,ismjx:settings.ismjx}); } }); }; var shareBind = function(options){ var settings = { boradid :'', share:'', ishid:'', shid:'', ismjx:0, maxNum:15 }; if(options){ $.extend(true,settings,options); }; var myodataForm = settings.dataFrom; var myboradid = settings.boradid; var getSelectData = function(){ AjaxFunUtils.ajaxInit({ "url":"/share/get_share_typename.html", "callback":function (res){ var lidata = res.data.rows; var lihtml = ''; var deNum = 0; $.each(lidata,function(index,o){ var li_html = '<li data-value="'+o.ucatid+'" class="boardprintitem">'+o.bname+'</li>'; if(myboradid == o.ucatid){ deNum = index; } lihtml +=li_html; }); $("#shareboard").find(".board_items").empty().append(lihtml); $("#shareboard").selectUtils({"deNum":deNum,"isDef":true,"callback":function(){ var select_analog = $(".select_box").find('.select_analog'); checkInputFun.initContext(select_analog, checkInputFun.myIt); select_analog.siblings("p").show(); checkInputFun.mycheckIn(select_analog); }}); } }); }; $("#description").unbind('input').bind('input',function(){ var valLen = $(this).val().length; var inputLen = 300 - valLen; $("#descNum").text(inputLen); }); $('#boardname').bind('input', function(){ var val = $(this).val(); if(val == ''){ $(".creatbtn").unbind("click"); $(this).parents(".boardnamebox").siblings("button").removeClass("creatbtn"); }else{ $(this).parents(".boardnamebox").siblings("button").addClass("creatbtn"); $(".creatbtn").unbind("click").bind("click",function(){ $this = $(this); var typename = $(this).siblings(".boardnamebox").find("#boardname").val(); AjaxFunUtils.ajaxInit({"url":"/share/add_share.html", "params":{'name': typename},"callback":function (result){ if(result.status){ $("#shareboard").find(".select_option").hide(); }else{ AlertUtils.tips({ htmlmsg:'<div style="padding:30px">'+result.msg+'</div>' }); } } }); }); }; }); $("#bigcategoryBtn").unbind("click").bind("click",function(){ var $thisparnt = $(this).parent(".select_box"); var caNum = $("#bigcategorybox").size(); if(caNum <= 0){ AjaxFunUtils.ajaxInit({url: '/share/show_f_page.html?page=sns_category&ch=sns', type: "GET", isloading:true, dataType: 'html', params:{}, callback:function(data){ $("body").append(data); AlertUtils.centerDiv({ divId:"bigcategorybox",type:1,w:"95%" }); b_categoryBind(); } }); }else{ $("#bigcategorybox").show(); var num = $("#bigcategorybox").attr("data-index"); $("#modalMask_" + num).show(); b_categoryBind(); } function b_categoryBind(){ $("#categorySub").unbind("click").bind("click",function(){ var licurrentNum = $("#categoryFrom").find("li.current").size(); if(licurrentNum<=0){ $("#categoryText").html(lang.js_base_categorytext); }else{ var litexthtml = ''; $("#categoryFrom").find("li.current").each(function(index, element) { var liText = ","+$(this).text(); if(index == 0){ liText = $(this).text(); } litexthtml +=liText; }); $("#categoryText").html(litexthtml); } var num = $("#bigcategorybox").attr("data-index"); AlertUtils.centerDivClosed({indexNum:num,indexTipDiv:$("#bigcategorybox"),type:0}); }); $("#categoryFrom").undelegate("li.current", "hover").delegate("li.current", "hover", function(){ $(this).toggleClass("hover"); }); $("#categoryFrom").undelegate(".icoCurrent", "click").delegate(".icoCurrent", "click", function(){ var litype = $(this).attr("data-type"); $(this).parent("li").removeClass("current"); $(this).parent("li").attr("data-isload",0); if(litype == 0){ var li_num = $(this).parent("li").index(); $("#smallDiv_" + li_num).remove(); }; }); $("#bigcategory").find("li").unbind("click").bind("click",function(){ var $b_this = $(this); var tagid = $b_this.attr("data-tagid"); var catid = $b_this.attr("data-catid"); var attid = $b_this.attr("data-attid"); var name = $b_this.attr("data-name"); var isload = $b_this.attr("data-isload"); var thisText = $b_this.text(); var thisIndex = $b_this.index(); var b_flag = $(this).hasClass("current"); if(!b_flag){ maxNumLiCurrent($b_this); } if(isload == 0){ var $loading = $("<div class='s_loadin_bg' style='position: relative;'></div>"); var $smallDiv = $("<div id='smallDiv_"+thisIndex+"' class='small_category' style='display:none'></div>"); $smallDiv.html($loading); $("#sns_small_category").append($smallDiv); AjaxFunUtils.ajaxInit({url: '/share/show_f_page.html?page=sns_category_son&ch=sns', type: "GET", dataType: 'html', params: {tagid:tagid,catid:catid,attid:attid,catname:thisText}, callback:function(data){ $smallDiv.html(data).show(); $b_this.attr("data-isload",1); $("#smallDiv_" + thisIndex).siblings(".small_category").hide(); $(".scategory").find("li").unbind("click").bind("click",function(){ var $s_this = $(this); var s_flag = $(this).hasClass("current");; if(!s_flag){ maxNumLiCurrent($s_this); } }); }, errCallback:function(){ $smallDiv.html('').hide(); $b_this.attr("data-isload",1); $("#smallDiv_" + thisIndex).siblings(".small_category").hide(); } }); }else{ $("#smallDiv_" + thisIndex).siblings(".small_category").hide(); $("#smallDiv_" + thisIndex).show(); } }); }; function maxNumLiCurrent($othis){ var $myothis = $othis; var currentLINum = $("#categoryFrom").find("li.current").size(); if(currentLINum >= settings.maxNum){ AlertUtils.tips({ htmlmsg:'<div style="padding:30px">' + lang.maxCategoryNum+'</div>', type:0 }); }else{ categoryBtnBind($myothis); } }; function categoryBtnBind($othis){ var $lithis = $othis; var $thisUl = $lithis.parent("ul"); $lithis.addClass("current hover"); $lithis.find(".currentico").addClass("icoCurrent"); var thisInputVal = ''; $thisUl.find("li").each(function(index, element) { var s_flag = $(this).hasClass("current"); if(s_flag){ var tagid = $(this).attr("data-tagid"); var catid = $(this).attr("data-catid"); var attid = $(this).attr("data-attid"); var name = $(this).attr("data-name"); if(catid){ var thisVal = tagid+"|"+catid + "|" + name + "_"; thisInputVal +=thisVal; }else if(attid){ var thisVal = tagid+"|"+attid + "|" + name + "_"; thisInputVal +=thisVal; } } }); $lithis.siblings("input").val(thisInputVal); }; }); $("#shareFrom").checkInput({ inputs:{ "Category":{isempty: [0],focusMsg: '',rightMsg: "",errorMsg:'valid'} }, submitBtnFn: function (from) { Loading.loadInit({status:1}); var js_debug = BaseInitClass.getQueryString("js_debug"); var dataFrom = from.serializeJson(); var categoryData = $("#categoryFrom").serializeJson(); var resData = $.extend(true,dataFrom,categoryData); var special_id = $("#upcontainer").attr("data-specialid"); var gpid = $("#upcontainer").attr("data-gpid"); var addurl = "/share/add_pin.html"; if(js_debug){ addurl = "/share/add_pin.html?js_debug=1"; } AjaxFunUtils.ajaxInit({ url:addurl, params:{imgdata:myodataForm,board:resData,share:settings.share,shid:settings.shid,ishid:settings.ishid,special_id:special_id,gpid:gpid,is_mjx:settings.ismjx}, callback:function (result) { if(js_debug){ alert(addurl); alert(result.status); alert(result.msg); } if(result.status){ Loading.loadInit({status:0}); var num = $("#shareTipbox").attr("data-index"); AlertUtils.centerDivClosed({indexNum:num,indexTipDiv:$("#shareTipbox"),type:1,"w":600}); var num = $("#bigcategorybox").attr("data-index"); AlertUtils.centerDivClosed({indexNum:num,indexTipDiv:$("#bigcategorybox"),type:1}); var newshid = result.data.shid; var newtitle = result.data.title; var newpic = result.data.pic; shareSuccess({shid:newshid,share:settings.share,title:newtitle,pic:newpic}); }else{ Loading.loadInit({status:0}); AlertUtils.tips({ htmlmsg:'<div style="padding:30px">' + result.msg+'</div>' }); } } }); } }); }; return {addShareInit:addShareInit,isNextFun:isNextFun,addShareInitTwo:addShareInitTwo,editShareInit:editShareInit,addShareUrl:addShareUrl}; }(); var GetCartTop = function(){ var getCartInit = function(){ if(islogin==0){ $("#cartItemnum").hide(); return false; } AjaxFunUtils.ajaxInit({ url:"/myorder/getcart.html", params:{partdata:"goods"}, callback:function(res){ var itemnum = res.data.itemnum; if(itemnum > 0){ $("#cartItemnum").text(itemnum).show(); }else{ $("#cartItemnum").text('0').show(); } } }); }; return {getCartInit:getCartInit} }(); var closeTip = function(obj,otype){ var num = obj.attr("data-index"); var type = 1; if(otype){ type = otype; } AlertUtils.centerDivClosed({ indexNum:num, indexTipDiv:obj, type:type }); }; var chatBtn = function(options){ var settings = { uid:'', username:'' }; if(options){ $.extend(settings,options); } $(".chatBtn").unbind("click").bind("click",function(){ var uid = settings.uid; var username = settings.username; if(!uid){ uid = $(this).attr("data-uid"); } if(!username){ username = $(this).attr("data-username"); } if(uid == suid ){ AlertUtils.tips({ type:0, htmlmsg:'<div style="padding:30px">' + lang.js_base_yourself+'</div>' }); return false; } closeTip($("#sns_more")); AjaxFunUtils.ajaxInit({url:'/common/gettpl.html?name=sns_chat&ch=sns', type: "GET", yzlogin:true, isloading:true, dataType: 'html', params:{}, callback: function(data){ $("body").append(data); $("#title_username").html('<a href="/share/myshares.html?fsuid='+uid+'&ukey='+ukey+'">'+username+'</a>'); AlertUtils.centerDiv({divId:"chatbox", type:1, w:'95%', position: 'absolute', p_new:1, callback:function(){ var contHeight = getHeightBody() - 230; $("#msgListBox").css({"height":contHeight}); MsgMod.msgInit({ uid:uid }); }, closeback:function(){ } }); } }); }); }; var messageDel = function(){ $(".messageDel").unbind("click").bind("click",function(){ var $this = $(this).parents(".itemmsg"); var msgid = $this.attr("data-id"); AjaxFunUtils.ajaxInit({url: '/message/del.html', params: {msgid:msgid}, callback:function(res){ if(res.status){ $this.remove(); }else{ } } }); }); }; var commentDel = function(){ $(".delCommentBtn").unbind("click").bind("click",function(){ var $thisCom = $(this).parents(".shareDescriptionComment"); var cmmid = $(this).attr("data-cmmid"); var shid = $(this).attr("data-shid"); var $pl_list = $(this).parents(".pl-list"); var $plnum = $(this).parents(".pl-listbox").find(".plnum"); var pl_num = Number($plnum.attr("data-plnum")); AlertUtils.tips({ w:"90%", htmlmsg:'<div style="padding:30px">' + lang.js_base_del_text+'</div>', scallback:function(){ AjaxFunUtils.ajaxInit({ "url":"/comment/del_comment.html", "params":{cmmid:cmmid,shid:shid}, "callback":function (result) { if(result.status){ $thisCom.remove(); pl_num = pl_num - 1; getcommentlist({shareid:shid,pl_list:$pl_list,plnum:$plnum,pl_num:pl_num}); }else{ AlertUtils.tips({ w:"90%", htmlmsg:'<div style="padding:30px">' + result.msg+'</div>' }); } } }); } }); }); }; var snsReport = function(){ $(".reportBtn").unbind("click").bind("click",function(){ var type = $(this).attr("data-type"); var cmmid = $(this).attr("data-cmmid"); var shid = $(this).attr("data-shid"); var fsuid = $(this).attr("data-fsuid"); var msgid = $(this).attr("data-msgid"); if(type=='comment'){ var url ='/common/gettpl.html?name=sns_reportComment&ch=sns'; }else if(type == 'shares'){ var url ='/common/gettpl.html?name=sns_report&ch=sns'; }else if(type == 'msg'){ var url ='/common/gettpl.html?name=sns_report&ch=sns'; } AjaxFunUtils.ajaxInit({url: url, type: "GET", dataType: 'html', params:{}, callback:function(data){ $("body").append(data); AlertUtils.centerDiv({ "divId":"reportTip","type":1, "callback":function(){ var num = $("#sns_more").attr("data-index"); AlertUtils.centerDivClosed({ indexNum:num, indexTipDiv:$("#sns_more"), type:1 }); $("#reportFrom").checkInput({ submitBtnFn: function (from) { Loading.loadInit({status:1}); var dataFrom = from.serializeJson(); dataFrom.shid = shid; dataFrom.suid = suid; dataFrom.fsuid = fsuid; dataFrom.cmmid = cmmid; dataFrom.msgid = msgid; dataFrom.type = type; AjaxFunUtils.ajaxInit({url: '/report/index.html', params:dataFrom, callback:function(res){ closeTip($("#reportTip")); AlertUtils.tips({ type:0, htmlmsg:'<div style="padding:30px">' + res.msg+'</div>' }); Loading.loadInit({status:0}); }, errCallback:function(){ Loading.loadInit({status:0}); } }) } }); } }); } }); }); }; $.fn.checkboxFn = function(options){ var settings = { checkbox:"checkbox", val:5, chird:0, scallback:function(){}, errorcallback:function(){} }; if(options){ $.extend(settings,options); } var $this = $(this); var falg = 0; $this.find("input[type="+settings.checkbox+"],textarea").each(function () { if ($(this).attr("checked")) { falg += 1; } if($(this).val() !== '' && settings.checkbox=='hidden'){ falg += 1; } if($(this).val() !== '' && $(this).attr("readonly")=='readonly'){ falg += 1; } if($(this).val() >= settings.val){ falg += 1; } }); if (falg > 0){ if(settings.chird == 1){ $this.find("input[type="+settings.checkbox+"],textarea").removeClass("error_validate"); }else{ $this.removeClass("error_validate"); } if(options.scallback){ settings.scallback($this); } return true; }else{ if(settings.chird == 1){ $this.find("input[type="+settings.checkbox+"],textarea").addClass("error_validate"); }else{ $this.addClass("error_validate"); } if(options.errorcallback){ settings.errorcallback($this); } return false; } }; var wxshare = function(options){ var settings = { title: '百享，做你自己！', link: 'http://www.byshare.com', imgUrl: 'http://demo.open.weixin.qq.com/jssdk/images/p2166127561.jpg', callback:function(){} }; if(options){ $.extend(settings,options); } $(".byshare_weixin").unbind("click").bind("click", function () { if(options.callback){ settings.callback(); } }); }; var znshare = function(options){ var settings = { ishid:'', shid:'', callback:function(){} }; if(options){ $.extend(settings,options); } $(".btn-share").unbind("click").bind("click", function () { if(options.callback){ settings.callback(); } var website = $(this).attr("data-iswebsite"); var shid = $(this).parents(".byshid").attr("data-shid"); var ishid = $(this).parents(".byshid").attr("data-ishid"); if(!shid){ shid = settings.shid; } if(!ishid){ ishid = settings.ishid; } var imgW = ""; var imgH = ""; var websiteData = ""; if(website){ var screenImage = $(this).attr("data-bigimgurl"); var maxW= 600; var maxH = 500; var theImage = new Image(); theImage.src = screenImage; imgW = theImage.width; imgH = theImage.height; if(imgW > maxW){ imgH = (maxW*imgH)/imgW; imgW = maxW; } if(imgH > maxH){ imgW = (maxH*imgW)/imgH; imgH = maxH; } websiteData = {imgUrl:screenImage,w:imgW,h:imgH}; } var dataiswebsite = website==1?website:0; ShareUtils.addShareInit(websiteData,{iswebsite:dataiswebsite,shid:shid,ishid:ishid,share:'share'}); }); }; var baiduShare = function(options){ var settings = { bdPic:'', bdText:'', url:'', title:'', desc:'', summary:'', site:'www.byshare.com', baidu:0 }; if(options){ $.extend(settings,options); } if(settings.baidu == 1){ window._bd_share_config={"common":{"bdSnsKey":{"tsina":3171756207},"bdText":"","bdMini":"2","bdPic":settings.bdPic,"bdStyle":"0","bdSize":"16"},"share":{}}; with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)]; }else{ var share_Sina = function(){ return '<a href="http://v.t.sina.com.cn/share/share.php?url='+encodeURIComponent(settings.url)+'&amp;title='+settings.title+'&amp;appkey=3171756207&amp;pic='+settings.bdPic+'" target="_blank" class="byshare_sns byshare_tsina" title="分享到新浪微博"></a>'; }; var share_qqQzone = function(){ return '<a href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+encodeURIComponent(settings.url)+'&title='+encodeURI(settings.title)+'&pics='+settings.bdPic+'&summary='+encodeURI(settings.summary)+'" target="_blank" class="byshare_sns byshare_qzone" data-cmd="qzone" title="分享到QQ空间"></a>'; }; var share_qq = function(){ return '<a href="http://connect.qq.com/widget/shareqq/index.html?url='+settings.url+'&showcount=0&desc='+encodeURI(settings.desc)+'&summary='+encodeURI(settings.summary)+encodeURI(settings.url)+'&title='+encodeURI(settings.title)+'&site='+settings.site+'&pics='+settings.bdPic+'" class="byshare_sns byshare_qzone" data-cmd="qzone" title="分享到QQ空间"></a>'; }; var share_weiXin = function(){ wx.onMenuShareTimeline({ title: '', link: '', imgUrl: '', success: function () { alert(11); }, cancel: function () { alert(222); } }); }; var html = ''; html += share_qqQzone(); html += share_Sina(); $('#share_sns').html(html); } }; var msgSendFrom = function(){ $("#msgsendForm").checkInput({ button:"#btn-sendmsg", submitBtnFn: function (subFrom,obj) { var $thisForm = $("#msgsendForm"); var $msginput = $thisForm.find(".msg-input"); var $msglist = $("#massegeBox").find(".msg-list"); var msgText = $thisForm.find(".content-input").val(); var myuid = $("#btn-sendmsg").attr("data-uid"); AjaxFunUtils.ajaxInit({url: '/message/sendmsg.html', params: {content:msgText,tosuid:myuid}, callback:function(res){ if(res.status == 1){ var msgHtml = '<li class="messageWrapper"><div class="cmmMessage isOwnMessage"> <em class="ico ico-caret"></em><p>'+msgText+'</p></div></li>'; $msglist.append(msgHtml); $thisForm.find(".content-input").val(''); var $messagesContent = $("#massegeBox").find(".messagesContent"); $messagesContent.scrollTop( $messagesContent[0].scrollHeight ); }else{ AlertUtils.tips({ htmlmsg:'<div style="padding:30px">' + res.msg+'</div>' }); } } }); } }); }; $.fn.setTagPos = function(){ var $this = $(this); var d_imgW = $this.width(); var y_imgW = $this.attr("data-width"); var proportion = d_imgW / y_imgW; $this.find(".item-tag").each(function(index, element) { var oldLeft = $(this).attr("data-left"); var oldTop = $(this).attr("data-top"); var newLeft = oldLeft*proportion; var newTop = oldTop*proportion; var p_w = d_imgW; var tag_form_w = $(this).find(".item-tag-form").width()+10; var flag_w = p_w - newLeft - tag_form_w; if(flag_w < 0){ $(this).find(".item-tag-form").css({"right":24,"left":"auto"}); $(this).find(".item-tag-form").find(".tip").addClass("tagRight"); } $(this).css({"left":newLeft,"top":newTop}).addClass("loaded"); }); }; var MsgMod = function(){ var msgInit = function(options){ var settings = { uid:'', shid:'', boradid:'', message:'' }; if(options){ $.extend(settings,options); }; if(settings.uid == suid && suid !== ""){ AlertUtils.tips({ type:0, htmlmsg:'<div style="padding:30px">'+lang.js_base_yourself+'</div>', scallback:function(){ closeTip($("#chatbox")); } }); return false; } var msgUserNum = $("#msgUserList").find(".msgUser").size(); if(msgUserNum > 5){ $("#msgUserList").find(".msgUser").eq(0).remove(); }; $("#btn-sendmsg").attr("data-uid",settings.uid); var btnmsgbind = function(){ $("#msgBox").find(".msgclose").unbind("click").bind("click",function(){ $("#msgListBox").hide(); $("#msgUserList").find(".msgimgbox").attr("data-isclick",0); }); $("#massegeBox").find(".masseg-heard").hover(function(){ $(this).find(".ico-reportMsgBtn").show(); },function(){ $(this).find(".ico-reportMsgBtn").hide(); }); msgSendFrom(); snsReport(); $("#msgBox").find(".msgimgbox").unbind("click").bind("click",function(e){ var $this = $(this); var $msgListBox = $("#msgListBox"); var isclick = $this.attr("data-isclick"); var isopen = $msgListBox.attr("data-isopen"); var uid = $this.attr("data-uid"); var msgid = $this.attr("data-msgid"); $("#btn-sendmsg").attr("data-uid",uid); $("#msgListBox").show(); getlightGray($this); if(isclick == 0){ $("#msgUserList").find(".msgimgbox").attr("data-isclick",0); $this.attr("data-isclick",1); $msgListBox.show(function(){ getMsgList(uid); }); return false; }else{ $("#msgUserList").find(".msgimgbox").attr("data-isclick",0); $this.attr("data-isclick",1); if(isopen == 1){ $msgListBox.attr("data-isopen",0); $msgListBox.hide(); return false; }else{ $msgListBox.attr("data-isopen",1); $msgListBox.show(); return false; }; } }); }; var getMsgList = function(ouid){ var $loading = $("<div class='lazy loadin_bg'></div>"); $("#massegeBox").append($loading); var myouid = ouid; var geturl = '/share/show_f_page.html?page=snsmsg&uid='+settings.uid+'&shid='+settings.shid+'&ucatid='+settings.boradid+'&message='+settings.message; if(myouid){ geturl = '/share/show_f_page.html?page=snsmsg&uid='+myouid+''; } AjaxFunUtils.ajaxInit({ url: geturl, type: "GET", dataType: 'html', params:{}, callback: function(data){ $("#massegeBox").html(data); var $messagesContent = $("#massegeBox").find(".messagesContent"); $messagesContent.scrollTop( $messagesContent[0].scrollHeight ); btnmsgbind(); $("#massegeBox").find(".avatar_loading").each(function(index, element) { $(this).checkImgExists(); }); } }); }; var getlightGray = function(thisObj){ var $thisObj; if(thisObj){ var $thisObj = thisObj; }else{ $("#msgUserList").find(".msgimgbox").each(function(index, element) { var isclick = $(this).attr("data-isclick"); if(isclick == 1){ $thisObj = $(this); } }); } var $msgListBox = $("#msgListBox"); var msgBoxtop = $("#msgBox").offset().top; var msgListBoxtHeight = $msgListBox.height(); var msgBoxHeight = $("#msgBox").height(); var thisTop = $thisObj.offset().top - msgBoxtop; var usertop = msgListBoxtHeight - msgBoxHeight + thisTop - 5; $msgListBox.find(".ico-lightGray").css({"top":usertop}); $msgListBox.show(); }; var getUserData = function(){ AjaxFunUtils.ajaxInit({ url:'/user/getuserbaseinfo.html', yzlogin:true, params:{suid:settings.uid}, callback:function(res){ if(res.status == 1){ var user = '<div class="msgUser" data-uid="'+res.data.suid+'">'+ '<div class="msgUserImg">'+ '<div class="msgimgbox" data-uid="'+res.data.suid+'" data-isclick="1"> '+ '<img class="head avatar_loading" src="'+res.data.avatar[2]+'" data-original="'+res.data.avatar[1]+'"> '+ '</div>'+ '<em class="ico ico-userclose" data-uid="'+res.data.suid+'"></em> '+ '</div>'+ '</div>'; $("#msgUserList").find(".msgimgbox").attr("data-isclick",0); $("#msgUserList").find(".msgUser").each(function(index, element) { var usrId = $(this).attr("data-uid"); if(usrId == settings.uid){ $(this).remove(); } }); $("#msgUserList").append(user); var userNum = $("#msgUserList").find(".msgUser").size(); if(userNum > 5){ $("#msgUserList").find(".msgUser").first().detach(); } $("#msgBox").fadeIn(); $("#msgUserList").find(".avatar_loading").each(function(index, element) { $(this).checkImgExists(); }); getlightGray(); }else{ AlertUtils.tips({ htmlmsg:'<div style="padding:30px">' + res.msg+'</div>' }); return false; }; $("#msgBox").find(".msgUserImg").hover(function(){ $(this).find(".ico-userclose").show(); },function(){ $(this).find(".ico-userclose").hide(); }); $("#msgBox").find(".ico-userclose").unbind("click").bind("click",function(){ var $msgUser = $(this).parents(".msgUser"); var isclick = $(this).siblings(".msgimgbox").attr("data-isclick"); if(isclick == 1){ $("#msgListBox").hide(); }; $msgUser.remove(); }); } }); }; getMsgList(); }; return {msgInit:msgInit}; }(); var Loading = function(){ var loadInit = function(options){ var $loadingBox = $('<div class="loadingMask" style="z-index:999999"></div>'); var settings = { status:1 }; if(options){ $.extend(settings,options); }; if(settings.status==1){ $("body").append($loadingBox); }else{ $(".loadingMask").remove(); }; }; return {loadInit:loadInit}; }(); $.fn.checkImgExists = function(callback) { $(this).each(function(index, element) { var $this = $(this); var imgurl = $this.attr("data-original"); var odimgurl = $this.attr("src"); var ImgObj = new Image(); ImgObj.src = imgurl; ImgObj.onload = function() { $this.attr("src",imgurl); if(callback){ var opt = {w:ImgObj.width,h:ImgObj.height}; callback($this,imgurl,opt); } }; ImgObj.onerror = function() { if(callback){ callback($this,odimgurl); } }; }); }; $.fn.boxslider=function(options){ var $this = $(this); var defaults={ isshow:0, autoplay: true, mode : "hover", number : false, speed : 10000, callback:null }; var defaults = $.extend(defaults, options); var sWidth=$(this).width(); var len = $(this).children(".boxslider").children("li").length; var index=0; var picTimer = 500; var $thisp = $this.parent("div"); if(options.callback){ defaults.callback(); } if(defaults.isshow){ var $left=$('<a class="boxslider-left boxslider-btn" style="display: inline;" href="javascript:void(0);"></a>'); var $right= $('<a class="boxslider-right boxslider-btn" style="display: inline;" href="javascript:void(0);"></a>'); $thisp.append($left); $thisp.append($right); }else{ return false; } for(i=0;i<len;i++){ if(defaults.number){ str="<a>"+(i+1)+"</a>"; }else{ str="<a></a>"; } $(this).children(".boxslider-num").append(str); } var $slide_num=$(this).children(".boxslider-num").children("a"); var $slider=$(this).children(".boxslider"); $slider.css("width",sWidth*len+"px"); $slide_num.eq(0).addClass("on"); $slide_num.on(defaults.mode,function(){ $(this).addClass("on").siblings(".on").removeClass("on"); }); $left.bind("click",function(){ index-=1; if(index == -1) {index = len - 1;} showPics(index); }); $right.bind("click",function(){ index+=1; if(index == len) {index = 0;} showPics(index); }); $slide_num.bind(defaults.mode,function(){ showPics($(this).index()); }); $thisp.hover(function() { $left.show(); $right.show(); clearInterval(picTimer); },function() { $left.hide(); $right.hide(); if(defaults.autoplay){ picTimer = setInterval(function() { showPics(index); index++; if(index == len) {index = 0;} },defaults.speed); } }).trigger("mouseleave"); if(defaults.autoplay){ } function showPics(index) { var nowLeft = -index*sWidth; $slider.stop(true,false).animate({"left":nowLeft},300); $slide_num.removeClass("on").eq(index).addClass("on"); if(options.callback){ defaults.callback(); } } }; $.fn.slidepic = function(options){ var settings = { scrollContId:'slide_01', slide_01_dot:'slide_01_dot', selected:'selected', sl_left:'sl_left', sl_right:'sl_right', speed:10, space:30, autoPlay:true, scallback:null, callback:null, imgwcallback:null }; if(options){ $.extend(settings,options); } if($(this).size() <=0){ return false; } var w = $("#bodywidth").width(); $(this).find(".mod_01").css({"width":w}).show(); var slide_01 = new ScrollPic(); slide_01.scrollContId = settings.scrollContId; slide_01.dotListId = settings.slide_01_dot; slide_01.dotOnClassName = settings.selected; slide_01.arrLeftId = settings.sl_left; slide_01.arrRightId = settings.sl_right; slide_01.frameWidth = w; slide_01.pageWidth = w; slide_01.upright = false; slide_01.speed = settings.speed; slide_01.space = settings.space; slide_01.autoPlay = settings.autoPlay; slide_01.callback = function(obj_num){ if(options.scallback){ settings.scallback(obj_num); } }; slide_01.imgwcallback = function(){ if(options.imgwcallback){ settings.imgwcallback(); } }; slide_01.initialize(); if(options.callback){ settings.callback(); } }; var isNull = function( str ){ if ( str == "" ) return true; var regu = "^[ ]+$"; var re = new RegExp(regu); return re.test(str); }; var getcommentlist = function(options){ var settings = { shareid:'', plnum:'', pl_num:'', num:2, pl_list:'', pl_box:$(".test"), type:'' }; if(options){ $.extend(settings,options); } if(shareView){ settings.num = 4; } AjaxFunUtils.ajaxInit({url:"/comment/read.html", params: { 'page': 1, 'pagenum':settings.num,"ajax":1 ,'shid':settings.shareid}, callback:function(res){ var li_html = ''; var li_more = '<li class="text-right mt-15"><p class="blank5"></p><a href="/share/sharepage.html?shid='+settings.shareid+'" class="color-blue">查看所有更多评论</a></li>'; if(shareView){ li_more = ''; } $.each(res.data.rows,function(index,o){ if(o.isme){ var reportAndDel = '<span class="fr shareBtn reportComment delCommentBtn" data-cmmid="'+o.cmmid+'" data-shid="'+o.shid+'"><em class="ico ico-delComment"></em></span>'; }else{ var reportAndDel = '<span class="fr shareBtn reportComment reportBtn" data-type="comment" data-cmmid="'+o.cmmid+'" data-shid="'+o.shid+'"><em class="ico ico-reportComment"></em></span>'; } var reuser = ''; if(o.fsuid > 0){ reuser = ' 回复 <span class="color-blue btn-addpl" data-fsuid="'+o.fsuid+'" data-fuid_uname="'+o.fuid_uname+'">'+o.fuid_uname+'</span>'; } var commentTem = '<li class="rowbox">'+ '<a href="/share/myshares.html?fsuid='+o.suid+'&ukey='+ukey+'"><div class="rowbox avatar useravatar_bg w30 mr-5 mt-5">'+ '<img class="userThumb avatar_loading" src="'+o.avatar[2]+'" data-original="'+o.avatar[1]+'">'+ '</div></a>'+ '<div class="row-flex1 avatar-text">'+ '<div class="commenterWrapper">'+ '<span class="color-blue btn-addpl" data-fsuid="'+o.suid+'" data-fuid_uname="'+o.fname+'">'+o.fname+'</span>'+ ''+reuser+'<span class="color-999"> • '+o.edttime+'</span>'+ ''+reportAndDel+''+ '</div>'+ '<div class="shareDesc color-555">'+o.comment+'</div>'+ '</div>'+ '</div>'; li_html +=commentTem; }); settings.pl_list.html(li_html+li_more); settings.plnum.text(settings.pl_num).attr("data-plnum",settings.pl_num); settings.pl_list.find("img.avatar_loading").checkImgExists(function(obj,imgurl){ var $myopj = obj; var myimgurl = imgurl; var $thisp = $myopj.parent(".useravatar_bg"); $thisp.css({"background": "url("+myimgurl+") no-repeat","background-size": "cover"}); }); commentBtnBind(); commentDel(); } }); }; var commentBtnBind = function(){ $(".btn-addpl").unbind("click").bind("click", function () { event.stopPropagation(); var fsuid = $(this).attr("data-fsuid"); var shareid = $(this).parents(".byshid").attr("data-shid"); var $pl_box = $(this).parents(".byshid"); var $pl_list = $pl_box.find(".pl-list"); var $plnum = $pl_box.find(".plnum"); var pl_num = Number($plnum.attr("data-plnum")); var title = $(this).attr("data-fuid_uname"); if(title){ title = '回复'+$(this).attr("data-fuid_uname"); }else{ title = '亲，请输入您的评论内容'; } $("#sns_pltip").show(); $("#sns_pltip").find(".closeBtnHtml").unbind("click").bind("click",function(){ $("#sns_pltip").hide(); }); BaseInitClass.upcontainer({ callback:function(){ $("#sns_pltip").hide(); } }); if($("#myeditable").size() <=0){ editorInit(title); } $("#myeditable").contents().find("#message").focus(); var $thisForm = $("#sns_plform"); addComment({addCommentForm:$thisForm, fsuid:fsuid, shid:shareid, callback:function(){ $("#sns_pltip").hide(); $("#meditortxt").val(''); $("#myeditable").contents().find("#message").html('&nbsp;'); pl_num = pl_num + 1; getcommentlist({shareid:shareid,pl_list:$pl_list,pl_box:$pl_box,plnum:$plnum,pl_num:pl_num}); } }); $(document).unbind("click").bind('click',function(e){ var target = $(e.target); if(target.closest("#sns_pltip").length == 0){ $("#sns_pltip").hide(); }; }); }); }; var addComment = function(options){ var settings = { addCommentForm:'.addCommentForm', commentBtn:'.commentBtn', shid:'', fsuid:'', callback:function(){} }; if(options){ $.extend(settings,options); } var $addCommentForm = $(settings.addCommentForm); $addCommentForm.checkInput({ button:settings.commentBtn, inputs:{ "comment":{isempty: [0],focusMsg: '',rightMsg: "",errorMsg:'valid'} }, submitBtnFn: function (from) { var dataFrom = from.serializeJson(); dataFrom.shid = settings.shid; dataFrom.shareid = settings.shid; dataFrom.fsuid = settings.fsuid; $addCommentForm.find(".btn-danger").removeClass("commentBtn").addClass("btn-danger-gray"); AjaxFunUtils.ajaxInit({ "url":"/comment/add_comment.html", "yzlogin":true, "params":dataFrom, "callback":function (result) { $addCommentForm.find(".btn-danger").addClass("commentBtn").removeClass("btn-danger-gray"); if(result.status){ $addCommentForm.find("textarea").val(""); if(options.callback){ settings.callback(); } }else{ AlertUtils.tips({ w:"96%", htmlmsg:'<div style="padding:30px">' + result.msg+'</div>' }); } } }); } }); }; var getWidthBody = function(){ var bodyWidth = 0; if (browser.versions.ios || browser.versions.iPhone || browser.versions.iPad) { bodyWidth = window.screen.availWidth; }else if (browser.versions.android) { bodyWidth = $("body").width(); }else{ bodyWidth = $("body").width(); } return bodyWidth; }; var getHeightBody = function(){ var bodyHeight = 0; if (browser.versions.ios || browser.versions.iPhone || browser.versions.iPad) { bodyHeight = window.screen.availHeight; }else if (browser.versions.android) { bodyHeight = $(window).height(); }else{ bodyHeight = $(window).height(); } return bodyHeight; }; var allsearch = function(){ $(".searchstart").unbind("focus").bind("focus",function(){ var placeholder = $(this).attr("data-placeholder"); var searchtype = $(this).attr("data-searchtype"); searchInt({placeholder:placeholder,searchtype:searchtype}); }); $(".searchtop").unbind("click").bind("click",function(){ var placeholder = $(this).attr("data-placeholder"); var searchtype = $(this).attr("data-searchtype"); searchInt({placeholder:placeholder,searchtype:searchtype}); }); function searchInt(opt){ var $searchbox = $('<div id="search-modalMask" class="modalMask" style="z-index:9996;display: block"></div>'); $('body').append($searchbox); var searchUrl = '/common/gettpl.html?name=sns_searchinput&ch=sns'; if(opt.searchtype == "weixingroup"){ searchUrl = '/common/gettpl.html?name=sns_searchgroup&ch=sns'; } AjaxFunUtils.ajaxInit({url: searchUrl, type: "GET", dataType: 'html', params:{}, callback: function(data){ $("body").append(data); var searchtyleval = "goods"; $("#searchinput").addClass("loaded"); $("#newsearchInt").focus(); $("#searchtyleval").val(searchtyleval); selectsearchType(); searchTagbox(); closeSearch(); $("#qingkong_btn").unbind("click").bind("click",function(){ AjaxFunUtils.ajaxInit({ url:'/m_search/clearwords.html', params:'', callback:function(res){ if(res.status == 1){ $("#searchTagbox").html(''); $("#qingkong_btn").hide(); } } }); }); } }); }; function selectsearchType(){ $("#s-input-tab-txt").unbind("click").bind("click",function(){ var isshow = $("#J_TabNav").is(":hidden"); if(isshow){ $("#J_TabNav").show(); }else{ $("#J_TabNav").hide(); } }); $("#s-input-tab-txt").find("li").unbind("click").bind("click",function(){ var thisval = $(this).text(); var thisval_type = $(this).attr("data-val"); $("#s-input-val").text(thisval); $("#s-input-val").attr("data-type",thisval_type); $("#searchtyleval").val(thisval_type); searchTagbox(); }); }; function closeSearch(){ $('#closeSearch,#search-modalMask').unbind("click").bind('click',function(){ $("#searchinput").remove(); $("#search-modalMask").remove(); }); } function searchTagbox(osearchtype){ var thisT = $("#searchtyleval").val(); var val = ''; $("#newsearchInt").unbind('input').bind('input', function(){ var $thisIput = $(this); thisT = $("#s-input-val").attr("data-type"); val = $.trim($thisIput.val()); ajaxSearch(); }); ajaxSearch(); function ajaxSearch(){ AjaxFunUtils.ajaxInit({ url:'/m_search/getwordlists.html?t='+thisT+'&s='+val+'', params:{}, callback:function(res){ if(res.status){ $("#searchTagbox").show(); var resSearchData = res.data.keyword; var lihtml ='<li class="li-title">历史记录</li>'; if(val==''){ lihtml ='<li class="li-title">历史记录</li>'; $("#qingkong_btn").show(); } $.each(resSearchData,function(index,keyword){ lihtml+='<li><a href="/m_search/search.html?t='+thisT+'&s='+encodeURIComponent(keyword.val)+'" data-val='+keyword.val+'>'+keyword.val+'</a></li>'; }); $("#searchTagbox").html(lihtml); }else{ $("#searchTagbox").hide(); $("#qingkong_btn").hide(); } } }); } }; }; var customerservice = function(options){ var settings = { type:1, check_id:'', callback:null }; $.extend(settings,options); AjaxFunUtils.ajaxInit({ url: '/user/get_svr_weixin.html', params:{}, callback:function(res){ if(res.status==1){ if(options.callback){ settings.callback(res.data.url); return false; } var htmlmsg = '<div class="text-center line24 f16"><p>（长按下图3秒加我们客服微信）</p><p class="text-center"><img class="w300" style="margin:0 auto" src="'+res.data.url+'" /></p></div>'; if(settings.type == 2){ htmlmsg = '<div class="text-center f28 color-333 line40"><p>长按复制提现码:</p><p class="b f28 color-333 line40">'+settings.check_id+'</p><p class="f21 b color-red line30">请长按下图</br>识别图中二维码加客服</br>粘贴发送提现码给客服<p class="text-center"><img class="w200" style="margin:0 auto" src="'+res.data.url+'" /></p></div>'; } var ImgObj = new Image(); ImgObj.src = res.data.url; ImgObj.onload = function() { AlertUtils.tips({ htmlmsg:'<div style="padding:10px 10px">'+htmlmsg+'</div>', type:0, title:'联系客服', callback:function(){ $(".tipbottom").hide(); }, closeback:function(){ window.location.reload(); } }); }; } } }); }; var sideMenu = function(){ var bodyW = $("#bodywidth").width(); var side_w = bodyW*0.8; $(".mylist").unbind("click").bind("click",function(event){ event.stopPropagation(); var is_div = $("#side-menu").length; if(is_div <= 0){ var $sidebox = $('<div id="side-modalMask" class="modalMask"></div><div id="side-menu" class="side-menu sb-slidebar" style="margin-left:'+-side_w+'px;width:'+side_w+'px"><div id="closeside" class="closeHead"><span class="ico02 closeside"></span></div></div>'); $('body').append($sidebox); AjaxFunUtils.ajaxInit({url:"/user/settinglist.html", type: "GET", dataType: 'html', params:{}, callback: function(data){ $("#side-menu").append($(data).find(".settings").html()); $("#side-menu").find("img.avatar_lazy").checkImgExists(function(obj,imgurl){ var $myopj = obj; var myimgurl = imgurl; var $thisp = $myopj.parent(".useravatar_bg"); $thisp.css({"background": "url("+myimgurl+") no-repeat","background-size": "cover"}); }); } }); } var flag_show = $("#side-menu").is(":visible"); var flag = 1; if(flag){ $("#side-modalMask").show().css({"z-index":9998}); $("#side-menu").show().css({"transform": "translate("+side_w+"px)","z-index":9999}); flag = 0; }else{ $("#side-modalMask").hide(); $("#side-menu").css({"transform": "translate(0px)"}); flag = 1; } }); $("body").delegate("#closeside","click",function(){ $("#side-menu").css({"transform": "translate(0px)"}); $("#side-modalMask").hide(); }); $(document).bind('click',function(e){ var target = $(e.target); if(target.closest("#side-menu").length == 0){ $("#side-menu").css({"transform": "translate(0px)"}); $("#side-modalMask").hide(); }; }); }; var creatWeixinGroup = function(){ var bodyW = $("#bodywidth").width(); var side_w = bodyW*0.8; var selectCat = function(opt){ if(opt.catid_area){ var select_cat_text = ''; if(opt.catid_type == 1){ select_cat_text += '明星,'; }else if(opt.catid_type == 2){ select_cat_text += '街拍达人,'; }else{ select_cat_text += '模特,'; } $("#user_group_area").find(".li_click").each(function(index, element) { if(index+1 == opt.catid_area){ var thisText = $(this).text(); select_cat_text += thisText; } }); if(opt.catid_sex == 1){ select_cat_text += ',男'; }else{ select_cat_text += ',女'; } $("#select_cat_text").html(select_cat_text); } $("#group_cat").unbind("click").bind("click",function(ocatid){ AjaxFunUtils.ajaxInit({url: '/common/gettpl.html?name=sns_grouptype&ch=sns', isloading:true, yzlogin:true, type: "GET", dataType: 'html', params:{}, callback: function(data){ $("body").append(data); var catListHtml = $("#user_group_area").html(); $("#catlist_area").html(catListHtml); AlertUtils.centerDiv({ "divId":"sns_grouptype", "type":1, "callback":function(){ var isSelectval_type = $("#select_cat_type").val(); var isSelectval_area = $("#select_cat_area").val(); var isSelectval_sex = $("#select_cat_sex").val(); isselected(); $("#catlist_type").find(".li_click").each(function(index, element) { var thisVal = $(this).attr("value"); if(thisVal == isSelectval_type){ $(this).addClass("current"); isselected(); } }); $("#catlist_area").find(".li_click").each(function(index, element) { var thisVal = $(this).attr("value"); if(thisVal == isSelectval_area){ $(this).addClass("current"); isselected(); } }); $("#catlist_sex").find(".li_click").each(function(index, element) { var thisVal = $(this).attr("value"); if(thisVal == isSelectval_sex){ $(this).addClass("current"); isselected(); } }); $(".catlist").find(".li_click").unbind("click").bind("click",function(){ $(this).addClass("current"); $(this).siblings(".li_click").removeClass("current"); isselected(); }); } }); } }); function isselected(){ var flag_type = false; var flag_sex = false; var flag_area = false; $("#catlist_type").find("li").each(function(index, element) { var iscurrent = $(this).hasClass("current"); if(iscurrent){ flag_type = true; } }); $("#catlist_sex").find("li").each(function(index, element) { var iscurrent = $(this).hasClass("current"); if(iscurrent){ flag_sex = true; } }); $("#catlist_area").find("li").each(function(index, element) { var iscurrent = $(this).hasClass("current"); if(iscurrent){ var thisVal = $(this).attr("value"); flag_area = true; } }); if(flag_type && flag_area && flag_sex){ $("#sns_grouptype").find(".btn-danger").addClass("btnTipsubmit").removeClass("btn-danger-gray"); $("#sns_grouptype").find(".btnTipsubmit").unbind("click").bind("click",function(){ quedingSub(); }); }else{ $("#sns_grouptype").find(".btn-danger").removeClass("btnTipsubmit").addClass("btn-danger-gray"); } } function quedingSub(){ var thisText = ''; $("#catlist_type").find("li").each(function(index, element) { var iscurrent = $(this).hasClass("current"); if(iscurrent){ var thisVal = $(this).attr("value"); thisText += $(this).text()+','; $("#select_cat_type").val(thisVal); } }); $("#catlist_area").find("li").each(function(index, element) { var iscurrent = $(this).hasClass("current"); if(iscurrent){ var thisVal = $(this).attr("value"); thisText += $(this).text()+','; $("#select_cat_area").val(thisVal); } }); $("#catlist_sex").find("li").each(function(index, element) { var iscurrent = $(this).hasClass("current"); if(iscurrent){ var thisVal = $(this).attr("value"); thisText += $(this).text(); $("#select_cat_sex").val(thisVal); } }); $("#select_cat_text").text(thisText); closeTip($("#sns_grouptype")); } }); }; var getGroupList = function(){ AjaxFunUtils.ajaxInit({url:"/user_group/add_pin_groups.html ", params: {ajax:1}, callback: function(res){ if(res.status == 1){ if(!res.data){ $("#groupList").hide(); return false; } var htmllist='<input name="gpid" id="gpid" value="" type="hidden">'; $.each(res.data,function(index,o){ var lihtml = '<li style="padding-right:20px" class="rowbox li_radio_p"><span class="ico groupavatar"><img src="'+o.avatar[2]+'" data-original="'+o.avatar[1]+'" class="lazy_groupavatar"></span><div class="row-flex1 line40"><label for="'+o.gpid+'" class="row-flex1 label li_radio" style="line-height:60px;background-position: right 18px;" data-gpid="'+o.gpid+'">'+o.gpname+'</label></div></li>'; htmllist +=lihtml; }); $("#group_cat_share").find(".group_categoryList").html(htmllist); $("img.lazy_groupavatar").checkImgExists(); $(".li_radio").unbind("click").bind("click",function(){ var ischecked = $(this).hasClass("current"); var thisgpid = $(this).attr("data-gpid"); if(ischecked){ $(this).removeClass("current"); $("#gpid").val(''); }else{ $("#gpid").val(thisgpid); $(this).addClass("current"); $(this).parents(".li_radio_p").siblings(".li_radio_p").find(".li_radio").removeClass("current"); } }); } $("#group_cat_share").selectUtils({ deNum:0, isDef:true, callback:function(j,i){ var select_analog = $("#group_cat").find('input'); checkInputFun.initContext(select_analog, checkInputFun.myIt); select_analog.siblings("p").show(); checkInputFun.mycheckIn(select_analog); $("#group_cat").siblings(".select_box").find('span').html('选择分类').removeClass('active'); $("#group_cat").siblings(".select_box").find('.select_analog ').val(''); } }); } }); }; var upGroupAvatar = function(options){ var settings = { gpid:'', pic_avatar:'', pic_qrcode:'', pic_figure:'', btn:'', avatartype:'', auto_start:false, callback:null }; if(options){ $.extend(true,settings,options); } BaseInitClass.loginCheck(); settings.btn.unbind("click").bind("click",function(){ var $this = $(this); var inputName = $(this).attr("data-name"); var avatar = $(this).attr("data-avatar"); var type = $this.attr("data-type"); var act = $this.attr("data-act"); var picname = settings.pic_avatar; var title = $this.attr("data-title"); var $imgbox = $this.siblings(".uppro_pic_list"); var ismult = false; var fileNumLimit = 1; if(type == 3){ ismult = true; fileNumLimit = 3; } if(type == "qrcode"){ picname = settings.pic_qrcode; } if(type == "figure"){ picname = settings.pic_figure; } if(avatar){ picname = avatar; } UploadUtils.uploadInit({ tip:true, uptitle:title, container:'allcontainer', browse_button:'allpickfiles', drop_element:'allcontainer', bucket:'avatar', iscover:true, auto_start:settings.auto_start, multi_selection:false, picname:picname, typebucket:2, callback:function(arrData,odomain){ AjaxFunUtils.ajaxInit({ url: '/common/avatar_up_cmm_back.html', params:{act:act,type:type,gpid:settings.gpid,ch:'up',cutsize:''}, callback: function(resin){ var opt = {arrData:arrData,odomain:odomain,resin:resin,btn:$this}; if(options.callback){ settings.callback(opt); } } }); } }); }); }; var creatWeixinGroup_share = function(){ $(".creatGroupBtn").unbind("click").bind("click",function(event){ var loginflag = BaseInitClass.loginCheck(); if(!loginflag){ return false; } event.stopPropagation(); AjaxFunUtils.ajaxInit({url:"/user_group/add.html", type: "post", yzlogin:true, params: {ajax:1}, callback: function(res){ if(res.status == 1){ var $groupbox = $('<div id="creatGroupTipbox" class="tipbox fade" data-index="0" style="display:none;"><div class="tipbox-in"><h1 class="tiptop">绑定微信群</h1><span class="ico02 tipclose closeBtnHtml"></span><div class="tipcont" id="creatGroupCont"></div>'); $('body').append($groupbox); $("#creatGroupCont").html($(res.data).find(".contentbox").html()); AlertUtils.centerDiv({ divId:"creatGroupTipbox", callback:function(){ addgrouppage({type:'share'}); } }); }else{ AlertUtils.tips({ htmlmsg:'<div style="padding:30px">' + res.msg+'</div>', type:0 }); } } }); }); }; var addgrouppage = function(opt){ var settings = { type:'' }; if(opt){ $.extend(true,settings,opt); } selectCat({}); $("#creatGroupForm").checkInput({ submitBtnFn: function (from) { var dataFrom = from.serializeJson(); var actUrl = $("#creatGroupForm").attr("data-action"); AjaxFunUtils.ajaxInit({ url:actUrl, params:dataFrom, callback:function (result) { if(result.status == 1){ window.location.href='/user_group/home.html?gpid='+result.data.gpid+'&ukey='+ukey; $("#creatbtn_wc").unbind("click").bind("click",function(){ if(settings.type == "share"){ closeTip($("#creatGroupTipbox")); }else{ window.location.href='/user_group/my.html'; } }); }else{ AlertUtils.tips({ htmlmsg:'<div style="padding:30px">'+result.msg+'</div>', w:"90%", type:0 }); } } }); } }); function isimg(){ var isupflag = false; $(".uppro_pic").each(function(index, element) { $(this).checkboxFn({ checkbox:'hidden', scallback:function(othis){ othis.removeClass("error_validate"); isupflag = true; }, errorcallback:function(othis){ othis.addClass("error_validate"); isupflag = false; } }); return isupflag }); return isupflag; } function bindUpheadler(options){ var settings = { picname:'' }; if(options){ $.extend(true,settings,options); } up_rzpic(); function up_rzpic($obtn){ var $btn = $(".up_rzpic"); if($obtn){ $btn = $obtn; } upGroupAvatar({ gpid:settings.gpid, pic_avatar:settings.pic_avatar, pic_qrcode:settings.pic_qrcode, pic_figure:settings.pic_figure, btn:$btn, callback:function(opt){ var lihtml = '<li class="li_del"><input type="hidden" class="hideimageurl" name="'+opt.inputName+'" value="/'+opt.arrData.key+'"><img src="'+opt.resin.data+'" /><div class="operate"><i class="ico del"></i></div></li>'; opt.imgbox.find("ul").append(lihtml); hoverImg(opt.imgbox,opt.btn,opt.type); isup(opt.imgbox,opt.btn,opt.type); delImg(opt.imgbox,opt.btn,opt.type); } }); } function hoverImg($imgbox,$this,type){ $imgbox.show(); $imgbox.find("li").hover(function(){ $(this).find(".operate").show(); },function(){ $(this).find(".operate").hide(); }); } function delImg($imgbox,$this,type){ $imgbox.find(".del").unbind("click").bind("click",function(){ $(this).parents("li.li_del").remove(); var num = $imgbox.find("li").size(); if(num <= 0){ $imgbox.hide(); } isup($imgbox,$this,type); }); } function isup($imgbox,$this,type){ isimg($imgbox,$this,type); var num = $imgbox.find("li").size(); var maxNum = 1; if(type == 3){ maxNum = 3; } var flg = true; if(num >= maxNum ){ $this.addClass("btn-danger-gray"); $this.unbind("click"); flg = false; return flg; }else{ $this.removeClass("btn-danger-gray"); up_rzpic($this); maxNum = maxNum - num; return flg; } } } }; return {creatWeixinGroup_share:creatWeixinGroup_share,addgrouppage:addgrouppage,getGroupList:getGroupList,selectCat:selectCat,upGroupAvatar:upGroupAvatar}; }(); var pjaxClass = function(){ var pjaxInt = function(){ return false; if($("#appendbox").length>0){ return false; } $('body').append('<div id="appendbox"></div>'); $('body').append('<div id="loadingMask" class="loadingMask" style="z-index:9989;display:none"></div>'); $(document).pjax('a.pjax', '#appendbox'); $(document).on('pjax:send', function() { $('#loadingMask').show(); }); $(document).on('pjax:complete', function() { $("#viewpage").find(".contentbox").addClass('viewpage canClose'); $("#viewpage").find(".headerbox_view").css({"z-index":1003}); $("#appendbox").append('<div class="viewpage_bg" style="z-index:1001;"></div>'); $('#loadingMask').hide(); $('body').addClass("noScroll"); var type = 'goods'; ShareView.shareViewInit({type:type}); shareView = 1; }); }; return {pjaxInt:pjaxInt}; }(); $.fn.stopscroll = function(options){ var settings = { callback:null }; $.extend(settings,options); $(this).bind("touchmove",function(e){ e.preventDefault(); }); }; var windowscrollInt = function(){ var carfooter = $("#carfooter").size() >0?1:0; windowscroll(function(direction) { var mydirection = direction; if(mydirection == 'up'){ $("#headerbox").show(); if(!carfooter){ $("#footerbox").show(); } }else if(mydirection == 'down'){ if(!carfooter){ $("#footerbox").hide(); } $("#headerbox").hide(); }else{ } }); function windowscroll( fn ) { var beforeScrollTop = document.body.scrollTop, fn = fn || function() {}; window.addEventListener("scroll", function() { var afterScrollTop = document.body.scrollTop, delta = afterScrollTop - beforeScrollTop; if( delta === 0 ) return false; fn( delta > 0 ? "down" : "up" ); beforeScrollTop = afterScrollTop; }, false); } }; var shareweinxtip = function(opt){ var num = $(".share_tip").size(); var share_bg = $('<div id="share_bg_'+num+'" class="share_bg" data-index="'+num+'"></div>'); var share_tip = $('<div id="share_tip_'+num+'" class="share_tip '+opt.class+'" data-index="'+num+'"></div>'); $('body').append(share_bg); $('body').append(share_tip); $("#share_bg_"+num).show().css({"z-index":num+99990}); $("#share_tip_"+num).show().css({"z-index":num+99991}); if(opt.callback){ opt.callback($("#share_tip_"+num),$("#share_bg_"+num)); } if(opt.isclose != 0){ $("#share_tip_"+num).unbind("click").bind("click",function(){ $("#share_tip_"+num).remove(); $("#share_bg_"+num).remove(); }); } }; var gzweixin = function(opt){ var settings = { callback:null, errcallback:null }; $.extend(true,settings,opt); AjaxFunUtils.ajaxInit({ "url":'/user/weixin_isguanzhu.html', "params":{}, "callback":function (res) { isback = 1; $("#testStatus").text(res.status); if(res.status == 1){ isgzweixin = 1; if(opt.callback){ settings.callback(); } }else if(res.status == -1){ if(islogin == 0){ window.location.href = '/index/reg.html'; } AlertUtils.tips({ htmlmsg:'<div style="padding:30px">'+res.msg+'</div>', type:0, scallback:function(){ window.location.href = "http://mp.weixin.qq.com/s?__biz=MzA3NTM5Mzg2NA==&mid=206134523&idx=1&sn=b052274af6c6633a2e2db14c7a10e577#rd"; } }); }else{ var top = 0; if($(".headerbox").length>0){ top = $(".headerbox").height(); } $("#gzweixin").css({"top":top}).show(); $("#gzclose").unbind("click").bind("click",function(){ $("#gzweixin").hide(); }); if(opt.errcallback){ settings.errcallback(res.msg); } } } }); }; var chooseFn = function(){ var chooseInt =function(opt){ var ischoose = $("#choose-list-modalMask").size(); if(ischoose <= 0){ AjaxFunUtils.ajaxInit({ url: '/m_buy/get_cats.html', params:{}, callback:function(res){ if(res.status == 1){ var cats = res.data.cats; var price = res.data.price; var li_html = ''; $.each(cats,function(index,o){ li_html += '<li id="li_catids_'+index+'" class="rowbox li_click" data-index="'+index+'" data-catids=""><div class="row-flex1">'+o.name+'</div><div id="catids_'+index+'" class="catids_text">不限</div><div class="ico ico-jt"></div></li>'; }); var ch_html = '<div id="choose-list-modalMask" class="modalMask" style="display:block; z-index: 9998;"></div>'+ '<div id="choose-list" class="custom-list choose-list" style="display:block;">'+ '<div class="choose_heard">'+ '<div class="top_l"><span id="choose-close" class="ico ico-back-h choose-close" data-type="b"></span></div>'+ '<div id="choose_sub_btn" class="top_r f16" data-type="b">确定</div>'+ '<h2 class="text-center line40">筛选</h2>'+ '</div>'+ '<div class="choose_cont">'+ '<div id="choose_cont_b">'+ '<ul class="jsbox">'+li_html+'</ul>'+ '<ul class="jsbox">'+ '<li id="li_catids_price" class="rowbox li_click" data-index="price" data-catids="" data-min_price="" data-max_price="">'+ '<div class="row-flex1">价格'+ '</div>'+ '<div id="li_price_text" class="catids_text">不限</div>'+ '<div class="ico ico-jt"></div>'+ '</li>'+ '</ul>'+ '</div>'+ '<div id="choose_cont_s"></div>'+ '</div>'+ '<div class="text-center mt-10"><button type="button" id="clear_btn" class="btn w100">清除选项</button></div>'+ '</div>'; $('body').append(ch_html); choosestype({cats:cats,price:price}); } } }); }else{ $("#choose-list-modalMask,#choose-list").show(); } $("#choose-list-modalMask").stopscroll({}); }; var choosestype = function(opt){ $("#choose-list-modalMask").unbind("click").bind("click",function(){ $("#choose-list").hide(); $("#choose-list-modalMask").hide(); }); $("#clear_btn").unbind("click").bind("click",function(){ $("#choose_cont_b").find(".li_click").each(function(index, element) { $(this).attr("data-catids",""); $(this).find(".catids_text").text("不限"); }); }); $("#choose-list").find(".li_click").unbind("click").bind("click",function(){ var thisindex = $(this).attr("data-index"); if(thisindex == 'price'){ var li_html = ''; $.each(opt.price,function(index,o){ li_html += '<li class="rowbox li_click_s" data-type="price" data-catid="'+o.min_price+'-'+o.max_price+'" data-min_price="'+o.min_price+'" data-max_price="'+o.max_price+'"><div class="row-flex1">'+o.min_price+' - '+o.max_price+'</div><i class="b_ico tick"></i></li>'; }); var s_typehtml = '<ul class="jsbox">'+li_html+'</ul>'; }else{ var li_html = ''; $.each(opt.cats[thisindex].son,function(index,o){ li_html += '<li class="rowbox li_click_s" data-type="s_type" data-catid="'+o.catid+'" data-text="'+o.name+'"><div class="row-flex1">'+o.name+'</div><i class="b_ico tick"></i></li>'; }); var s_typehtml = '<ul class="jsbox">'+li_html+'</ul>'; } $("#choose_cont_s").html(s_typehtml); $("#choose_cont_b").hide(); $("#clear_btn").hide(); $("#choose_sub_btn").attr("data-type","s"); $("#choose_sub_btn").attr("data-index",thisindex); $("#choose-close").attr("data-type","s"); $("#choose-close").attr("data-index",thisindex); var num = 0; if(thisindex == 'price'){ var thisprice = $("#li_price_text").html(); $("#choose_cont_s").find(".li_click_s").each(function(index, element) { var thiscatid = $(this).attr("data-catid"); if(thiscatid == thisprice){ $(this).addClass("current"); } }); }else{ var catids = $(this).attr("data-catids"); catids = catids.split("|"); $("#choose_cont_s").find(".li_click_s").each(function(index, element) { var thiscatid = $(this).attr("data-catid"); var $lithis = $(this); $.each(catids,function(index,o){ if(thiscatid == o){ $lithis.addClass("current"); } }); }); num = catids.length; } $("#choose_cont_s").find(".li_click_s").unbind("click").bind("click",function(){ var type = $(this).attr("data-type"); if(type == 'price'){ var max_price = $(this).attr("data-max_price"); var min_price = $(this).attr("data-min_price"); $("#choose_cont_s").html('').show(); $("#choose_cont_b").show(); $("#clear_btn").show(); $("#li_catids_price").attr("data-min_price",min_price); $("#li_catids_price").attr("data-max_price",max_price); $("#li_price_text").text(min_price + '-' + max_price); $("#choose_sub_btn").attr("data-type","b"); $("#choose-close").attr("data-type","b"); }else{ var iscurrent = $(this).hasClass("current"); if(iscurrent){ $(this).removeClass("current"); num -= 1; }else{ if(num <= 5){ $(this).addClass("current"); num += 1; }else{ AlertUtils.tips({ htmlmsg:'<div style="padding:30px">最多只能选择5项</div>', type:0 }); } } } }); }); $("#choose-close").unbind("click").bind("click",function(){ var thistype = $(this).attr("data-type"); if(thistype == 's'){ $("#choose_cont_s").html('').show(); $("#choose_cont_b").show(); $("#clear_btn").show(); $("#choose_sub_btn").attr("data-type","b"); $("#choose-close").attr("data-type","b"); }else{ $("#choose-list").hide(); $("#choose-list-modalMask").hide(); } }); $("#choose_sub_btn").unbind("click").bind("click",function(){ var thistype = $(this).attr("data-type"); if(thistype == 's'){ var thisindex = $(this).attr("data-index"); var currentcatids = ''; var currenttexts = ''; $("#choose_cont_s").find(".li_click_s").each(function(index, element) { var iscurrent = $(this).hasClass("current"); var this_catid = $(this).attr("data-catid"); var this_text = $(this).attr("data-text"); if(iscurrent){ currentcatids += this_catid+'|'; currenttexts += this_text+','; } }); if(!currenttexts){ currenttexts = '不限'; } $("#choose_cont_s").html('').show(); $("#choose_cont_b").show(); $("#clear_btn").show(); $("#li_catids_"+thisindex).attr("data-catids",currentcatids); $("#catids_"+thisindex).text(currenttexts); $("#choose_sub_btn").attr("data-type","b"); $("#choose-close").attr("data-type","b"); }else{ var catids = ''; var min_price = $("#li_catids_price").attr("data-min_price"); var max_price = $("#li_catids_price").attr("data-max_price"); $("#choose_cont_b").find(".li_click").each(function(index, element) { var thiscatids = $(this).attr("data-catids"); catids += thiscatids; }); $("#choose-list-modalMask,#choose-list").hide(); var li_price_text = $("#li_price_text").text(); if(!catids && li_price_text == '不限'){ return false; } var url = $("#choose_dh").find(".current").attr("data-durl")+"&catids_choose="+catids+"&min_price_choose="+min_price+"&max_price_choose="+max_price+"&ajax=true"; $("#choose_dh").find(".dhpjax").each(function(index, element) { var thisurl = $(this).attr("data-durl")+"&catids_choose="+catids+"&min_price_choose="+min_price+"&max_price_choose="+max_price+"&ajax=true"; $(this).attr("data-url",thisurl); }); $.ajax({ url: url, dataType: 'html', beforeSend: function(xhr){ var nvnexttop = $('#masonry_2').offset().top; $("#data-loading").remove(); $('#masonry_2').html('<div class="imgloading" style="height:180px; width:100%"></div>'); window.scrollTo(0,nvnexttop-45); }, success: function(data){ $('#masonry_2').html(data); $(window).unbind('.infscr'); MasonryUtils.masonryInit({ masonry:"masonry_2", issearch:true, islazy:1, callback:function(){ } }); } }) } }); }; var dhfixedTop = function(options){ var settings = { topHeight:80 }; if(options){ $.extend(settings,options); } $("#masonry_2").fixedTop({ isdiv:true, topHeight:settings.topHeight, scallback:function(){ if($(".headerbox").length>0){ $("#choose_dh").addClass("masonry_dh_fixed_55"); $("#masonry_2").css({"padding-top":40}); }else{ $("#choose_dh").addClass("masonry_dh_fixed"); } }, ecallback:function(){ if($(".headerbox").length>0){ $("#choose_dh").removeClass("masonry_dh_fixed_55"); $("#masonry_2").css({"padding-top":0}); }else{ $("#choose_dh").removeClass("masonry_dh_fixed"); } } }); }; return {chooseInt:chooseInt,dhfixedTop:dhfixedTop}; }(); var BaseInitClass = function(){ var baseInit = function(){ if($("#viewpage").size()<=0 && $("#index_ad").size()<=0){ var h_height = $(".headerbox").height(); $(".mainbox").css({"padding-top":h_height}); } if($("#type-banner").size()>0){ var bannerH = $(".headerbox").height(); $(".mainbox").css({"padding-top":bannerH}); $("#type-banner").fixedTop({ scallback:function(obj){ obj.hide(); }, ecallback:function(obj){ obj.show(); } }); } $('body').delegate(".back-btn","click",function(){ window.history.back(); }); pjaxClass.pjaxInt(); windowscrollInt(); allsearch(); sideMenu(); shareawards(); upcontainer({}); infomore(); var js_debug = BaseInitClass.getQueryString("js_debug"); if(isweixin == 1){ gzweixin({}); } function bodyhideshow(){ $(".bodyclick").unbind("click").bind("click",function(){ var h_height = $(".headerbox").height(); var h_flag = $(".headerbox").hasClass("fade"); if(!h_flag){ $(".headerbox,.footerbox").removeClass("loaded_diy").addClass("fade"); $(".mainbox").css({"padding-top":0}); }else{ $(".headerbox,.footerbox").removeClass("fade").addClass("loaded_diy"); $(".mainbox").css({"padding-top":h_height}); } }); } $("img.avatar_lazy").checkImgExists(function(obj,imgurl){ var $myopj = obj; var myimgurl = imgurl; var $thisp = $myopj.parent(".useravatar_bg"); $thisp.css({"background": "url("+myimgurl+") no-repeat","background-size": "cover"}); }); if($("#cartItemnum").size() > 0){ GetCartTop.getCartInit(); } $("#topButton").goTopExUtils(); $(".shareUpload").unbind("click").bind("click",function(){ $("#addbox").show(); $('body').addClass("noScroll"); $("#addbox_bg,#addbox_btn").unbind("click").bind("click",function(){ $("#addbox").hide(); $('body').removeClass("noScroll"); }); }); }; var upcontainer = function(opt){ $(".add-share").unbind("click").bind("click",function(){ var ismjx = $(this).attr("data-ismjx"); var ischecklogin = loginCheck(); if(!ischecklogin){ return false; } UploadUtils.uploadInit({ tip:true, uptitle:'请选择1~5张图片上传', yzlogin:true, container:'allcontainer', browse_button:'allpickfiles', drop_element:'allcontainer', isarray:true, bucket:'share', isarray:true, multi_selection:true, auto_start:true, fileNumLimit:5, callback:function(oimgdata){ var myoimgdata = oimgdata; UploadUtils.successFun(myoimgdata,{ismjx:ismjx}); }, bcallback:function(){} }); if(opt.callback){ opt.callback(); } }); }; var infomore = function(){ var suid = $("#send").attr("data-suid"); AjaxFunUtils.ajaxInit({ "url":'/message/getmsgnum.html', "params":{suid:suid}, "callback":function (res) { if(res.status ==1){ $("#infomore_num,#infomnum").text(res.data.num).show(); } } }); $(".infomore_btn").unbind("click").bind("click",function(){ var $thisparnt = $(this).parents(".top_r"); var isshow = $thisparnt.find(".infomore").is(":hidden"); if(isshow){ $thisparnt.find(".infomore").show(); }else{ $thisparnt.find(".infomore").hide(); } $(document).unbind("click").bind('click',function(e){ var target = $(e.target); if(target.closest($(".infomore_btn")).length == 0){ $thisparnt.find(".infomore").hide(); }; }); }); }; var shareawards = function(){ if(urlfee_fromsuid && urlfee_url){ setTimeout(shareawardsInt,5000); function shareawardsInt(){ AjaxFunUtils.ajaxInit({ "url":'/mk_market/urlfee.html', "params":{fromsuid:urlfee_fromsuid,url:urlfee_url}, "callback":function (res) { } }); } } }; var getQueryString = function(name) { var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); var r = window.location.search.substr(1).match(reg); if (r != null) return unescape(r[2]); return null; }; var checksearchTagbox = function(){ var val = $("#newsearchInt").val(); $("#newsearchInt").val($.trim(val)); var flag = isNull(val); if(flag){ return false; } }; var followBtn = function(){ $(".followBtn").unbind("click").bind("click",function(){ var $thisF = $(this); var ishome = $(this).attr("data-ishome"); var istext = $(this).attr("data-text"); var followType = $thisF.attr("data-type"); var follow = $thisF.attr("data-follow"); $thisF.addClass("btn-loading"); var followUrl = '/share/follow_'+followType+'.html'; if(followType == "board"){ var ucatid = $thisF.attr("data-ucatid"); var followparams ={ucatid:ucatid,followvalue:follow}; }else if(followType == "person"){ var fsuid = $thisF.attr("data-fsuid"); var followparams ={fsuid:fsuid,followvalue:follow}; }else if(followType == "category"){ var categoryid = $thisF.attr("data-categoryid"); var followparams ={categoryid:categoryid,followvalue:follow}; }else if(followType == "interests"){ followUrl = '/share/follow_category.html'; var categoryid = $thisF.attr("data-categoryid"); var followparams ={categoryid:categoryid,followvalue:follow}; }else if(followType == "want"){ followUrl = '/share/want.html'; var shid = $thisF.parents(".byshid").attr("data-shid"); var followparams ={shid:shid,wantvalue:follow}; }else if(followType == "group"){ followUrl = '/user_group/follow.html'; var gpid = $thisF.attr("data-gpid"); var followparams ={gpid:gpid,wantvalue:follow}; } AjaxFunUtils.ajaxInit({ "url":followUrl, "yzlogin":true, "params":followparams, "callback":function (result) { $thisF.removeClass("btn-loading"); if(result.status){ if(follow == 1){ $thisF.removeClass("current"); if(!ishome){ if(followType == "want"){ $thisF.text(lang.js_shareView_want); }else if(istext){ $thisF.find(".text").text(lang.js_shareView_follow); }else{ $thisF.text(lang.js_shareView_follow); } } $thisF.attr("data-follow",0); }else{ $thisF.addClass("current"); if(!ishome){ if(followType == "want"){ $thisF.text(lang.js_shareView_unwant); }else if(istext){ $thisF.find(".text").text(lang.js_shareView_unfollow); }else{ $thisF.text(lang.js_shareView_unfollow); } } $thisF.attr("data-follow",1); } }else{ AlertUtils.tips({ type:0, w:"96%", htmlmsg:'<div style="padding:20px 30px 20px">' + result.msg+'</div>' }); } }, "errCallback":function(){ $thisF.removeClass("btn-loading"); } }); }); }; var bindmobile = function(){ var h = getHeightBody(); $("#sns_bindmobile").css({"height":h}); var actionurl = $("#sns_bindmobileform").attr("data-action"); AlertUtils.centerDiv({divId:"sns_bindmobile", type:1, w:"100%", position:"fixed", istop:true, callback:function(){ } }); $("#sns_bindmobileform").checkInput({ validatetype:0, button:'.btn-bintmobile', submitBtnFn: function (from) { Loading.loadInit({status:1}); var dataFrom = from.serializeJson(); AjaxFunUtils.ajaxInit({"url": actionurl, "params":dataFrom, "callback":function (result) { if(result.status){ AlertUtils.tips({ type:0, htmlmsg:'<div style="padding:30px">' + result.msg+'</div>', scallback:function(){ window.location.href = '/index/index.html'; } }); }else{ AlertUtils.tips({ type:0, htmlmsg:'<div style="padding:30px">' + result.msg+'</div>' }); } Loading.loadInit({status:0}); } }); } }); }; var loginCheck = function(tip){ var res = true; if(islogin == 0){ if(tip != 1){ AlertUtils.tips({ htmlmsg:'<div style="padding:30px">'+lang.js_base_login_tip+'</div>', callback:function(){ $(".btnTipsubmit").find(".buttonText").text(lang.js_base_login_btn); }, scallback:function(){ var loginhref = encodeURIComponent(window.location.href); window.location.href = '/index/reg.html?loginurl='+loginhref+''; } }); } res = false; }; return res; }; return {baseInit:baseInit,bindmobile:bindmobile,followBtn:followBtn,getQueryString:getQueryString,checksearchTagbox:checksearchTagbox,loginCheck:loginCheck,upcontainer:upcontainer} }(); var editorInit = function(otitle){ var dataFace = [ {name:"微笑",msrc:static_url_comm + "/files/emoticons/0.gif"}, {name:"大笑",msrc:static_url_comm + "/files/emoticons/1.gif"}, {name:"偷笑",msrc:static_url_comm + "/files/emoticons/2.gif"}, {name:"酷",msrc:static_url_comm + "/files/emoticons/3.gif"}, {name:"鬼脸",msrc:static_url_comm + "/files/emoticons/4.gif"}, {name:"流鼻血",msrc:static_url_comm + "/files/emoticons/5.gif"}, {name:"色",msrc:static_url_comm + "/files/emoticons/6.gif"}, {name:"疑问",msrc:static_url_comm + "/files/emoticons/7.gif"}, {name:"羞",msrc:static_url_comm + "/files/emoticons/8.gif"}, {name:"囧",msrc:static_url_comm + "/files/emoticons/9.gif"}, {name:"萌",msrc:static_url_comm + "/files/emoticons/10.gif"}, {name:"鄙视",msrc:static_url_comm + "/files/emoticons/11.gif"}, {name:"晕",msrc:static_url_comm + "/files/emoticons/12.gif"}, {name:"汗",msrc:static_url_comm + "/files/emoticons/13.gif"}, {name:"可怜",msrc:static_url_comm + "/files/emoticons/14.gif"}, {name:"靠",msrc:static_url_comm + "/files/emoticons/15.gif"}, {name:"委屈",msrc:static_url_comm + "/files/emoticons/16.gif"}, {name:"大哭",msrc:static_url_comm + "/files/emoticons/17.gif"}, {name:"生气",msrc:static_url_comm + "/files/emoticons/18.gif"}, {name:"拜拜",msrc:static_url_comm + "/files/emoticons/19.gif"}, {name:"微笑",msrc:static_url_comm + "/files/emoticons/20.gif"}, {name:"大笑",msrc:static_url_comm + "/files/emoticons/21.gif"}, {name:"偷笑",msrc:static_url_comm + "/files/emoticons/22.gif"}, {name:"酷",msrc:static_url_comm + "/files/emoticons/23.gif"}, {name:"鬼脸",msrc:static_url_comm + "/files/emoticons/24.gif"}, {name:"流鼻血",msrc:static_url_comm + "/files/emoticons/25.gif"}, {name:"色",msrc:static_url_comm + "/files/emoticons/26.gif"}, {name:"疑问",msrc:static_url_comm + "/files/emoticons/27.gif"}, {name:"羞",msrc:static_url_comm + "/files/emoticons/28.gif"}, {name:"囧",msrc:static_url_comm + "/files/emoticons/29.gif"}, {name:"萌",msrc:static_url_comm + "/files/emoticons/30.gif"}, {name:"鄙视",msrc:static_url_comm + "/files/emoticons/31.gif"}, {name:"晕",msrc:static_url_comm + "/files/emoticons/32.gif"}, {name:"汗",msrc:static_url_comm + "/files/emoticons/33.gif"}, {name:"可怜",msrc:static_url_comm + "/files/emoticons/34.gif"}, {name:"靠",msrc:static_url_comm + "/files/emoticons/35.gif"}, {name:"委屈",msrc:static_url_comm + "/files/emoticons/36.gif"}, {name:"大哭",msrc:static_url_comm + "/files/emoticons/37.gif"}, {name:"生气",msrc:static_url_comm + "/files/emoticons/38.gif"}, {name:"拜拜",msrc:static_url_comm + "/files/emoticons/39.gif"}, {name:"微笑",msrc:static_url_comm + "/files/emoticons/40.gif"}, {name:"大笑",msrc:static_url_comm + "/files/emoticons/41.gif"}, {name:"偷笑",msrc:static_url_comm + "/files/emoticons/42.gif"}, {name:"酷",msrc:static_url_comm + "/files/emoticons/43.gif"}, {name:"鬼脸",msrc:static_url_comm + "/files/emoticons/44.gif"}, {name:"流鼻血",msrc:static_url_comm + "/files/emoticons/45.gif"}, {name:"色",msrc:static_url_comm + "/files/emoticons/46.gif"}, {name:"疑问",msrc:static_url_comm + "/files/emoticons/47.gif"}, {name:"羞",msrc:static_url_comm + "/files/emoticons/48.gif"}, {name:"囧",msrc:static_url_comm + "/files/emoticons/49.gif"}, {name:"萌",msrc:static_url_comm + "/files/emoticons/50.gif"}, {name:"大笑",msrc:static_url_comm + "/files/emoticons/51.gif"}, {name:"偷笑",msrc:static_url_comm + "/files/emoticons/52.gif"}, {name:"酷",msrc:static_url_comm + "/files/emoticons/53.gif"}, {name:"鬼脸",msrc:static_url_comm + "/files/emoticons/54.gif"}, {name:"流鼻血",msrc:static_url_comm + "/files/emoticons/55.gif"}, {name:"色",msrc:static_url_comm + "/files/emoticons/56.gif"}, {name:"疑问",msrc:static_url_comm + "/files/emoticons/57.gif"}, {name:"羞",msrc:static_url_comm + "/files/emoticons/58.gif"}, {name:"囧",msrc:static_url_comm + "/files/emoticons/59.gif"}, {name:"微笑",msrc:static_url_comm + "/files/emoticons/60.gif"}, {name:"大笑",msrc:static_url_comm + "/files/emoticons/61.gif"}, {name:"偷笑",msrc:static_url_comm + "/files/emoticons/62.gif"}, {name:"酷",msrc:static_url_comm + "/files/emoticons/63.gif"}, {name:"鬼脸",msrc:static_url_comm + "/files/emoticons/64.gif"}, {name:"流鼻血",msrc:static_url_comm + "/files/emoticons/65.gif"}, {name:"色",msrc:static_url_comm + "/files/emoticons/66.gif"}, {name:"疑问",msrc:static_url_comm + "/files/emoticons/67.gif"}, {name:"羞",msrc:static_url_comm + "/files/emoticons/68.gif"}, {name:"囧",msrc:static_url_comm + "/files/emoticons/69.gif"}, {name:"微笑",msrc:static_url_comm + "/files/emoticons/70.gif"}, {name:"大笑",msrc:static_url_comm + "/files/emoticons/71.gif"}, {name:"偷笑",msrc:static_url_comm + "/files/emoticons/72.gif"}, {name:"酷",msrc:static_url_comm + "/files/emoticons/73.gif"}, {name:"鬼脸",msrc:static_url_comm + "/files/emoticons/74.gif"}, {name:"流鼻血",msrc:static_url_comm + "/files/emoticons/75.gif"}, {name:"色",msrc:static_url_comm + "/files/emoticons/76.gif"}, {name:"疑问",msrc:static_url_comm + "/files/emoticons/77.gif"}, {name:"羞",msrc:static_url_comm + "/files/emoticons/78.gif"}, {name:"囧",msrc:static_url_comm + "/files/emoticons/79.gif"}, {name:"微笑",msrc:static_url_comm + "/files/emoticons/80.gif"}, {name:"大笑",msrc:static_url_comm + "/files/emoticons/81.gif"}, {name:"偷笑",msrc:static_url_comm + "/files/emoticons/82.gif"}, {name:"酷",msrc:static_url_comm + "/files/emoticons/83.gif"}, {name:"鬼脸",msrc:static_url_comm + "/files/emoticons/84.gif"}, {name:"流鼻血",msrc:static_url_comm + "/files/emoticons/85.gif"}, {name:"色",msrc:static_url_comm + "/files/emoticons/86.gif"}, {name:"疑问",msrc:static_url_comm + "/files/emoticons/87.gif"}, {name:"羞",msrc:static_url_comm + "/files/emoticons/88.gif"}, {name:"囧",msrc:static_url_comm + "/files/emoticons/89.gif"}, {name:"微笑",msrc:static_url_comm + "/files/emoticons/90.gif"}, {name:"大笑",msrc:static_url_comm + "/files/emoticons/91.gif"}, {name:"偷笑",msrc:static_url_comm + "/files/emoticons/92.gif"}, {name:"酷",msrc:static_url_comm + "/files/emoticons/93.gif"}, {name:"鬼脸",msrc:static_url_comm + "/files/emoticons/94.gif"}, {name:"流鼻血",msrc:static_url_comm + "/files/emoticons/95.gif"}, {name:"色",msrc:static_url_comm + "/files/emoticons/96.gif"}, {name:"疑问",msrc:static_url_comm + "/files/emoticons/97.gif"}, {name:"羞",msrc:static_url_comm + "/files/emoticons/98.gif"}, {name:"囧",msrc:static_url_comm + "/files/emoticons/99.gif"}, {name:"萌",msrc:static_url_comm + "/files/emoticons/100.gif"} ]; var editor = document.getElementById("meditor"); var ul = document.createElement("ul"); var ulHtml = ""; for(var i = 0,l= dataFace.length;i<l;i++){ ulHtml +="<li><img alt='"+dataFace[i].name+"' src='"+dataFace[i].msrc+"' /></li>"; }; ul.innerHTML=ulHtml; $("#bqbox").append(ul); var mytitle = otitle; var textarea = document.getElementById("meditortxt"); textarea.style.display = "none"; var iframe = document.createElement("iframe"); iframe.id = "myeditable"; iframe.className = "myeditable"; iframe.style.width = "100%"; iframe.style.height = "36px"; iframe.frameBorder=0; textarea.parentNode.insertBefore(iframe,textarea); var iframeDocument = iframe.contentDocument || iframe.contentWindow.document; iframeDocument.designMode = "on"; iframeDocument.open(); iframeDocument.write('<html><head></head><body id="message" style="line-height:26px; font-size:14px; display:block;height:26px;overflow:hidden">'+mytitle+'</body></html>'); iframeDocument.close(); $("#mbar").unbind("click").bind("click",function(event){ var flag = $("#bqbox").is(':hidden'); if(flag){ $("#bqbox").show(); var msghtml = $(this).html(); if(msghtml == mytitle){ $("#myeditable").contents().find("#message").html('&nbsp;'); } event.stopPropagation(); $(document).bind('click',function(e){ var target = $(e.target); if(target.closest("#bqbox").length == 0){ $("#bqbox").hide(); }; }); }else{ $("#bqbox").hide(); } }); var lis = editor.getElementsByTagName("li"); for(var i = 0, l = lis.length; i<l;i++){ lis[i].onclick = new function(){ var choose = lis[i]; return function(){ $("#bqbox").hide(); var value = choose.getElementsByTagName("img")[0].src; $("#myeditable").contents().find("#message").focus(); iframeDocument.execCommand("insertimage",false,value); } } }; $("#myeditable").contents().find("#message").focus(function(){ var msghtml = $(this).html(); if(msghtml == mytitle){ $(this).html('&nbsp;'); } }); $("#myeditable").contents().find("#message").bind('input', function(){ var msg2=msg = $(this).html(); var req = /<img src=".*?">/g; var arr; var img; while((arr = req.exec(msg2)) !=null){ img = arr[0].split(".gif"); img_code = img[0].split("/"); img_code = '[em]' +img_code[img_code.length -1] + '[/em]'; msg=msg.replace(arr[0],img_code); } msg = msg.replace(/<br>/,''); $("#meditortxt").val(msg); }); };function ScrollPic(scrollContId,arrLeftId,arrRightId,dotListId,listType,autoPlay,callback,imgwcallback){ this.scrollContId = scrollContId; this.arrLeftId = arrLeftId; this.arrRightId = arrRightId; this.dotListId = dotListId; this.listType = listType; this.callback = callback; this.imgwcallback = imgwcallback; this.dotClassName = "dotItem"; this.dotOnClassName = "dotItemOn"; this.dotObjArr = []; this.listEvent = "onclick"; this.circularly = true; this.pageWidth = 0; this.frameWidth = 0; this.speed = 10; this.space = 10; this.scrollWidth = 5; this.upright = false; this.pageIndex = 0; this.autoPlay = autoPlay; this.autoPlayTime = 5; this._autoTimeObj; this._scrollTimeObj; this._state = "ready"; this.stripDiv = document.createElement("DIV"); this.lDiv01 = document.createElement("DIV"); this.lDiv02 = document.createElement("DIV"); }; ScrollPic.prototype = { version : "1.41", author : "king", pageLength : 0, touch : true, initialize : function(){ var thisTemp = this; if(!this.scrollContId){ throw new Error("必须指定scrollContId."); return; }; this.scDiv = this.$(this.scrollContId); if(!this.scDiv){ throw new Error("scrollContId不是正确的对象.(scrollContId = \""+ this.scrollContId +"\")"); return; }; this.scDiv.style[this.upright?'height':'width'] = this.frameWidth + "px"; this.scDiv.style.overflow = "hidden"; this.imgwcallback(); this.lDiv01.innerHTML = this.scDiv.innerHTML; this.scDiv.innerHTML = ""; this.scDiv.appendChild(this.stripDiv); this.stripDiv.appendChild(this.lDiv01); if(this.circularly){ this.stripDiv.appendChild(this.lDiv02); this.lDiv02.innerHTML = this.lDiv01.innerHTML }; this.stripDiv.style.overflow = "hidden"; this.stripDiv.style.zoom = "1"; this.stripDiv.style[this.upright?'height':'width'] = "32766px"; if(!this.upright){ this.lDiv01.style.cssFloat = "left"; this.lDiv01.style.styleFloat = "left"; this.lDiv01.style.overflow = "hidden"; }; this.lDiv01.style.zoom = "1"; if(this.circularly && !this.upright){ this.lDiv02.style.cssFloat = "left"; this.lDiv02.style.styleFloat = "left"; this.lDiv02.style.overflow = "hidden"; }; this.lDiv02.style.zoom = "1"; this.addEvent(this.scDiv,"mouseover",function(){thisTemp.stop()}); this.addEvent(this.scDiv,"mouseout",function(){thisTemp.play()}); if(this.arrLeftId){ this.alObj = this.$(this.arrLeftId); if(this.alObj){ this.addEvent(this.alObj,"mousedown",function(){thisTemp.rightMouseDown()}); this.addEvent(this.alObj,"mouseup",function(){thisTemp.rightEnd()}); this.addEvent(this.alObj,"mouseout",function(){thisTemp.rightEnd()}); }; }; if(this.arrRightId){ this.arObj = this.$(this.arrRightId); if(this.arObj){ this.addEvent(this.arObj,"mousedown",function(){thisTemp.leftMouseDown()}); this.addEvent(this.arObj,"mouseup",function(){thisTemp.leftEnd()}); this.addEvent(this.arObj,"mouseout",function(){thisTemp.leftEnd()}); }; }; var pages = $(this.scDiv).find(".mod_01").size()/2; this.pageLength = pages; if(this.dotListId){ this.dotListObj = this.$(this.dotListId); this.dotListObj.innerHTML = ""; if(this.dotListObj){ for(i=0;i<pages;i++){ tempObj = document.createElement("span"); this.dotListObj.appendChild(tempObj); this.dotObjArr.push(tempObj); if(i==this.pageIndex){ tempObj.className = this.dotOnClassName; }else{ tempObj.className = this.dotClassName; }; if(this.listType == 'number'){ tempObj.innerHTML = i+1; }else if(typeof (this.listType) =='string' ){ tempObj.innerHTML = this.listType; }else { tempObj.innerHTML=''; }; tempObj.title = "第" + (i+1) + "页"; tempObj.num = i; tempObj[this.listEvent] = function(){thisTemp.pageTo(this.num)}; }; }; }; this.scDiv[this.upright?'scrollTop':'scrollLeft'] = 0; if(this.autoPlay){this.play()}; this._scroll = this.upright?'scrollTop':'scrollLeft'; this._sWidth = this.upright?'scrollHeight':'scrollWidth'; if(typeof(this.onpagechange) === 'function'){ this.onpagechange(); }; this.iPad(); }, leftMouseDown : function(){ if(this._state != "ready"){return}; var thisTemp = this; this._state = "floating"; clearInterval(this._scrollTimeObj); this.moveLeft(); this._scrollTimeObj = setInterval(function(){thisTemp.moveLeft()},this.speed); }, rightMouseDown : function(){ if(this._state != "ready"){return}; var thisTemp = this; this._state = "floating"; clearInterval(this._scrollTimeObj); this.moveRight(); this._scrollTimeObj = setInterval(function(){thisTemp.moveRight()},this.speed); }, moveLeft : function(){ if(this.circularly){ if(this.scDiv[this._scroll] + this.space >= this.lDiv01[this._sWidth]){ this.scDiv[this._scroll] = this.scDiv[this._scroll] + this.space - this.lDiv01[this._sWidth]; }else{ this.scDiv[this._scroll] += this.space; }; }else{ if(this.scDiv[this._scroll] + this.space >= this.lDiv01[this._sWidth] - this.frameWidth){ this.scDiv[this._scroll] = this.lDiv01[this._sWidth] - this.frameWidth; this.leftEnd(); }else{ this.scDiv[this._scroll] += this.space; }; }; this.accountPageIndex(); }, moveRight : function(){ if(this.circularly){ if(this.scDiv[this._scroll] - this.space <= 0){ this.scDiv[this._scroll] = this.lDiv01[this._sWidth] + this.scDiv[this._scroll] - this.space; }else{ this.scDiv[this._scroll] -= this.space; }; }else{ if(this.scDiv[this._scroll] - this.space <= 0){ this.scDiv[this._scroll] = 0; this.rightEnd(); }else{ this.scDiv[this._scroll] -= this.space; }; }; this.accountPageIndex(); }, leftEnd : function(){ if(this._state != "floating" && this._state != 'touch'){return}; this._state = "stoping"; clearInterval(this._scrollTimeObj); var fill = this.pageWidth - this.scDiv[this._scroll] % this.pageWidth; this.move(fill); }, rightEnd : function(){ if(this._state != "floating" && this._state != 'touch'){return}; this._state = "stoping"; clearInterval(this._scrollTimeObj); var fill = - this.scDiv[this._scroll] % this.pageWidth; this.move(fill); }, move : function(num,quick){ var thisTemp = this; var thisMove = num/5; var theEnd = false; if(!quick){ if(thisMove > this.space){thisMove = this.space}; if(thisMove < -this.space){thisMove = -this.space}; }; if(Math.abs(thisMove)<1 && thisMove!=0){ thisMove = thisMove>=0?1:-1; }else{ thisMove = Math.round(thisMove); }; var temp = this.scDiv[this._scroll] + thisMove; if(thisMove>0){ if(this.circularly){ if(this.scDiv[this._scroll] + thisMove >= this.lDiv01[this._sWidth]){ this.scDiv[this._scroll] = this.scDiv[this._scroll] + thisMove - this.lDiv01[this._sWidth]; }else{ this.scDiv[this._scroll] += thisMove; }; }else{ if(this.scDiv[this._scroll] + thisMove >= this.lDiv01[this._sWidth] - this.frameWidth){ this.scDiv[this._scroll] = this.lDiv01[this._sWidth] - this.frameWidth; this._state = "ready"; theEnd = true; }else{ this.scDiv[this._scroll] += thisMove; }; }; }else{ if(this.circularly){ if(this.scDiv[this._scroll] + thisMove < 0){ this.scDiv[this._scroll] = this.lDiv01[this._sWidth] + this.scDiv[this._scroll] + thisMove; }else{ this.scDiv[this._scroll] += thisMove; }; }else{ if(this.scDiv[this._scroll] - thisMove < 0){ this.scDiv[this._scroll] = 0; this._state = "ready"; theEnd = true; }else{ this.scDiv[this._scroll] += thisMove; }; }; }; if(typeof(this.onpagechange) === 'function'){ this.onpagechange(); }; if(theEnd){ return; }; num -= thisMove; if(Math.abs(num) == 0){ this._state = "ready"; if(this.autoPlay){this.play()}; this.accountPageIndex(); return; }else{ this.accountPageIndex(); this._scrollTimeObj = setTimeout(function(){thisTemp.move(num,quick)},this.speed) }; }, pre : function(){ if(this._state != "ready"){return}; this._state = "stoping"; this.pageTo(this.pageIndex - 1); }, next : function(reStar){ if(this._state != "ready"){return}; this._state = "stoping"; if(this.circularly){ this.pageTo(this.pageIndex + 1); }else{ if(this.scDiv[this._scroll] >= this.lDiv01[this._sWidth] - this.frameWidth){ this._state = "ready"; if(reStar){this.pageTo(0)}; }else{ this.pageTo(this.pageIndex + 1); }; }; }, play : function(){ var thisTemp = this; if(!this.autoPlay){return}; clearInterval(this._autoTimeObj); this._autoTimeObj = setInterval(function(){thisTemp.next(true)},this.autoPlayTime * 1000); }, stop : function(){ clearInterval(this._autoTimeObj); }, pageTo : function(num){ if(this.pageIndex == num){return}; if(num < 0){num = this.pageLength - 1}; clearTimeout(this._scrollTimeObj); this._state = "stoping"; var fill = num * this.frameWidth - this.scDiv[this._scroll]; this.move(fill,true); }, accountPageIndex : function(){ var pageIndex = Math.floor(this.scDiv[this._scroll] / this.frameWidth); if(pageIndex == this.pageIndex){return}; this.pageIndex = pageIndex; if(this.pageIndex > Math.floor(this.lDiv01[this.upright?'offsetHeight':'offsetWidth'] / this.frameWidth )){this.pageIndex = 0}; if(typeof(this.onnowpage) === 'function'){ this.onnowpage(this.pageIndex); } var i; for(i=0;i<this.dotObjArr.length;i++){ if(i==this.pageIndex){ this.callback(i); this.dotObjArr[i].className = this.dotOnClassName; }else{ this.dotObjArr[i].className = this.dotClassName; }; }; if(typeof(this.onpagechange) === 'function'){ this.onpagechange(); }; }, iPadX : 0, iPadLastX : 0, iPadStatus : 'ok', iPad : function(){ if(typeof(window.ontouchstart) === 'undefined'){ return; }; if(!this.touch){return}; var tempThis = this; this.addEvent(this.scDiv,'touchstart',function(e){tempThis._touchstart(e)}); this.addEvent(this.scDiv,'touchmove',function(e){tempThis._touchmove(e)}); this.addEvent(this.scDiv,'touchend',function(e){tempThis._touchend(e)}); }, _touchstart : function(e){ this.stop(); this.iPadX = e.touches[0].pageX; this.iPadScrollX = window.pageXOffset; this.iPadScrollY = window.pageYOffset; this.scDivScrollLeft = this.scDiv[this._scroll]; }, _touchmove : function(e){ if(e.touches.length > 1){ this.iPadStatus = 'ok'; return; }; this.iPadLastX = e.touches[0].pageX; var cX = this.iPadX - this.iPadLastX; if(this.iPadStatus == 'ok'){ if(this.iPadScrollY == window.pageYOffset && this.iPadScrollX == window.pageXOffset && Math.abs(cX)>this.scrollWidth){ this.iPadStatus = 'touch'; }else{ return; }; }; this._state = 'touch'; var scrollNum = this.scDivScrollLeft + cX; if(scrollNum >= this.lDiv01[this._sWidth]){ scrollNum = scrollNum - this.lDiv01[this._sWidth]; }; if(scrollNum < 0){ scrollNum = scrollNum + this.lDiv01[this._sWidth]; }; this.scDiv[this._scroll] = scrollNum; e.preventDefault(); }, _touchend : function(e){ if(this.iPadStatus != 'touch'){return}; this.iPadStatus = 'ok'; var cX = this.iPadX - this.iPadLastX; if(cX<0){ this.rightEnd(); }else{ this.leftEnd(); }; this.play(); }, $ : function(objName){if(document.getElementById){return eval('document.getElementById("'+objName+'")')}else{return eval('document.all.'+objName)}}, isIE : navigator.appVersion.indexOf("MSIE")!=-1?true:false, addEvent : function(obj,eventType,func){if(obj.attachEvent){obj.attachEvent("on" + eventType,func);}else{obj.addEventListener(eventType,func,false)}}, delEvent : function(obj,eventType,func){ if(obj.detachEvent){obj.detachEvent("on" + eventType,func)}else{obj.removeEventListener(eventType,func,false)} }, readCookie : function(l){var i="",I=l+"=";if(document.cookie.length>0){var offset=document.cookie.indexOf(I);if(offset!=-1){offset+=I.length;var end=document.cookie.indexOf(";",offset);if(end==-1)end=document.cookie.length;i=unescape(document.cookie.substring(offset,end))}};return i}, writeCookie : function(O,o,l,I){var i="",c="";if(l!=null){i=new Date((new Date).getTime()+l*3600000);i="; expires="+i.toGMTString()};if(I!=null){c=";domain="+I};document.cookie=O+"="+escape(o)+i+c}, readStyle:function(i,I){if(i.style[I]){return i.style[I]}else if(i.currentStyle){return i.currentStyle[I]}else if(document.defaultView&&document.defaultView.getComputedStyle){var l=document.defaultView.getComputedStyle(i,null);return l.getPropertyValue(I)}else{return null}} }; !function(){"use strict";function e(e){e.fn.swiper=function(a){var r;return e(this).each(function(){var e=new t(this,a);r||(r=e)}),r}}var a,t=function(e,s){function i(){return"horizontal"===w.params.direction}function n(e){return Math.floor(e)}function o(){w.autoplayTimeoutId=setTimeout(function(){w.params.loop?(w.fixLoop(),w._slideNext()):w.isEnd?s.autoplayStopOnLast?w.stopAutoplay():w._slideTo(0):w._slideNext()},w.params.autoplay)}function l(e,t){var r=a(e.target);if(!r.is(t))if("string"==typeof t)r=r.parents(t);else if(t.nodeType){var s;return r.parents().each(function(e,a){a===t&&(s=t)}),s?t:void 0}return 0===r.length?void 0:r[0]}function d(e,a){a=a||{};var t=window.MutationObserver||window.WebkitMutationObserver,r=new t(function(e){e.forEach(function(e){w.onResize(!0),w.emit("onObserverUpdate",w,e)})});r.observe(e,{attributes:"undefined"==typeof a.attributes?!0:a.attributes,childList:"undefined"==typeof a.childList?!0:a.childList,characterData:"undefined"==typeof a.characterData?!0:a.characterData}),w.observers.push(r)}function p(e){e.originalEvent&&(e=e.originalEvent);var a=e.keyCode||e.charCode;if(!w.params.allowSwipeToNext&&(i()&&39===a||!i()&&40===a))return!1;if(!w.params.allowSwipeToPrev&&(i()&&37===a||!i()&&38===a))return!1;if(!(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey||document.activeElement&&document.activeElement.nodeName&&("input"===document.activeElement.nodeName.toLowerCase()||"textarea"===document.activeElement.nodeName.toLowerCase()))){if(37===a||39===a||38===a||40===a){var t=!1;if(w.container.parents(".swiper-slide").length>0&&0===w.container.parents(".swiper-slide-active").length)return;var r={left:window.pageXOffset,top:window.pageYOffset},s=window.innerWidth,n=window.innerHeight,o=w.container.offset();w.rtl&&(o.left=o.left-w.container[0].scrollLeft);for(var l=[[o.left,o.top],[o.left+w.width,o.top],[o.left,o.top+w.height],[o.left+w.width,o.top+w.height]],d=0;d<l.length;d++){var p=l[d];p[0]>=r.left&&p[0]<=r.left+s&&p[1]>=r.top&&p[1]<=r.top+n&&(t=!0)}if(!t)return}i()?((37===a||39===a)&&(e.preventDefault?e.preventDefault():e.returnValue=!1),(39===a&&!w.rtl||37===a&&w.rtl)&&w.slideNext(),(37===a&&!w.rtl||39===a&&w.rtl)&&w.slidePrev()):((38===a||40===a)&&(e.preventDefault?e.preventDefault():e.returnValue=!1),40===a&&w.slideNext(),38===a&&w.slidePrev())}}function u(e){e.originalEvent&&(e=e.originalEvent);var a=w.mousewheel.event,t=0;if(e.detail)t=-e.detail;else if("mousewheel"===a)if(w.params.mousewheelForceToAxis)if(i()){if(!(Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)))return;t=e.wheelDeltaX}else{if(!(Math.abs(e.wheelDeltaY)>Math.abs(e.wheelDeltaX)))return;t=e.wheelDeltaY}else t=e.wheelDelta;else if("DOMMouseScroll"===a)t=-e.detail;else if("wheel"===a)if(w.params.mousewheelForceToAxis)if(i()){if(!(Math.abs(e.deltaX)>Math.abs(e.deltaY)))return;t=-e.deltaX}else{if(!(Math.abs(e.deltaY)>Math.abs(e.deltaX)))return;t=-e.deltaY}else t=Math.abs(e.deltaX)>Math.abs(e.deltaY)?-e.deltaX:-e.deltaY;if(w.params.mousewheelInvert&&(t=-t),w.params.freeMode){var r=w.getWrapperTranslate()+t*w.params.mousewheelSensitivity;if(r>w.minTranslate()&&(r=w.minTranslate()),r<w.maxTranslate()&&(r=w.maxTranslate()),w.setWrapperTransition(0),w.setWrapperTranslate(r),w.updateProgress(),w.updateActiveIndex(),w.params.freeModeSticky&&(clearTimeout(w.mousewheel.timeout),w.mousewheel.timeout=setTimeout(function(){w.slideReset()},300)),0===r||r===w.maxTranslate())return}else{if((new window.Date).getTime()-w.mousewheel.lastScrollTime>60)if(0>t)if(w.isEnd&&!w.params.loop||w.animating){if(w.params.mousewheelReleaseOnEdges)return!0}else w.slideNext();else if(w.isBeginning&&!w.params.loop||w.animating){if(w.params.mousewheelReleaseOnEdges)return!0}else w.slidePrev();w.mousewheel.lastScrollTime=(new window.Date).getTime()}return w.params.autoplay&&w.stopAutoplay(),e.preventDefault?e.preventDefault():e.returnValue=!1,!1}function c(e,t){e=a(e);var r,s,n;r=e.attr("data-swiper-parallax")||"0",s=e.attr("data-swiper-parallax-x"),n=e.attr("data-swiper-parallax-y"),s||n?(s=s||"0",n=n||"0"):i()?(s=r,n="0"):(n=r,s="0"),s=s.indexOf("%")>=0?parseInt(s,10)*t+"%":s*t+"px",n=n.indexOf("%")>=0?parseInt(n,10)*t+"%":n*t+"px",e.transform("translate3d("+s+", "+n+",0px)")}function m(e){return 0!==e.indexOf("on")&&(e=e[0]!==e[0].toUpperCase()?"on"+e[0].toUpperCase()+e.substring(1):"on"+e),e}if(!(this instanceof t))return new t(e,s);var f={direction:"horizontal",touchEventsTarget:"container",initialSlide:0,speed:300,autoplay:!1,autoplayDisableOnInteraction:!0,iOSEdgeSwipeDetection:!1,iOSEdgeSwipeThreshold:20,freeMode:!1,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeSticky:!1,freeModeMinimumVelocity:.02,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",coverflow:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},cube:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94},fade:{crossFade:!1},parallax:!1,scrollbar:null,scrollbarHide:!0,scrollbarDraggable:!1,scrollbarSnapOnRelease:!1,keyboardControl:!1,mousewheelControl:!1,mousewheelReleaseOnEdges:!1,mousewheelInvert:!1,mousewheelForceToAxis:!1,mousewheelSensitivity:1,hashnav:!1,spaceBetween:0,slidesPerView:1,slidesPerColumn:1,slidesPerColumnFill:"column",slidesPerGroup:1,centeredSlides:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,onlyExternal:!1,threshold:0,touchMoveStopPropagation:!0,pagination:null,paginationElement:"span",paginationClickable:!1,paginationHide:!1,paginationBulletRender:null,resistance:!0,resistanceRatio:.85,nextButton:null,prevButton:null,watchSlidesProgress:!1,watchSlidesVisibility:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,lazyLoading:!1,lazyLoadingInPrevNext:!1,lazyLoadingOnTransitionStart:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,control:void 0,controlInverse:!1,controlBy:"slide",allowSwipeToPrev:!0,allowSwipeToNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",buttonDisabledClass:"swiper-button-disabled",paginationHiddenClass:"swiper-pagination-hidden",observer:!1,observeParents:!1,a11y:!1,prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",runCallbacksOnInit:!0},h=s&&s.virtualTranslate;s=s||{};for(var g in f)if("undefined"==typeof s[g])s[g]=f[g];else if("object"==typeof s[g])for(var v in f[g])"undefined"==typeof s[g][v]&&(s[g][v]=f[g][v]);var w=this;if(w.params=s,w.classNames=[],"undefined"!=typeof a&&"undefined"!=typeof r&&(a=r),("undefined"!=typeof a||(a="undefined"==typeof r?window.Dom7||window.Zepto||window.jQuery:r))&&(w.$=a,w.container=a(e),0!==w.container.length)){if(w.container.length>1)return void w.container.each(function(){new t(this,s)});w.container[0].swiper=w,w.container.data("swiper",w),w.classNames.push("swiper-container-"+w.params.direction),w.params.freeMode&&w.classNames.push("swiper-container-free-mode"),w.support.flexbox||(w.classNames.push("swiper-container-no-flexbox"),w.params.slidesPerColumn=1),(w.params.parallax||w.params.watchSlidesVisibility)&&(w.params.watchSlidesProgress=!0),["cube","coverflow"].indexOf(w.params.effect)>=0&&(w.support.transforms3d?(w.params.watchSlidesProgress=!0,w.classNames.push("swiper-container-3d")):w.params.effect="slide"),"slide"!==w.params.effect&&w.classNames.push("swiper-container-"+w.params.effect),"cube"===w.params.effect&&(w.params.resistanceRatio=0,w.params.slidesPerView=1,w.params.slidesPerColumn=1,w.params.slidesPerGroup=1,w.params.centeredSlides=!1,w.params.spaceBetween=0,w.params.virtualTranslate=!0,w.params.setWrapperSize=!1),"fade"===w.params.effect&&(w.params.slidesPerView=1,w.params.slidesPerColumn=1,w.params.slidesPerGroup=1,w.params.watchSlidesProgress=!0,w.params.spaceBetween=0,"undefined"==typeof h&&(w.params.virtualTranslate=!0)),w.params.grabCursor&&w.support.touch&&(w.params.grabCursor=!1),w.wrapper=w.container.children("."+w.params.wrapperClass),w.params.pagination&&(w.paginationContainer=a(w.params.pagination),w.params.paginationClickable&&w.paginationContainer.addClass("swiper-pagination-clickable")),w.rtl=i()&&("rtl"===w.container[0].dir.toLowerCase()||"rtl"===w.container.css("direction")),w.rtl&&w.classNames.push("swiper-container-rtl"),w.rtl&&(w.wrongRTL="-webkit-box"===w.wrapper.css("display")),w.params.slidesPerColumn>1&&w.classNames.push("swiper-container-multirow"),w.device.android&&w.classNames.push("swiper-container-android"),w.container.addClass(w.classNames.join(" ")),w.translate=0,w.progress=0,w.velocity=0,w.lockSwipeToNext=function(){w.params.allowSwipeToNext=!1},w.lockSwipeToPrev=function(){w.params.allowSwipeToPrev=!1},w.lockSwipes=function(){w.params.allowSwipeToNext=w.params.allowSwipeToPrev=!1},w.unlockSwipeToNext=function(){w.params.allowSwipeToNext=!0},w.unlockSwipeToPrev=function(){w.params.allowSwipeToPrev=!0},w.unlockSwipes=function(){w.params.allowSwipeToNext=w.params.allowSwipeToPrev=!0},w.params.grabCursor&&(w.container[0].style.cursor="move",w.container[0].style.cursor="-webkit-grab",w.container[0].style.cursor="-moz-grab",w.container[0].style.cursor="grab"),w.imagesToLoad=[],w.imagesLoaded=0,w.loadImage=function(e,a,t,r,s){function i(){s&&s()}var n;e.complete&&r?i():a?(n=new window.Image,n.onload=i,n.onerror=i,t&&(n.srcset=t),a&&(n.src=a)):i()},w.preloadImages=function(){function e(){"undefined"!=typeof w&&null!==w&&(void 0!==w.imagesLoaded&&w.imagesLoaded++,w.imagesLoaded===w.imagesToLoad.length&&(w.params.updateOnImagesReady&&w.update(),w.emit("onImagesReady",w)))}w.imagesToLoad=w.container.find("img");for(var a=0;a<w.imagesToLoad.length;a++)w.loadImage(w.imagesToLoad[a],w.imagesToLoad[a].currentSrc||w.imagesToLoad[a].getAttribute("src"),w.imagesToLoad[a].srcset||w.imagesToLoad[a].getAttribute("srcset"),!0,e)},w.autoplayTimeoutId=void 0,w.autoplaying=!1,w.autoplayPaused=!1,w.startAutoplay=function(){return"undefined"!=typeof w.autoplayTimeoutId?!1:w.params.autoplay?w.autoplaying?!1:(w.autoplaying=!0,w.emit("onAutoplayStart",w),void o()):!1},w.stopAutoplay=function(e){w.autoplayTimeoutId&&(w.autoplayTimeoutId&&clearTimeout(w.autoplayTimeoutId),w.autoplaying=!1,w.autoplayTimeoutId=void 0,w.emit("onAutoplayStop",w))},w.pauseAutoplay=function(e){w.autoplayPaused||(w.autoplayTimeoutId&&clearTimeout(w.autoplayTimeoutId),w.autoplayPaused=!0,0===e?(w.autoplayPaused=!1,o()):w.wrapper.transitionEnd(function(){w&&(w.autoplayPaused=!1,w.autoplaying?o():w.stopAutoplay())}))},w.minTranslate=function(){return-w.snapGrid[0]},w.maxTranslate=function(){return-w.snapGrid[w.snapGrid.length-1]},w.updateContainerSize=function(){var e,a;e="undefined"!=typeof w.params.width?w.params.width:w.container[0].clientWidth,a="undefined"!=typeof w.params.height?w.params.height:w.container[0].clientHeight,0===e&&i()||0===a&&!i()||(e=e-parseInt(w.container.css("padding-left"),10)-parseInt(w.container.css("padding-right"),10),a=a-parseInt(w.container.css("padding-top"),10)-parseInt(w.container.css("padding-bottom"),10),w.width=e,w.height=a,w.size=i()?w.width:w.height)},w.updateSlidesSize=function(){w.slides=w.wrapper.children("."+w.params.slideClass),w.snapGrid=[],w.slidesGrid=[],w.slidesSizesGrid=[];var e,a=w.params.spaceBetween,t=-w.params.slidesOffsetBefore,r=0,s=0;"string"==typeof a&&a.indexOf("%")>=0&&(a=parseFloat(a.replace("%",""))/100*w.size),w.virtualSize=-a,w.rtl?w.slides.css({marginLeft:"",marginTop:""}):w.slides.css({marginRight:"",marginBottom:""});var o;w.params.slidesPerColumn>1&&(o=Math.floor(w.slides.length/w.params.slidesPerColumn)===w.slides.length/w.params.slidesPerColumn?w.slides.length:Math.ceil(w.slides.length/w.params.slidesPerColumn)*w.params.slidesPerColumn,"auto"!==w.params.slidesPerView&&"row"===w.params.slidesPerColumnFill&&(o=Math.max(o,w.params.slidesPerView*w.params.slidesPerColumn)));var l,d=w.params.slidesPerColumn,p=o/d,u=p-(w.params.slidesPerColumn*p-w.slides.length);for(e=0;e<w.slides.length;e++){l=0;var c=w.slides.eq(e);if(w.params.slidesPerColumn>1){var m,f,h;"column"===w.params.slidesPerColumnFill?(f=Math.floor(e/d),h=e-f*d,(f>u||f===u&&h===d-1)&&++h>=d&&(h=0,f++),m=f+h*o/d,c.css({"-webkit-box-ordinal-group":m,"-moz-box-ordinal-group":m,"-ms-flex-order":m,"-webkit-order":m,order:m})):(h=Math.floor(e/p),f=e-h*p),c.css({"margin-top":0!==h&&w.params.spaceBetween&&w.params.spaceBetween+"px"}).attr("data-swiper-column",f).attr("data-swiper-row",h)}"none"!==c.css("display")&&("auto"===w.params.slidesPerView?(l=i()?c.outerWidth(!0):c.outerHeight(!0),w.params.roundLengths&&(l=n(l))):(l=(w.size-(w.params.slidesPerView-1)*a)/w.params.slidesPerView,w.params.roundLengths&&(l=n(l)),i()?w.slides[e].style.width=l+"px":w.slides[e].style.height=l+"px"),w.slides[e].swiperSlideSize=l,w.slidesSizesGrid.push(l),w.params.centeredSlides?(t=t+l/2+r/2+a,0===e&&(t=t-w.size/2-a),Math.abs(t)<.001&&(t=0),s%w.params.slidesPerGroup===0&&w.snapGrid.push(t),w.slidesGrid.push(t)):(s%w.params.slidesPerGroup===0&&w.snapGrid.push(t),w.slidesGrid.push(t),t=t+l+a),w.virtualSize+=l+a,r=l,s++)}w.virtualSize=Math.max(w.virtualSize,w.size)+w.params.slidesOffsetAfter;var g;if(w.rtl&&w.wrongRTL&&("slide"===w.params.effect||"coverflow"===w.params.effect)&&w.wrapper.css({width:w.virtualSize+w.params.spaceBetween+"px"}),(!w.support.flexbox||w.params.setWrapperSize)&&(i()?w.wrapper.css({width:w.virtualSize+w.params.spaceBetween+"px"}):w.wrapper.css({height:w.virtualSize+w.params.spaceBetween+"px"})),w.params.slidesPerColumn>1&&(w.virtualSize=(l+w.params.spaceBetween)*o,w.virtualSize=Math.ceil(w.virtualSize/w.params.slidesPerColumn)-w.params.spaceBetween,w.wrapper.css({width:w.virtualSize+w.params.spaceBetween+"px"}),w.params.centeredSlides)){for(g=[],e=0;e<w.snapGrid.length;e++)w.snapGrid[e]<w.virtualSize+w.snapGrid[0]&&g.push(w.snapGrid[e]);w.snapGrid=g}if(!w.params.centeredSlides){for(g=[],e=0;e<w.snapGrid.length;e++)w.snapGrid[e]<=w.virtualSize-w.size&&g.push(w.snapGrid[e]);w.snapGrid=g,Math.floor(w.virtualSize-w.size)>Math.floor(w.snapGrid[w.snapGrid.length-1])&&w.snapGrid.push(w.virtualSize-w.size)}0===w.snapGrid.length&&(w.snapGrid=[0]),0!==w.params.spaceBetween&&(i()?w.rtl?w.slides.css({marginLeft:a+"px"}):w.slides.css({marginRight:a+"px"}):w.slides.css({marginBottom:a+"px"})),w.params.watchSlidesProgress&&w.updateSlidesOffset()},w.updateSlidesOffset=function(){for(var e=0;e<w.slides.length;e++)w.slides[e].swiperSlideOffset=i()?w.slides[e].offsetLeft:w.slides[e].offsetTop},w.updateSlidesProgress=function(e){if("undefined"==typeof e&&(e=w.translate||0),0!==w.slides.length){"undefined"==typeof w.slides[0].swiperSlideOffset&&w.updateSlidesOffset();var a=-e;w.rtl&&(a=e);w.container[0].getBoundingClientRect(),i()?"left":"top",i()?"right":"bottom";w.slides.removeClass(w.params.slideVisibleClass);for(var t=0;t<w.slides.length;t++){var r=w.slides[t],s=(a-r.swiperSlideOffset)/(r.swiperSlideSize+w.params.spaceBetween);if(w.params.watchSlidesVisibility){var n=-(a-r.swiperSlideOffset),o=n+w.slidesSizesGrid[t],l=n>=0&&n<w.size||o>0&&o<=w.size||0>=n&&o>=w.size;l&&w.slides.eq(t).addClass(w.params.slideVisibleClass)}r.progress=w.rtl?-s:s}}},w.updateProgress=function(e){"undefined"==typeof e&&(e=w.translate||0);var a=w.maxTranslate()-w.minTranslate();0===a?(w.progress=0,w.isBeginning=w.isEnd=!0):(w.progress=(e-w.minTranslate())/a,w.isBeginning=w.progress<=0,w.isEnd=w.progress>=1),w.isBeginning&&w.emit("onReachBeginning",w),w.isEnd&&w.emit("onReachEnd",w),w.params.watchSlidesProgress&&w.updateSlidesProgress(e),w.emit("onProgress",w,w.progress)},w.updateActiveIndex=function(){var e,a,t,r=w.rtl?w.translate:-w.translate;for(a=0;a<w.slidesGrid.length;a++)"undefined"!=typeof w.slidesGrid[a+1]?r>=w.slidesGrid[a]&&r<w.slidesGrid[a+1]-(w.slidesGrid[a+1]-w.slidesGrid[a])/2?e=a:r>=w.slidesGrid[a]&&r<w.slidesGrid[a+1]&&(e=a+1):r>=w.slidesGrid[a]&&(e=a);(0>e||"undefined"==typeof e)&&(e=0),t=Math.floor(e/w.params.slidesPerGroup),t>=w.snapGrid.length&&(t=w.snapGrid.length-1),e!==w.activeIndex&&(w.snapIndex=t,w.previousIndex=w.activeIndex,w.activeIndex=e,w.updateClasses())},w.updateClasses=function(){w.slides.removeClass(w.params.slideActiveClass+" "+w.params.slideNextClass+" "+w.params.slidePrevClass);var e=w.slides.eq(w.activeIndex);if(e.addClass(w.params.slideActiveClass),e.next("."+w.params.slideClass).addClass(w.params.slideNextClass),e.prev("."+w.params.slideClass).addClass(w.params.slidePrevClass),w.bullets&&w.bullets.length>0){w.bullets.removeClass(w.params.bulletActiveClass);var t;w.params.loop?(t=Math.ceil(w.activeIndex-w.loopedSlides)/w.params.slidesPerGroup,t>w.slides.length-1-2*w.loopedSlides&&(t-=w.slides.length-2*w.loopedSlides),t>w.bullets.length-1&&(t-=w.bullets.length)):t="undefined"!=typeof w.snapIndex?w.snapIndex:w.activeIndex||0,w.paginationContainer.length>1?w.bullets.each(function(){a(this).index()===t&&a(this).addClass(w.params.bulletActiveClass)}):w.bullets.eq(t).addClass(w.params.bulletActiveClass)}w.params.loop||(w.params.prevButton&&(w.isBeginning?(a(w.params.prevButton).addClass(w.params.buttonDisabledClass),w.params.a11y&&w.a11y&&w.a11y.disable(a(w.params.prevButton))):(a(w.params.prevButton).removeClass(w.params.buttonDisabledClass),w.params.a11y&&w.a11y&&w.a11y.enable(a(w.params.prevButton)))),w.params.nextButton&&(w.isEnd?(a(w.params.nextButton).addClass(w.params.buttonDisabledClass),w.params.a11y&&w.a11y&&w.a11y.disable(a(w.params.nextButton))):(a(w.params.nextButton).removeClass(w.params.buttonDisabledClass),w.params.a11y&&w.a11y&&w.a11y.enable(a(w.params.nextButton)))))},w.updatePagination=function(){if(w.params.pagination&&w.paginationContainer&&w.paginationContainer.length>0){for(var e="",a=w.params.loop?Math.ceil((w.slides.length-2*w.loopedSlides)/w.params.slidesPerGroup):w.snapGrid.length,t=0;a>t;t++)e+=w.params.paginationBulletRender?w.params.paginationBulletRender(t,w.params.bulletClass):"<"+w.params.paginationElement+' class="'+w.params.bulletClass+'"></'+w.params.paginationElement+">";w.paginationContainer.html(e),w.bullets=w.paginationContainer.find("."+w.params.bulletClass),w.params.paginationClickable&&w.params.a11y&&w.a11y&&w.a11y.initPagination()}},w.update=function(e){function a(){r=Math.min(Math.max(w.translate,w.maxTranslate()),w.minTranslate()),w.setWrapperTranslate(r),w.updateActiveIndex(),w.updateClasses()}if(w.updateContainerSize(),w.updateSlidesSize(),w.updateProgress(),w.updatePagination(),w.updateClasses(),w.params.scrollbar&&w.scrollbar&&w.scrollbar.set(),e){var t,r;w.controller&&w.controller.spline&&(w.controller.spline=void 0),w.params.freeMode?a():(t=("auto"===w.params.slidesPerView||w.params.slidesPerView>1)&&w.isEnd&&!w.params.centeredSlides?w.slideTo(w.slides.length-1,0,!1,!0):w.slideTo(w.activeIndex,0,!1,!0),t||a())}},w.onResize=function(e){var a=w.params.allowSwipeToPrev,t=w.params.allowSwipeToNext;if(w.params.allowSwipeToPrev=w.params.allowSwipeToNext=!0,w.updateContainerSize(),w.updateSlidesSize(),("auto"===w.params.slidesPerView||w.params.freeMode||e)&&w.updatePagination(),w.params.scrollbar&&w.scrollbar&&w.scrollbar.set(),w.controller&&w.controller.spline&&(w.controller.spline=void 0),w.params.freeMode){var r=Math.min(Math.max(w.translate,w.maxTranslate()),w.minTranslate());w.setWrapperTranslate(r),w.updateActiveIndex(),w.updateClasses()}else w.updateClasses(),("auto"===w.params.slidesPerView||w.params.slidesPerView>1)&&w.isEnd&&!w.params.centeredSlides?w.slideTo(w.slides.length-1,0,!1,!0):w.slideTo(w.activeIndex,0,!1,!0);w.params.allowSwipeToPrev=a,w.params.allowSwipeToNext=t};var y=["mousedown","mousemove","mouseup"];window.navigator.pointerEnabled?y=["pointerdown","pointermove","pointerup"]:window.navigator.msPointerEnabled&&(y=["MSPointerDown","MSPointerMove","MSPointerUp"]),w.touchEvents={start:w.support.touch||!w.params.simulateTouch?"touchstart":y[0],move:w.support.touch||!w.params.simulateTouch?"touchmove":y[1],end:w.support.touch||!w.params.simulateTouch?"touchend":y[2]},(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&("container"===w.params.touchEventsTarget?w.container:w.wrapper).addClass("swiper-wp8-"+w.params.direction),w.initEvents=function(e){var t=e?"off":"on",r=e?"removeEventListener":"addEventListener",i="container"===w.params.touchEventsTarget?w.container[0]:w.wrapper[0],n=w.support.touch?i:document,o=w.params.nested?!0:!1;w.browser.ie?(i[r](w.touchEvents.start,w.onTouchStart,!1),n[r](w.touchEvents.move,w.onTouchMove,o),n[r](w.touchEvents.end,w.onTouchEnd,!1)):(w.support.touch&&(i[r](w.touchEvents.start,w.onTouchStart,!1),i[r](w.touchEvents.move,w.onTouchMove,o),i[r](w.touchEvents.end,w.onTouchEnd,!1)),!s.simulateTouch||w.device.ios||w.device.android||(i[r]("mousedown",w.onTouchStart,!1),document[r]("mousemove",w.onTouchMove,o),document[r]("mouseup",w.onTouchEnd,!1))),window[r]("resize",w.onResize),w.params.nextButton&&(a(w.params.nextButton)[t]("click",w.onClickNext),w.params.a11y&&w.a11y&&a(w.params.nextButton)[t]("keydown",w.a11y.onEnterKey)),w.params.prevButton&&(a(w.params.prevButton)[t]("click",w.onClickPrev),w.params.a11y&&w.a11y&&a(w.params.prevButton)[t]("keydown",w.a11y.onEnterKey)),w.params.pagination&&w.params.paginationClickable&&(a(w.paginationContainer)[t]("click","."+w.params.bulletClass,w.onClickIndex),w.params.a11y&&w.a11y&&a(w.paginationContainer)[t]("keydown","."+w.params.bulletClass,w.a11y.onEnterKey)),(w.params.preventClicks||w.params.preventClicksPropagation)&&i[r]("click",w.preventClicks,!0)},w.attachEvents=function(e){w.initEvents()},w.detachEvents=function(){w.initEvents(!0)},w.allowClick=!0,w.preventClicks=function(e){w.allowClick||(w.params.preventClicks&&e.preventDefault(),w.params.preventClicksPropagation&&w.animating&&(e.stopPropagation(),e.stopImmediatePropagation()))},w.onClickNext=function(e){e.preventDefault(),(!w.isEnd||w.params.loop)&&w.slideNext()},w.onClickPrev=function(e){e.preventDefault(),(!w.isBeginning||w.params.loop)&&w.slidePrev()},w.onClickIndex=function(e){e.preventDefault();var t=a(this).index()*w.params.slidesPerGroup;w.params.loop&&(t+=w.loopedSlides),w.slideTo(t)},w.updateClickedSlide=function(e){var t=l(e,"."+w.params.slideClass),r=!1;if(t)for(var s=0;s<w.slides.length;s++)w.slides[s]===t&&(r=!0);if(!t||!r)return w.clickedSlide=void 0,void(w.clickedIndex=void 0);if(w.clickedSlide=t,w.clickedIndex=a(t).index(),w.params.slideToClickedSlide&&void 0!==w.clickedIndex&&w.clickedIndex!==w.activeIndex){var i,n=w.clickedIndex;if(w.params.loop){if(w.animating)return;i=a(w.clickedSlide).attr("data-swiper-slide-index"),w.params.centeredSlides?n<w.loopedSlides-w.params.slidesPerView/2||n>w.slides.length-w.loopedSlides+w.params.slidesPerView/2?(w.fixLoop(),n=w.wrapper.children("."+w.params.slideClass+'[data-swiper-slide-index="'+i+'"]:not(.swiper-slide-duplicate)').eq(0).index(),setTimeout(function(){w.slideTo(n)},0)):w.slideTo(n):n>w.slides.length-w.params.slidesPerView?(w.fixLoop(),n=w.wrapper.children("."+w.params.slideClass+'[data-swiper-slide-index="'+i+'"]:not(.swiper-slide-duplicate)').eq(0).index(),setTimeout(function(){w.slideTo(n)},0)):w.slideTo(n)}else w.slideTo(n)}};var b,T,x,S,C,M,E,P,z,I="input, select, textarea, button",k=Date.now(),L=[];w.animating=!1,w.touches={startX:0,startY:0,currentX:0,currentY:0,diff:0};var D,B;if(w.onTouchStart=function(e){if(e.originalEvent&&(e=e.originalEvent),D="touchstart"===e.type,D||!("which"in e)||3!==e.which){if(w.params.noSwiping&&l(e,"."+w.params.noSwipingClass))return void(w.allowClick=!0);if(!w.params.swipeHandler||l(e,w.params.swipeHandler)){var t=w.touches.currentX="touchstart"===e.type?e.targetTouches[0].pageX:e.pageX,r=w.touches.currentY="touchstart"===e.type?e.targetTouches[0].pageY:e.pageY;if(!(w.device.ios&&w.params.iOSEdgeSwipeDetection&&t<=w.params.iOSEdgeSwipeThreshold)){if(b=!0,T=!1,S=void 0,B=void 0,w.touches.startX=t,w.touches.startY=r,x=Date.now(),w.allowClick=!0,w.updateContainerSize(),w.swipeDirection=void 0,w.params.threshold>0&&(E=!1),"touchstart"!==e.type){var s=!0;a(e.target).is(I)&&(s=!1),document.activeElement&&a(document.activeElement).is(I)&&document.activeElement.blur(),s&&e.preventDefault()}w.emit("onTouchStart",w,e)}}}},w.onTouchMove=function(e){if(e.originalEvent&&(e=e.originalEvent),!(D&&"mousemove"===e.type||e.preventedByNestedSwiper)){if(w.params.onlyExternal)return w.allowClick=!1,void(b&&(w.touches.startX=w.touches.currentX="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,w.touches.startY=w.touches.currentY="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,x=Date.now()));if(D&&document.activeElement&&e.target===document.activeElement&&a(e.target).is(I))return T=!0,void(w.allowClick=!1);if(w.emit("onTouchMove",w,e),!(e.targetTouches&&e.targetTouches.length>1)){if(w.touches.currentX="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,w.touches.currentY="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,"undefined"==typeof S){var t=180*Math.atan2(Math.abs(w.touches.currentY-w.touches.startY),Math.abs(w.touches.currentX-w.touches.startX))/Math.PI;S=i()?t>w.params.touchAngle:90-t>w.params.touchAngle}if(S&&w.emit("onTouchMoveOpposite",w,e),"undefined"==typeof B&&w.browser.ieTouch&&(w.touches.currentX!==w.touches.startX||w.touches.currentY!==w.touches.startY)&&(B=!0),b){if(S)return void(b=!1);if(B||!w.browser.ieTouch){w.allowClick=!1,w.emit("onSliderMove",w,e),e.preventDefault(),w.params.touchMoveStopPropagation&&!w.params.nested&&e.stopPropagation(),T||(s.loop&&w.fixLoop(),M=w.getWrapperTranslate(),w.setWrapperTransition(0),w.animating&&w.wrapper.trigger("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd msTransitionEnd"),w.params.autoplay&&w.autoplaying&&(w.params.autoplayDisableOnInteraction?w.stopAutoplay():w.pauseAutoplay()),z=!1,w.params.grabCursor&&(w.container[0].style.cursor="move",w.container[0].style.cursor="-webkit-grabbing",w.container[0].style.cursor="-moz-grabbin",w.container[0].style.cursor="grabbing")),T=!0;var r=w.touches.diff=i()?w.touches.currentX-w.touches.startX:w.touches.currentY-w.touches.startY;r*=w.params.touchRatio,w.rtl&&(r=-r),w.swipeDirection=r>0?"prev":"next",C=r+M;var n=!0;if(r>0&&C>w.minTranslate()?(n=!1,w.params.resistance&&(C=w.minTranslate()-1+Math.pow(-w.minTranslate()+M+r,w.params.resistanceRatio))):0>r&&C<w.maxTranslate()&&(n=!1,w.params.resistance&&(C=w.maxTranslate()+1-Math.pow(w.maxTranslate()-M-r,w.params.resistanceRatio))),n&&(e.preventedByNestedSwiper=!0),!w.params.allowSwipeToNext&&"next"===w.swipeDirection&&M>C&&(C=M),!w.params.allowSwipeToPrev&&"prev"===w.swipeDirection&&C>M&&(C=M),w.params.followFinger){if(w.params.threshold>0){if(!(Math.abs(r)>w.params.threshold||E))return void(C=M);if(!E)return E=!0,w.touches.startX=w.touches.currentX,w.touches.startY=w.touches.currentY,C=M,void(w.touches.diff=i()?w.touches.currentX-w.touches.startX:w.touches.currentY-w.touches.startY)}(w.params.freeMode||w.params.watchSlidesProgress)&&w.updateActiveIndex(),w.params.freeMode&&(0===L.length&&L.push({position:w.touches[i()?"startX":"startY"],time:x}),L.push({position:w.touches[i()?"currentX":"currentY"],time:(new window.Date).getTime()})),w.updateProgress(C),w.setWrapperTranslate(C)}}}}}},w.onTouchEnd=function(e){if(e.originalEvent&&(e=e.originalEvent),w.emit("onTouchEnd",w,e),b){w.params.grabCursor&&T&&b&&(w.container[0].style.cursor="move",w.container[0].style.cursor="-webkit-grab",w.container[0].style.cursor="-moz-grab",w.container[0].style.cursor="grab");var t=Date.now(),r=t-x;if(w.allowClick&&(w.updateClickedSlide(e),w.emit("onTap",w,e),300>r&&t-k>300&&(P&&clearTimeout(P),P=setTimeout(function(){w&&(w.params.paginationHide&&w.paginationContainer.length>0&&!a(e.target).hasClass(w.params.bulletClass)&&w.paginationContainer.toggleClass(w.params.paginationHiddenClass),w.emit("onClick",w,e))},300)),300>r&&300>t-k&&(P&&clearTimeout(P),w.emit("onDoubleTap",w,e))),k=Date.now(),setTimeout(function(){w&&(w.allowClick=!0)},0),!b||!T||!w.swipeDirection||0===w.touches.diff||C===M)return void(b=T=!1);b=T=!1;var s;if(s=w.params.followFinger?w.rtl?w.translate:-w.translate:-C,w.params.freeMode){if(s<-w.minTranslate())return void w.slideTo(w.activeIndex);if(s>-w.maxTranslate())return void(w.slides.length<w.snapGrid.length?w.slideTo(w.snapGrid.length-1):w.slideTo(w.slides.length-1));if(w.params.freeModeMomentum){if(L.length>1){var i=L.pop(),n=L.pop(),o=i.position-n.position,l=i.time-n.time;w.velocity=o/l,w.velocity=w.velocity/2,Math.abs(w.velocity)<w.params.freeModeMinimumVelocity&&(w.velocity=0),(l>150||(new window.Date).getTime()-i.time>300)&&(w.velocity=0)}else w.velocity=0;L.length=0;var d=1e3*w.params.freeModeMomentumRatio,p=w.velocity*d,u=w.translate+p;w.rtl&&(u=-u);var c,m=!1,f=20*Math.abs(w.velocity)*w.params.freeModeMomentumBounceRatio;if(u<w.maxTranslate())w.params.freeModeMomentumBounce?(u+w.maxTranslate()<-f&&(u=w.maxTranslate()-f),c=w.maxTranslate(),m=!0,z=!0):u=w.maxTranslate();else if(u>w.minTranslate())w.params.freeModeMomentumBounce?(u-w.minTranslate()>f&&(u=w.minTranslate()+f),c=w.minTranslate(),m=!0,z=!0):u=w.minTranslate();else if(w.params.freeModeSticky){var h,g=0;for(g=0;g<w.snapGrid.length;g+=1)if(w.snapGrid[g]>-u){h=g;break}u=Math.abs(w.snapGrid[h]-u)<Math.abs(w.snapGrid[h-1]-u)||"next"===w.swipeDirection?w.snapGrid[h]:w.snapGrid[h-1],w.rtl||(u=-u)}if(0!==w.velocity)d=w.rtl?Math.abs((-u-w.translate)/w.velocity):Math.abs((u-w.translate)/w.velocity);else if(w.params.freeModeSticky)return void w.slideReset();w.params.freeModeMomentumBounce&&m?(w.updateProgress(c),w.setWrapperTransition(d),w.setWrapperTranslate(u),w.onTransitionStart(),w.animating=!0,w.wrapper.transitionEnd(function(){w&&z&&(w.emit("onMomentumBounce",w),w.setWrapperTransition(w.params.speed),w.setWrapperTranslate(c),w.wrapper.transitionEnd(function(){w&&w.onTransitionEnd()}))})):w.velocity?(w.updateProgress(u),w.setWrapperTransition(d),w.setWrapperTranslate(u),w.onTransitionStart(),w.animating||(w.animating=!0,w.wrapper.transitionEnd(function(){w&&w.onTransitionEnd()}))):w.updateProgress(u),w.updateActiveIndex()}return void((!w.params.freeModeMomentum||r>=w.params.longSwipesMs)&&(w.updateProgress(),w.updateActiveIndex()))}var v,y=0,S=w.slidesSizesGrid[0];for(v=0;v<w.slidesGrid.length;v+=w.params.slidesPerGroup)"undefined"!=typeof w.slidesGrid[v+w.params.slidesPerGroup]?s>=w.slidesGrid[v]&&s<w.slidesGrid[v+w.params.slidesPerGroup]&&(y=v,S=w.slidesGrid[v+w.params.slidesPerGroup]-w.slidesGrid[v]):s>=w.slidesGrid[v]&&(y=v,S=w.slidesGrid[w.slidesGrid.length-1]-w.slidesGrid[w.slidesGrid.length-2]);var E=(s-w.slidesGrid[y])/S;if(r>w.params.longSwipesMs){if(!w.params.longSwipes)return void w.slideTo(w.activeIndex);"next"===w.swipeDirection&&(E>=w.params.longSwipesRatio?w.slideTo(y+w.params.slidesPerGroup):w.slideTo(y)),"prev"===w.swipeDirection&&(E>1-w.params.longSwipesRatio?w.slideTo(y+w.params.slidesPerGroup):w.slideTo(y))}else{if(!w.params.shortSwipes)return void w.slideTo(w.activeIndex);"next"===w.swipeDirection&&w.slideTo(y+w.params.slidesPerGroup),"prev"===w.swipeDirection&&w.slideTo(y)}}},w._slideTo=function(e,a){return w.slideTo(e,a,!0,!0)},w.slideTo=function(e,a,t,r){"undefined"==typeof t&&(t=!0),"undefined"==typeof e&&(e=0),0>e&&(e=0),w.snapIndex=Math.floor(e/w.params.slidesPerGroup),w.snapIndex>=w.snapGrid.length&&(w.snapIndex=w.snapGrid.length-1);var s=-w.snapGrid[w.snapIndex];w.params.autoplay&&w.autoplaying&&(r||!w.params.autoplayDisableOnInteraction?w.pauseAutoplay(a):w.stopAutoplay()),w.updateProgress(s);for(var n=0;n<w.slidesGrid.length;n++)-Math.floor(100*s)>=Math.floor(100*w.slidesGrid[n])&&(e=n);if(!w.params.allowSwipeToNext&&s<w.translate&&s<w.minTranslate())return!1; if(!w.params.allowSwipeToPrev&&s>w.translate&&s>w.maxTranslate()&&(w.activeIndex||0)!==e)return!1;if("undefined"==typeof a&&(a=w.params.speed),w.previousIndex=w.activeIndex||0,w.activeIndex=e,s===w.translate)return w.updateClasses(),!1;w.updateClasses(),w.onTransitionStart(t);i()?s:0,i()?0:s;return 0===a?(w.setWrapperTransition(0),w.setWrapperTranslate(s),w.onTransitionEnd(t)):(w.setWrapperTransition(a),w.setWrapperTranslate(s),w.animating||(w.animating=!0,w.wrapper.transitionEnd(function(){w&&w.onTransitionEnd(t)}))),!0},w.onTransitionStart=function(e){"undefined"==typeof e&&(e=!0),w.lazy&&w.lazy.onTransitionStart(),e&&(w.emit("onTransitionStart",w),w.activeIndex!==w.previousIndex&&w.emit("onSlideChangeStart",w))},w.onTransitionEnd=function(e){w.animating=!1,w.setWrapperTransition(0),"undefined"==typeof e&&(e=!0),w.lazy&&w.lazy.onTransitionEnd(),e&&(w.emit("onTransitionEnd",w),w.activeIndex!==w.previousIndex&&w.emit("onSlideChangeEnd",w)),w.params.hashnav&&w.hashnav&&w.hashnav.setHash()},w.slideNext=function(e,a,t){if(w.params.loop){if(w.animating)return!1;w.fixLoop();w.container[0].clientLeft;return w.slideTo(w.activeIndex+w.params.slidesPerGroup,a,e,t)}return w.slideTo(w.activeIndex+w.params.slidesPerGroup,a,e,t)},w._slideNext=function(e){return w.slideNext(!0,e,!0)},w.slidePrev=function(e,a,t){if(w.params.loop){if(w.animating)return!1;w.fixLoop();w.container[0].clientLeft;return w.slideTo(w.activeIndex-1,a,e,t)}return w.slideTo(w.activeIndex-1,a,e,t)},w._slidePrev=function(e){return w.slidePrev(!0,e,!0)},w.slideReset=function(e,a,t){return w.slideTo(w.activeIndex,a,e)},w.setWrapperTransition=function(e,a){w.wrapper.transition(e),"slide"!==w.params.effect&&w.effects[w.params.effect]&&w.effects[w.params.effect].setTransition(e),w.params.parallax&&w.parallax&&w.parallax.setTransition(e),w.params.scrollbar&&w.scrollbar&&w.scrollbar.setTransition(e),w.params.control&&w.controller&&w.controller.setTransition(e,a),w.emit("onSetTransition",w,e)},w.setWrapperTranslate=function(e,a,t){var r=0,s=0,o=0;i()?r=w.rtl?-e:e:s=e,w.params.roundLengths&&(r=n(r),s=n(s)),w.params.virtualTranslate||(w.support.transforms3d?w.wrapper.transform("translate3d("+r+"px, "+s+"px, "+o+"px)"):w.wrapper.transform("translate("+r+"px, "+s+"px)")),w.translate=i()?r:s,a&&w.updateActiveIndex(),"slide"!==w.params.effect&&w.effects[w.params.effect]&&w.effects[w.params.effect].setTranslate(w.translate),w.params.parallax&&w.parallax&&w.parallax.setTranslate(w.translate),w.params.scrollbar&&w.scrollbar&&w.scrollbar.setTranslate(w.translate),w.params.control&&w.controller&&w.controller.setTranslate(w.translate,t),w.emit("onSetTranslate",w,w.translate)},w.getTranslate=function(e,a){var t,r,s,i;return"undefined"==typeof a&&(a="x"),w.params.virtualTranslate?w.rtl?-w.translate:w.translate:(s=window.getComputedStyle(e,null),window.WebKitCSSMatrix?(r=s.transform||s.webkitTransform,r.split(",").length>6&&(r=r.split(", ").map(function(e){return e.replace(",",".")}).join(", ")),i=new window.WebKitCSSMatrix("none"===r?"":r)):(i=s.MozTransform||s.OTransform||s.MsTransform||s.msTransform||s.transform||s.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),t=i.toString().split(",")),"x"===a&&(r=window.WebKitCSSMatrix?i.m41:16===t.length?parseFloat(t[12]):parseFloat(t[4])),"y"===a&&(r=window.WebKitCSSMatrix?i.m42:16===t.length?parseFloat(t[13]):parseFloat(t[5])),w.rtl&&r&&(r=-r),r||0)},w.getWrapperTranslate=function(e){return"undefined"==typeof e&&(e=i()?"x":"y"),w.getTranslate(w.wrapper[0],e)},w.observers=[],w.initObservers=function(){if(w.params.observeParents)for(var e=w.container.parents(),a=0;a<e.length;a++)d(e[a]);d(w.container[0],{childList:!1}),d(w.wrapper[0],{attributes:!1})},w.disconnectObservers=function(){for(var e=0;e<w.observers.length;e++)w.observers[e].disconnect();w.observers=[]},w.createLoop=function(){w.wrapper.children("."+w.params.slideClass+"."+w.params.slideDuplicateClass).remove();var e=w.wrapper.children("."+w.params.slideClass);"auto"!==w.params.slidesPerView||w.params.loopedSlides||(w.params.loopedSlides=e.length),w.loopedSlides=parseInt(w.params.loopedSlides||w.params.slidesPerView,10),w.loopedSlides=w.loopedSlides+w.params.loopAdditionalSlides,w.loopedSlides>e.length&&(w.loopedSlides=e.length);var t,r=[],s=[];for(e.each(function(t,i){var n=a(this);t<w.loopedSlides&&s.push(i),t<e.length&&t>=e.length-w.loopedSlides&&r.push(i),n.attr("data-swiper-slide-index",t)}),t=0;t<s.length;t++)w.wrapper.append(a(s[t].cloneNode(!0)).addClass(w.params.slideDuplicateClass));for(t=r.length-1;t>=0;t--)w.wrapper.prepend(a(r[t].cloneNode(!0)).addClass(w.params.slideDuplicateClass))},w.destroyLoop=function(){w.wrapper.children("."+w.params.slideClass+"."+w.params.slideDuplicateClass).remove(),w.slides.removeAttr("data-swiper-slide-index")},w.fixLoop=function(){var e;w.activeIndex<w.loopedSlides?(e=w.slides.length-3*w.loopedSlides+w.activeIndex,e+=w.loopedSlides,w.slideTo(e,0,!1,!0)):("auto"===w.params.slidesPerView&&w.activeIndex>=2*w.loopedSlides||w.activeIndex>w.slides.length-2*w.params.slidesPerView)&&(e=-w.slides.length+w.activeIndex+w.loopedSlides,e+=w.loopedSlides,w.slideTo(e,0,!1,!0))},w.appendSlide=function(e){if(w.params.loop&&w.destroyLoop(),"object"==typeof e&&e.length)for(var a=0;a<e.length;a++)e[a]&&w.wrapper.append(e[a]);else w.wrapper.append(e);w.params.loop&&w.createLoop(),w.params.observer&&w.support.observer||w.update(!0)},w.prependSlide=function(e){w.params.loop&&w.destroyLoop();var a=w.activeIndex+1;if("object"==typeof e&&e.length){for(var t=0;t<e.length;t++)e[t]&&w.wrapper.prepend(e[t]);a=w.activeIndex+e.length}else w.wrapper.prepend(e);w.params.loop&&w.createLoop(),w.params.observer&&w.support.observer||w.update(!0),w.slideTo(a,0,!1)},w.removeSlide=function(e){w.params.loop&&(w.destroyLoop(),w.slides=w.wrapper.children("."+w.params.slideClass));var a,t=w.activeIndex;if("object"==typeof e&&e.length){for(var r=0;r<e.length;r++)a=e[r],w.slides[a]&&w.slides.eq(a).remove(),t>a&&t--;t=Math.max(t,0)}else a=e,w.slides[a]&&w.slides.eq(a).remove(),t>a&&t--,t=Math.max(t,0);w.params.loop&&w.createLoop(),w.params.observer&&w.support.observer||w.update(!0),w.params.loop?w.slideTo(t+w.loopedSlides,0,!1):w.slideTo(t,0,!1)},w.removeAllSlides=function(){for(var e=[],a=0;a<w.slides.length;a++)e.push(a);w.removeSlide(e)},w.effects={fade:{setTranslate:function(){for(var e=0;e<w.slides.length;e++){var a=w.slides.eq(e),t=a[0].swiperSlideOffset,r=-t;w.params.virtualTranslate||(r-=w.translate);var s=0;i()||(s=r,r=0);var n=w.params.fade.crossFade?Math.max(1-Math.abs(a[0].progress),0):1+Math.min(Math.max(a[0].progress,-1),0);a.css({opacity:n}).transform("translate3d("+r+"px, "+s+"px, 0px)")}},setTransition:function(e){if(w.slides.transition(e),w.params.virtualTranslate&&0!==e){var a=!1;w.slides.transitionEnd(function(){if(!a&&w){a=!0,w.animating=!1;for(var e=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],t=0;t<e.length;t++)w.wrapper.trigger(e[t])}})}}},cube:{setTranslate:function(){var e,t=0;w.params.cube.shadow&&(i()?(e=w.wrapper.find(".swiper-cube-shadow"),0===e.length&&(e=a('<div class="swiper-cube-shadow"></div>'),w.wrapper.append(e)),e.css({height:w.width+"px"})):(e=w.container.find(".swiper-cube-shadow"),0===e.length&&(e=a('<div class="swiper-cube-shadow"></div>'),w.container.append(e))));for(var r=0;r<w.slides.length;r++){var s=w.slides.eq(r),n=90*r,o=Math.floor(n/360);w.rtl&&(n=-n,o=Math.floor(-n/360));var l=Math.max(Math.min(s[0].progress,1),-1),d=0,p=0,u=0;r%4===0?(d=4*-o*w.size,u=0):(r-1)%4===0?(d=0,u=4*-o*w.size):(r-2)%4===0?(d=w.size+4*o*w.size,u=w.size):(r-3)%4===0&&(d=-w.size,u=3*w.size+4*w.size*o),w.rtl&&(d=-d),i()||(p=d,d=0);var c="rotateX("+(i()?0:-n)+"deg) rotateY("+(i()?n:0)+"deg) translate3d("+d+"px, "+p+"px, "+u+"px)";if(1>=l&&l>-1&&(t=90*r+90*l,w.rtl&&(t=90*-r-90*l)),s.transform(c),w.params.cube.slideShadows){var m=i()?s.find(".swiper-slide-shadow-left"):s.find(".swiper-slide-shadow-top"),f=i()?s.find(".swiper-slide-shadow-right"):s.find(".swiper-slide-shadow-bottom");0===m.length&&(m=a('<div class="swiper-slide-shadow-'+(i()?"left":"top")+'"></div>'),s.append(m)),0===f.length&&(f=a('<div class="swiper-slide-shadow-'+(i()?"right":"bottom")+'"></div>'),s.append(f));s[0].progress;m.length&&(m[0].style.opacity=-s[0].progress),f.length&&(f[0].style.opacity=s[0].progress)}}if(w.wrapper.css({"-webkit-transform-origin":"50% 50% -"+w.size/2+"px","-moz-transform-origin":"50% 50% -"+w.size/2+"px","-ms-transform-origin":"50% 50% -"+w.size/2+"px","transform-origin":"50% 50% -"+w.size/2+"px"}),w.params.cube.shadow)if(i())e.transform("translate3d(0px, "+(w.width/2+w.params.cube.shadowOffset)+"px, "+-w.width/2+"px) rotateX(90deg) rotateZ(0deg) scale("+w.params.cube.shadowScale+")");else{var h=Math.abs(t)-90*Math.floor(Math.abs(t)/90),g=1.5-(Math.sin(2*h*Math.PI/360)/2+Math.cos(2*h*Math.PI/360)/2),v=w.params.cube.shadowScale,y=w.params.cube.shadowScale/g,b=w.params.cube.shadowOffset;e.transform("scale3d("+v+", 1, "+y+") translate3d(0px, "+(w.height/2+b)+"px, "+-w.height/2/y+"px) rotateX(-90deg)")}var T=w.isSafari||w.isUiWebView?-w.size/2:0;w.wrapper.transform("translate3d(0px,0,"+T+"px) rotateX("+(i()?0:t)+"deg) rotateY("+(i()?-t:0)+"deg)")},setTransition:function(e){w.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),w.params.cube.shadow&&!i()&&w.container.find(".swiper-cube-shadow").transition(e)}},coverflow:{setTranslate:function(){for(var e=w.translate,t=i()?-e+w.width/2:-e+w.height/2,r=i()?w.params.coverflow.rotate:-w.params.coverflow.rotate,s=w.params.coverflow.depth,n=0,o=w.slides.length;o>n;n++){var l=w.slides.eq(n),d=w.slidesSizesGrid[n],p=l[0].swiperSlideOffset,u=(t-p-d/2)/d*w.params.coverflow.modifier,c=i()?r*u:0,m=i()?0:r*u,f=-s*Math.abs(u),h=i()?0:w.params.coverflow.stretch*u,g=i()?w.params.coverflow.stretch*u:0;Math.abs(g)<.001&&(g=0),Math.abs(h)<.001&&(h=0),Math.abs(f)<.001&&(f=0),Math.abs(c)<.001&&(c=0),Math.abs(m)<.001&&(m=0);var v="translate3d("+g+"px,"+h+"px,"+f+"px) rotateX("+m+"deg) rotateY("+c+"deg)";if(l.transform(v),l[0].style.zIndex=-Math.abs(Math.round(u))+1,w.params.coverflow.slideShadows){var y=i()?l.find(".swiper-slide-shadow-left"):l.find(".swiper-slide-shadow-top"),b=i()?l.find(".swiper-slide-shadow-right"):l.find(".swiper-slide-shadow-bottom");0===y.length&&(y=a('<div class="swiper-slide-shadow-'+(i()?"left":"top")+'"></div>'),l.append(y)),0===b.length&&(b=a('<div class="swiper-slide-shadow-'+(i()?"right":"bottom")+'"></div>'),l.append(b)),y.length&&(y[0].style.opacity=u>0?u:0),b.length&&(b[0].style.opacity=-u>0?-u:0)}}if(w.browser.ie){var T=w.wrapper[0].style;T.perspectiveOrigin=t+"px 50%"}},setTransition:function(e){w.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e)}}},w.lazy={initialImageLoaded:!1,loadImageInSlide:function(e,t){if("undefined"!=typeof e&&("undefined"==typeof t&&(t=!0),0!==w.slides.length)){var r=w.slides.eq(e),s=r.find(".swiper-lazy:not(.swiper-lazy-loaded):not(.swiper-lazy-loading)");!r.hasClass("swiper-lazy")||r.hasClass("swiper-lazy-loaded")||r.hasClass("swiper-lazy-loading")||(s=s.add(r[0])),0!==s.length&&s.each(function(){var e=a(this);e.addClass("swiper-lazy-loading");var s=e.attr("data-background"),i=e.attr("data-src"),n=e.attr("data-srcset");w.loadImage(e[0],i||s,n,!1,function(){if(s?(e.css("background-image","url("+s+")"),e.removeAttr("data-background")):(n&&(e.attr("srcset",n),e.removeAttr("data-srcset")),i&&(e.attr("src",i),e.removeAttr("data-src"))),e.addClass("swiper-lazy-loaded").removeClass("swiper-lazy-loading"),r.find(".swiper-lazy-preloader, .preloader").remove(),w.params.loop&&t){var a=r.attr("data-swiper-slide-index");if(r.hasClass(w.params.slideDuplicateClass)){var o=w.wrapper.children('[data-swiper-slide-index="'+a+'"]:not(.'+w.params.slideDuplicateClass+")");w.lazy.loadImageInSlide(o.index(),!1)}else{var l=w.wrapper.children("."+w.params.slideDuplicateClass+'[data-swiper-slide-index="'+a+'"]');w.lazy.loadImageInSlide(l.index(),!1)}}w.emit("onLazyImageReady",w,r[0],e[0])}),w.emit("onLazyImageLoad",w,r[0],e[0])})}},load:function(){var e;if(w.params.watchSlidesVisibility)w.wrapper.children("."+w.params.slideVisibleClass).each(function(){w.lazy.loadImageInSlide(a(this).index())});else if(w.params.slidesPerView>1)for(e=w.activeIndex;e<w.activeIndex+w.params.slidesPerView;e++)w.slides[e]&&w.lazy.loadImageInSlide(e);else w.lazy.loadImageInSlide(w.activeIndex);if(w.params.lazyLoadingInPrevNext)if(w.params.slidesPerView>1){for(e=w.activeIndex+w.params.slidesPerView;e<w.activeIndex+w.params.slidesPerView+w.params.slidesPerView;e++)w.slides[e]&&w.lazy.loadImageInSlide(e);for(e=w.activeIndex-w.params.slidesPerView;e<w.activeIndex;e++)w.slides[e]&&w.lazy.loadImageInSlide(e)}else{var t=w.wrapper.children("."+w.params.slideNextClass);t.length>0&&w.lazy.loadImageInSlide(t.index());var r=w.wrapper.children("."+w.params.slidePrevClass);r.length>0&&w.lazy.loadImageInSlide(r.index())}},onTransitionStart:function(){w.params.lazyLoading&&(w.params.lazyLoadingOnTransitionStart||!w.params.lazyLoadingOnTransitionStart&&!w.lazy.initialImageLoaded)&&w.lazy.load()},onTransitionEnd:function(){w.params.lazyLoading&&!w.params.lazyLoadingOnTransitionStart&&w.lazy.load()}},w.scrollbar={isTouched:!1,setDragPosition:function(e){var a=w.scrollbar,t=i()?"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].pageX:e.pageX||e.clientX:"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].pageY:e.pageY||e.clientY,r=t-a.track.offset()[i()?"left":"top"]-a.dragSize/2,s=-w.minTranslate()*a.moveDivider,n=-w.maxTranslate()*a.moveDivider;s>r?r=s:r>n&&(r=n),r=-r/a.moveDivider,w.updateProgress(r),w.setWrapperTranslate(r,!0)},dragStart:function(e){var a=w.scrollbar;a.isTouched=!0,e.preventDefault(),e.stopPropagation(),a.setDragPosition(e),clearTimeout(a.dragTimeout),a.track.transition(0),w.params.scrollbarHide&&a.track.css("opacity",1),w.wrapper.transition(100),a.drag.transition(100),w.emit("onScrollbarDragStart",w)},dragMove:function(e){var a=w.scrollbar;a.isTouched&&(e.preventDefault?e.preventDefault():e.returnValue=!1,a.setDragPosition(e),w.wrapper.transition(0),a.track.transition(0),a.drag.transition(0),w.emit("onScrollbarDragMove",w))},dragEnd:function(e){var a=w.scrollbar;a.isTouched&&(a.isTouched=!1,w.params.scrollbarHide&&(clearTimeout(a.dragTimeout),a.dragTimeout=setTimeout(function(){a.track.css("opacity",0),a.track.transition(400)},1e3)),w.emit("onScrollbarDragEnd",w),w.params.scrollbarSnapOnRelease&&w.slideReset())},enableDraggable:function(){var e=w.scrollbar,t=w.support.touch?e.track:document;a(e.track).on(w.touchEvents.start,e.dragStart),a(t).on(w.touchEvents.move,e.dragMove),a(t).on(w.touchEvents.end,e.dragEnd)},disableDraggable:function(){var e=w.scrollbar,t=w.support.touch?e.track:document;a(e.track).off(w.touchEvents.start,e.dragStart),a(t).off(w.touchEvents.move,e.dragMove),a(t).off(w.touchEvents.end,e.dragEnd)},set:function(){if(w.params.scrollbar){var e=w.scrollbar;e.track=a(w.params.scrollbar),e.drag=e.track.find(".swiper-scrollbar-drag"),0===e.drag.length&&(e.drag=a('<div class="swiper-scrollbar-drag"></div>'),e.track.append(e.drag)),e.drag[0].style.width="",e.drag[0].style.height="",e.trackSize=i()?e.track[0].offsetWidth:e.track[0].offsetHeight,e.divider=w.size/w.virtualSize,e.moveDivider=e.divider*(e.trackSize/w.size),e.dragSize=e.trackSize*e.divider,i()?e.drag[0].style.width=e.dragSize+"px":e.drag[0].style.height=e.dragSize+"px",e.divider>=1?e.track[0].style.display="none":e.track[0].style.display="",w.params.scrollbarHide&&(e.track[0].style.opacity=0)}},setTranslate:function(){if(w.params.scrollbar){var e,a=w.scrollbar,t=(w.translate||0,a.dragSize);e=(a.trackSize-a.dragSize)*w.progress,w.rtl&&i()?(e=-e,e>0?(t=a.dragSize-e,e=0):-e+a.dragSize>a.trackSize&&(t=a.trackSize+e)):0>e?(t=a.dragSize+e,e=0):e+a.dragSize>a.trackSize&&(t=a.trackSize-e),i()?(w.support.transforms3d?a.drag.transform("translate3d("+e+"px, 0, 0)"):a.drag.transform("translateX("+e+"px)"),a.drag[0].style.width=t+"px"):(w.support.transforms3d?a.drag.transform("translate3d(0px, "+e+"px, 0)"):a.drag.transform("translateY("+e+"px)"),a.drag[0].style.height=t+"px"),w.params.scrollbarHide&&(clearTimeout(a.timeout),a.track[0].style.opacity=1,a.timeout=setTimeout(function(){a.track[0].style.opacity=0,a.track.transition(400)},1e3))}},setTransition:function(e){w.params.scrollbar&&w.scrollbar.drag.transition(e)}},w.controller={LinearSpline:function(e,a){this.x=e,this.y=a,this.lastIndex=e.length-1;var t,r;this.x.length;this.interpolate=function(e){return e?(r=s(this.x,e),t=r-1,(e-this.x[t])*(this.y[r]-this.y[t])/(this.x[r]-this.x[t])+this.y[t]):0};var s=function(){var e,a,t;return function(r,s){for(a=-1,e=r.length;e-a>1;)r[t=e+a>>1]<=s?a=t:e=t;return e}}()},getInterpolateFunction:function(e){w.controller.spline||(w.controller.spline=w.params.loop?new w.controller.LinearSpline(w.slidesGrid,e.slidesGrid):new w.controller.LinearSpline(w.snapGrid,e.snapGrid))},setTranslate:function(e,a){function r(a){e=a.rtl&&"horizontal"===a.params.direction?-w.translate:w.translate,"slide"===w.params.controlBy&&(w.controller.getInterpolateFunction(a),i=-w.controller.spline.interpolate(-e)),i&&"container"!==w.params.controlBy||(s=(a.maxTranslate()-a.minTranslate())/(w.maxTranslate()-w.minTranslate()),i=(e-w.minTranslate())*s+a.minTranslate()),w.params.controlInverse&&(i=a.maxTranslate()-i),a.updateProgress(i),a.setWrapperTranslate(i,!1,w),a.updateActiveIndex()}var s,i,n=w.params.control;if(w.isArray(n))for(var o=0;o<n.length;o++)n[o]!==a&&n[o]instanceof t&&r(n[o]);else n instanceof t&&a!==n&&r(n)},setTransition:function(e,a){function r(a){a.setWrapperTransition(e,w),0!==e&&(a.onTransitionStart(),a.wrapper.transitionEnd(function(){i&&(a.params.loop&&"slide"===w.params.controlBy&&a.fixLoop(),a.onTransitionEnd())}))}var s,i=w.params.control;if(w.isArray(i))for(s=0;s<i.length;s++)i[s]!==a&&i[s]instanceof t&&r(i[s]);else i instanceof t&&a!==i&&r(i)}},w.hashnav={init:function(){if(w.params.hashnav){w.hashnav.initialized=!0;var e=document.location.hash.replace("#","");if(e)for(var a=0,t=0,r=w.slides.length;r>t;t++){var s=w.slides.eq(t),i=s.attr("data-hash");if(i===e&&!s.hasClass(w.params.slideDuplicateClass)){var n=s.index();w.slideTo(n,a,w.params.runCallbacksOnInit,!0)}}}},setHash:function(){w.hashnav.initialized&&w.params.hashnav&&(document.location.hash=w.slides.eq(w.activeIndex).attr("data-hash")||"")}},w.disableKeyboardControl=function(){a(document).off("keydown",p)},w.enableKeyboardControl=function(){a(document).on("keydown",p)},w.mousewheel={event:!1,lastScrollTime:(new window.Date).getTime()},w.params.mousewheelControl){try{new window.WheelEvent("wheel"),w.mousewheel.event="wheel"}catch(G){}w.mousewheel.event||void 0===document.onmousewheel||(w.mousewheel.event="mousewheel"),w.mousewheel.event||(w.mousewheel.event="DOMMouseScroll")}w.disableMousewheelControl=function(){return w.mousewheel.event?(w.container.off(w.mousewheel.event,u),!0):!1},w.enableMousewheelControl=function(){return w.mousewheel.event?(w.container.on(w.mousewheel.event,u),!0):!1},w.parallax={setTranslate:function(){w.container.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){c(this,w.progress)}),w.slides.each(function(){var e=a(this);e.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var a=Math.min(Math.max(e[0].progress,-1),1);c(this,a)})})},setTransition:function(e){"undefined"==typeof e&&(e=w.params.speed),w.container.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var t=a(this),r=parseInt(t.attr("data-swiper-parallax-duration"),10)||e;0===e&&(r=0),t.transition(r)})}},w._plugins=[];for(var O in w.plugins){var A=w.plugins[O](w,w.params[O]);A&&w._plugins.push(A)}return w.callPlugins=function(e){for(var a=0;a<w._plugins.length;a++)e in w._plugins[a]&&w._plugins[a][e](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},w.emitterEventListeners={},w.emit=function(e){w.params[e]&&w.params[e](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);var a;if(w.emitterEventListeners[e])for(a=0;a<w.emitterEventListeners[e].length;a++)w.emitterEventListeners[e][a](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);w.callPlugins&&w.callPlugins(e,arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},w.on=function(e,a){return e=m(e),w.emitterEventListeners[e]||(w.emitterEventListeners[e]=[]),w.emitterEventListeners[e].push(a),w},w.off=function(e,a){var t;if(e=m(e),"undefined"==typeof a)return w.emitterEventListeners[e]=[],w;if(w.emitterEventListeners[e]&&0!==w.emitterEventListeners[e].length){for(t=0;t<w.emitterEventListeners[e].length;t++)w.emitterEventListeners[e][t]===a&&w.emitterEventListeners[e].splice(t,1);return w}},w.once=function(e,a){e=m(e);var t=function(){a(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),w.off(e,t)};return w.on(e,t),w},w.a11y={makeFocusable:function(e){return e.attr("tabIndex","0"),e},addRole:function(e,a){return e.attr("role",a),e},addLabel:function(e,a){return e.attr("aria-label",a),e},disable:function(e){return e.attr("aria-disabled",!0),e},enable:function(e){return e.attr("aria-disabled",!1),e},onEnterKey:function(e){13===e.keyCode&&(a(e.target).is(w.params.nextButton)?(w.onClickNext(e),w.isEnd?w.a11y.notify(w.params.lastSlideMessage):w.a11y.notify(w.params.nextSlideMessage)):a(e.target).is(w.params.prevButton)&&(w.onClickPrev(e),w.isBeginning?w.a11y.notify(w.params.firstSlideMessage):w.a11y.notify(w.params.prevSlideMessage)),a(e.target).is("."+w.params.bulletClass)&&a(e.target)[0].click())},liveRegion:a('<span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span>'),notify:function(e){var a=w.a11y.liveRegion;0!==a.length&&(a.html(""),a.html(e))},init:function(){if(w.params.nextButton){var e=a(w.params.nextButton);w.a11y.makeFocusable(e),w.a11y.addRole(e,"button"),w.a11y.addLabel(e,w.params.nextSlideMessage)}if(w.params.prevButton){var t=a(w.params.prevButton);w.a11y.makeFocusable(t),w.a11y.addRole(t,"button"),w.a11y.addLabel(t,w.params.prevSlideMessage)}a(w.container).append(w.a11y.liveRegion)},initPagination:function(){w.params.pagination&&w.params.paginationClickable&&w.bullets&&w.bullets.length&&w.bullets.each(function(){var e=a(this);w.a11y.makeFocusable(e),w.a11y.addRole(e,"button"),w.a11y.addLabel(e,w.params.paginationBulletMessage.replace(/{{index}}/,e.index()+1))})},destroy:function(){w.a11y.liveRegion&&w.a11y.liveRegion.length>0&&w.a11y.liveRegion.remove()}},w.init=function(){w.params.loop&&w.createLoop(),w.updateContainerSize(),w.updateSlidesSize(),w.updatePagination(),w.params.scrollbar&&w.scrollbar&&(w.scrollbar.set(),w.params.scrollbarDraggable&&w.scrollbar.enableDraggable()),"slide"!==w.params.effect&&w.effects[w.params.effect]&&(w.params.loop||w.updateProgress(),w.effects[w.params.effect].setTranslate()),w.params.loop?w.slideTo(w.params.initialSlide+w.loopedSlides,0,w.params.runCallbacksOnInit):(w.slideTo(w.params.initialSlide,0,w.params.runCallbacksOnInit),0===w.params.initialSlide&&(w.parallax&&w.params.parallax&&w.parallax.setTranslate(),w.lazy&&w.params.lazyLoading&&(w.lazy.load(),w.lazy.initialImageLoaded=!0))),w.attachEvents(),w.params.observer&&w.support.observer&&w.initObservers(),w.params.preloadImages&&!w.params.lazyLoading&&w.preloadImages(),w.params.autoplay&&w.startAutoplay(),w.params.keyboardControl&&w.enableKeyboardControl&&w.enableKeyboardControl(),w.params.mousewheelControl&&w.enableMousewheelControl&&w.enableMousewheelControl(),w.params.hashnav&&w.hashnav&&w.hashnav.init(),w.params.a11y&&w.a11y&&w.a11y.init(),w.emit("onInit",w)},w.cleanupStyles=function(){w.container.removeClass(w.classNames.join(" ")).removeAttr("style"),w.wrapper.removeAttr("style"),w.slides&&w.slides.length&&w.slides.removeClass([w.params.slideVisibleClass,w.params.slideActiveClass,w.params.slideNextClass,w.params.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-column").removeAttr("data-swiper-row"),w.paginationContainer&&w.paginationContainer.length&&w.paginationContainer.removeClass(w.params.paginationHiddenClass),w.bullets&&w.bullets.length&&w.bullets.removeClass(w.params.bulletActiveClass),w.params.prevButton&&a(w.params.prevButton).removeClass(w.params.buttonDisabledClass),w.params.nextButton&&a(w.params.nextButton).removeClass(w.params.buttonDisabledClass),w.params.scrollbar&&w.scrollbar&&(w.scrollbar.track&&w.scrollbar.track.length&&w.scrollbar.track.removeAttr("style"),w.scrollbar.drag&&w.scrollbar.drag.length&&w.scrollbar.drag.removeAttr("style"))},w.destroy=function(e,a){w.detachEvents(),w.stopAutoplay(),w.params.scrollbar&&w.scrollbar&&w.params.scrollbarDraggable&&w.scrollbar.disableDraggable(),w.params.loop&&w.destroyLoop(),a&&w.cleanupStyles(),w.disconnectObservers(),w.params.keyboardControl&&w.disableKeyboardControl&&w.disableKeyboardControl(),w.params.mousewheelControl&&w.disableMousewheelControl&&w.disableMousewheelControl(),w.params.a11y&&w.a11y&&w.a11y.destroy(),w.emit("onDestroy"),e!==!1&&(w=null)},w.init(),w}};t.prototype={isSafari:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("safari")>=0&&e.indexOf("chrome")<0&&e.indexOf("android")<0}(),isUiWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},browser:{ie:window.navigator.pointerEnabled||window.navigator.msPointerEnabled,ieTouch:window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>1||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>1},device:function(){var e=navigator.userAgent,a=e.match(/(Android);?[\s\/]+([\d.]+)?/),t=e.match(/(iPad).*OS\s([\d_]+)/),r=e.match(/(iPod)(.*OS\s([\d_]+))?/),s=!t&&e.match(/(iPhone\sOS)\s([\d_]+)/);return{ios:t||s||r,android:a}}(),support:{touch:window.Modernizr&&Modernizr.touch===!0||function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}(),transforms3d:window.Modernizr&&Modernizr.csstransforms3d===!0||function(){var e=document.createElement("div").style;return"webkitPerspective"in e||"MozPerspective"in e||"OPerspective"in e||"MsPerspective"in e||"perspective"in e}(),flexbox:function(){for(var e=document.createElement("div").style,a="alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient".split(" "),t=0;t<a.length;t++)if(a[t]in e)return!0}(),observer:function(){return"MutationObserver"in window||"WebkitMutationObserver"in window}()},plugins:{}};for(var r=(function(){var e=function(e){var a=this,t=0;for(t=0;t<e.length;t++)a[t]=e[t];return a.length=e.length,this},a=function(a,t){var r=[],s=0;if(a&&!t&&a instanceof e)return a;if(a)if("string"==typeof a){var i,n,o=a.trim();if(o.indexOf("<")>=0&&o.indexOf(">")>=0){var l="div";for(0===o.indexOf("<li")&&(l="ul"),0===o.indexOf("<tr")&&(l="tbody"),(0===o.indexOf("<td")||0===o.indexOf("<th"))&&(l="tr"),0===o.indexOf("<tbody")&&(l="table"),0===o.indexOf("<option")&&(l="select"),n=document.createElement(l),n.innerHTML=a,s=0;s<n.childNodes.length;s++)r.push(n.childNodes[s])}else for(i=t||"#"!==a[0]||a.match(/[ .<>:~]/)?(t||document).querySelectorAll(a):[document.getElementById(a.split("#")[1])],s=0;s<i.length;s++)i[s]&&r.push(i[s])}else if(a.nodeType||a===window||a===document)r.push(a);else if(a.length>0&&a[0].nodeType)for(s=0;s<a.length;s++)r.push(a[s]);return new e(r)};return e.prototype={addClass:function(e){if("undefined"==typeof e)return this;for(var a=e.split(" "),t=0;t<a.length;t++)for(var r=0;r<this.length;r++)this[r].classList.add(a[t]);return this},removeClass:function(e){for(var a=e.split(" "),t=0;t<a.length;t++)for(var r=0;r<this.length;r++)this[r].classList.remove(a[t]);return this},hasClass:function(e){return this[0]?this[0].classList.contains(e):!1},toggleClass:function(e){for(var a=e.split(" "),t=0;t<a.length;t++)for(var r=0;r<this.length;r++)this[r].classList.toggle(a[t]);return this},attr:function(e,a){if(1===arguments.length&&"string"==typeof e)return this[0]?this[0].getAttribute(e):void 0;for(var t=0;t<this.length;t++)if(2===arguments.length)this[t].setAttribute(e,a);else for(var r in e)this[t][r]=e[r],this[t].setAttribute(r,e[r]);return this},removeAttr:function(e){for(var a=0;a<this.length;a++)this[a].removeAttribute(e);return this},data:function(e,a){if("undefined"==typeof a){if(this[0]){var t=this[0].getAttribute("data-"+e);return t?t:this[0].dom7ElementDataStorage&&e in this[0].dom7ElementDataStorage?this[0].dom7ElementDataStorage[e]:void 0}return void 0}for(var r=0;r<this.length;r++){var s=this[r];s.dom7ElementDataStorage||(s.dom7ElementDataStorage={}),s.dom7ElementDataStorage[e]=a}return this},transform:function(e){for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransform=t.MsTransform=t.msTransform=t.MozTransform=t.OTransform=t.transform=e}return this},transition:function(e){"string"!=typeof e&&(e+="ms");for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransitionDuration=t.MsTransitionDuration=t.msTransitionDuration=t.MozTransitionDuration=t.OTransitionDuration=t.transitionDuration=e}return this},on:function(e,t,r,s){function i(e){var s=e.target;if(a(s).is(t))r.call(s,e);else for(var i=a(s).parents(),n=0;n<i.length;n++)a(i[n]).is(t)&&r.call(i[n],e)}var n,o,l=e.split(" ");for(n=0;n<this.length;n++)if("function"==typeof t||t===!1)for("function"==typeof t&&(r=arguments[1],s=arguments[2]||!1),o=0;o<l.length;o++)this[n].addEventListener(l[o],r,s);else for(o=0;o<l.length;o++)this[n].dom7LiveListeners||(this[n].dom7LiveListeners=[]),this[n].dom7LiveListeners.push({listener:r,liveListener:i}),this[n].addEventListener(l[o],i,s);return this},off:function(e,a,t,r){for(var s=e.split(" "),i=0;i<s.length;i++)for(var n=0;n<this.length;n++)if("function"==typeof a||a===!1)"function"==typeof a&&(t=arguments[1],r=arguments[2]||!1),this[n].removeEventListener(s[i],t,r);else if(this[n].dom7LiveListeners)for(var o=0;o<this[n].dom7LiveListeners.length;o++)this[n].dom7LiveListeners[o].listener===t&&this[n].removeEventListener(s[i],this[n].dom7LiveListeners[o].liveListener,r);return this},once:function(e,a,t,r){function s(n){t(n),i.off(e,a,s,r)}var i=this;"function"==typeof a&&(a=!1,t=arguments[1],r=arguments[2]),i.on(e,a,s,r)},trigger:function(e,a){for(var t=0;t<this.length;t++){var r;try{r=new window.CustomEvent(e,{detail:a,bubbles:!0,cancelable:!0})}catch(s){r=document.createEvent("Event"),r.initEvent(e,!0,!0),r.detail=a}this[t].dispatchEvent(r)}return this},transitionEnd:function(e){function a(i){if(i.target===this)for(e.call(this,i),t=0;t<r.length;t++)s.off(r[t],a)}var t,r=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],s=this;if(e)for(t=0;t<r.length;t++)s.on(r[t],a);return this},width:function(){return this[0]===window?window.innerWidth:this.length>0?parseFloat(this.css("width")):null},outerWidth:function(e){return this.length>0?e?this[0].offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this[0].offsetWidth:null},height:function(){return this[0]===window?window.innerHeight:this.length>0?parseFloat(this.css("height")):null},outerHeight:function(e){return this.length>0?e?this[0].offsetHeight+parseFloat(this.css("margin-top"))+parseFloat(this.css("margin-bottom")):this[0].offsetHeight:null},offset:function(){if(this.length>0){var e=this[0],a=e.getBoundingClientRect(),t=document.body,r=e.clientTop||t.clientTop||0,s=e.clientLeft||t.clientLeft||0,i=window.pageYOffset||e.scrollTop,n=window.pageXOffset||e.scrollLeft;return{top:a.top+i-r,left:a.left+n-s}}return null},css:function(e,a){var t;if(1===arguments.length){if("string"!=typeof e){for(t=0;t<this.length;t++)for(var r in e)this[t].style[r]=e[r]; return this}if(this[0])return window.getComputedStyle(this[0],null).getPropertyValue(e)}if(2===arguments.length&&"string"==typeof e){for(t=0;t<this.length;t++)this[t].style[e]=a;return this}return this},each:function(e){for(var a=0;a<this.length;a++)e.call(this[a],a,this[a]);return this},html:function(e){if("undefined"==typeof e)return this[0]?this[0].innerHTML:void 0;for(var a=0;a<this.length;a++)this[a].innerHTML=e;return this},is:function(t){if(!this[0])return!1;var r,s;if("string"==typeof t){var i=this[0];if(i===document)return t===document;if(i===window)return t===window;if(i.matches)return i.matches(t);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(t);if(i.mozMatchesSelector)return i.mozMatchesSelector(t);if(i.msMatchesSelector)return i.msMatchesSelector(t);for(r=a(t),s=0;s<r.length;s++)if(r[s]===this[0])return!0;return!1}if(t===document)return this[0]===document;if(t===window)return this[0]===window;if(t.nodeType||t instanceof e){for(r=t.nodeType?[t]:t,s=0;s<r.length;s++)if(r[s]===this[0])return!0;return!1}return!1},index:function(){if(this[0]){for(var e=this[0],a=0;null!==(e=e.previousSibling);)1===e.nodeType&&a++;return a}return void 0},eq:function(a){if("undefined"==typeof a)return this;var t,r=this.length;return a>r-1?new e([]):0>a?(t=r+a,new e(0>t?[]:[this[t]])):new e([this[a]])},append:function(a){var t,r;for(t=0;t<this.length;t++)if("string"==typeof a){var s=document.createElement("div");for(s.innerHTML=a;s.firstChild;)this[t].appendChild(s.firstChild)}else if(a instanceof e)for(r=0;r<a.length;r++)this[t].appendChild(a[r]);else this[t].appendChild(a);return this},prepend:function(a){var t,r;for(t=0;t<this.length;t++)if("string"==typeof a){var s=document.createElement("div");for(s.innerHTML=a,r=s.childNodes.length-1;r>=0;r--)this[t].insertBefore(s.childNodes[r],this[t].childNodes[0])}else if(a instanceof e)for(r=0;r<a.length;r++)this[t].insertBefore(a[r],this[t].childNodes[0]);else this[t].insertBefore(a,this[t].childNodes[0]);return this},insertBefore:function(e){for(var t=a(e),r=0;r<this.length;r++)if(1===t.length)t[0].parentNode.insertBefore(this[r],t[0]);else if(t.length>1)for(var s=0;s<t.length;s++)t[s].parentNode.insertBefore(this[r].cloneNode(!0),t[s])},insertAfter:function(e){for(var t=a(e),r=0;r<this.length;r++)if(1===t.length)t[0].parentNode.insertBefore(this[r],t[0].nextSibling);else if(t.length>1)for(var s=0;s<t.length;s++)t[s].parentNode.insertBefore(this[r].cloneNode(!0),t[s].nextSibling)},next:function(t){return new e(this.length>0?t?this[0].nextElementSibling&&a(this[0].nextElementSibling).is(t)?[this[0].nextElementSibling]:[]:this[0].nextElementSibling?[this[0].nextElementSibling]:[]:[])},nextAll:function(t){var r=[],s=this[0];if(!s)return new e([]);for(;s.nextElementSibling;){var i=s.nextElementSibling;t?a(i).is(t)&&r.push(i):r.push(i),s=i}return new e(r)},prev:function(t){return new e(this.length>0?t?this[0].previousElementSibling&&a(this[0].previousElementSibling).is(t)?[this[0].previousElementSibling]:[]:this[0].previousElementSibling?[this[0].previousElementSibling]:[]:[])},prevAll:function(t){var r=[],s=this[0];if(!s)return new e([]);for(;s.previousElementSibling;){var i=s.previousElementSibling;t?a(i).is(t)&&r.push(i):r.push(i),s=i}return new e(r)},parent:function(e){for(var t=[],r=0;r<this.length;r++)e?a(this[r].parentNode).is(e)&&t.push(this[r].parentNode):t.push(this[r].parentNode);return a(a.unique(t))},parents:function(e){for(var t=[],r=0;r<this.length;r++)for(var s=this[r].parentNode;s;)e?a(s).is(e)&&t.push(s):t.push(s),s=s.parentNode;return a(a.unique(t))},find:function(a){for(var t=[],r=0;r<this.length;r++)for(var s=this[r].querySelectorAll(a),i=0;i<s.length;i++)t.push(s[i]);return new e(t)},children:function(t){for(var r=[],s=0;s<this.length;s++)for(var i=this[s].childNodes,n=0;n<i.length;n++)t?1===i[n].nodeType&&a(i[n]).is(t)&&r.push(i[n]):1===i[n].nodeType&&r.push(i[n]);return new e(a.unique(r))},remove:function(){for(var e=0;e<this.length;e++)this[e].parentNode&&this[e].parentNode.removeChild(this[e]);return this},add:function(){var e,t,r=this;for(e=0;e<arguments.length;e++){var s=a(arguments[e]);for(t=0;t<s.length;t++)r[r.length]=s[t],r.length++}return r}},a.fn=e.prototype,a.unique=function(e){for(var a=[],t=0;t<e.length;t++)-1===a.indexOf(e[t])&&a.push(e[t]);return a},a}()),s=["jQuery","Zepto","Dom7"],i=0;i<s.length;i++)window[s[i]]&&e(window[s[i]]);var n;n="undefined"==typeof r?window.Dom7||window.Zepto||window.jQuery:r,n&&("transitionEnd"in n.fn||(n.fn.transitionEnd=function(e){function a(i){if(i.target===this)for(e.call(this,i),t=0;t<r.length;t++)s.off(r[t],a)}var t,r=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],s=this;if(e)for(t=0;t<r.length;t++)s.on(r[t],a);return this}),"transform"in n.fn||(n.fn.transform=function(e){for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransform=t.MsTransform=t.msTransform=t.MozTransform=t.OTransform=t.transform=e}return this}),"transition"in n.fn||(n.fn.transition=function(e){"string"!=typeof e&&(e+="ms");for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransitionDuration=t.MsTransitionDuration=t.msTransitionDuration=t.MozTransitionDuration=t.OTransitionDuration=t.transitionDuration=e}return this})),window.Swiper=t}(),"undefined"!=typeof module?module.exports=window.Swiper:"function"==typeof define&&define.amd&&define([],function(){"use strict";return window.Swiper}); (function(a) { var b = { numOfCol: 5, offsetX: 5, offsetY: 5, blockElement: "div" }; var c, d; var e = []; if (!Array.prototype.indexOf) { Array.prototype.indexOf = function(a) { var b = this.length >>> 0; var c = Number(arguments[1]) || 0; c = c < 0 ? Math.ceil(c) : Math.floor(c); if (c < 0) c += b; for (; c < b; c++) { if (c in this && this[c] === a) return c } return - 1 } } var f = function() { e = []; for (var a = 0; a < b.numOfCol; a++) { g("empty-" + a, a, 0, 1, -b.offsetY) } }; var g = function(a, c, d, f, g) { for (var h = 0; h < f; h++) { var i = new Object; i.x = c + h; i.size = f; i.endY = d + g + b.offsetY * 2; e.push(i) } }; var h = function(a, b) { for (var c = 0; c < b; c++) { var d = i(a + c, "x"); e.splice(d, 1) } }; var i = function(a, b) { for (var c = 0; c < e.length; c++) { var d = e[c]; if (b == "x" && d.x == a) { return c } else if (b == "endY" && d.endY == a) { return c } } }; var j = function(a, b) { var c = []; for (var d = 0; d < b; d++) { c.push(e[i(a + d, "x")].endY) } var f = Math.min.apply(Math, c); var g = Math.max.apply(Math, c); return [f, g, c.indexOf(f)] }; var k = function(a) { if (a > 1) { var b = e.length - a; var c = false; var d, f; for (var g = 0; g < e.length; g++) { var h = e[g]; var i = h.x; if (i >= 0 && i <= b) { var k = j(i, a); if (!c) { c = true; d = k; f = i } else { if (k[1] < d[1]) { d = k; f = i } } } } return [f, d[1]] } else { d = j(0, e.length); return [d[2], d[0]] } }; var l = function(a, c) { if (!a.data("size") || a.data("size") < 0) { a.data("size", 1) } else if (a.data("size") > b.numOfCol) { a.data("size", b.numOfCol) } var e = k(a.data("size")); var f = d * a.data("size") - (a.outerWidth() - a.width()); a.css({ width: f - b.offsetX * 2, left: e[0] * d, top: e[1], position: "absolute" }); var i = a.outerHeight(); h(e[0], a.data("size")); g(a.attr("id"), e[0], e[1], a.data("size"), i) }; a.fn.BlocksIt = function(g) { if (g && typeof g === "object") { a.extend(b, g) } c = a(this); d = c.width() / b.numOfCol; f(); c.children(b.blockElement).each(function(b) { l(a(this), b) }); var h = j(0, e.length); c.height(h[1] + b.offsetY); return this } })(jQuery); var baguetteBox = (function() { var leftArrow = '<svg width="40" height="60" xmlns="http://www.w3.org/2000/svg" version="1.1">' + '<polyline points="30 10 10 30 30 50" stroke="rgba(255,255,255,0.5)" stroke-width="4"' + 'stroke-linecap="butt" fill="none" stroke-linejoin="round">&lt;</polyline>' + '</svg>', rightArrow = '<svg width="40" height="60" xmlns="http://www.w3.org/2000/svg" version="1.1">' + '<polyline points="10 10 30 30 10 50" stroke="rgba(255,255,255,0.5)" stroke-width="4"' + 'stroke-linecap="butt" fill="none" stroke-linejoin="round">&gt;</polyline>' + '</svg>', closeX = '<svg width="30" height="30" xmlns="http://www.w3.org/2000/svg" version="1.1">' + '<g stroke="rgb(160, 160, 160)" stroke-width="4">' + '<line x1="5" y1="5" x2="25" y2="25"/>' + '<line x1="5" y1="25" x2="25" y2="5"/>' + 'X</g></svg>'; var overlayID = 'baguetteBox-overlay'; var sliderID = 'baguetteBox-slider'; var options = {}, defaults = { captions: true, buttons: 'auto', async: false, preload: 2, animation: 'slideIn' }; var overlay, slider, previousButton, nextButton, closeButton; var currentIndex = 0, currentGallery = -1; var touchStartX; var touchFlag = false; var galleries = []; var imagesMap = []; var imagesArray = []; if(!Array.prototype.forEach) { Array.prototype.forEach = function(callback, thisArg) { var len = this.length; for(var i = 0; i < len; i++) { callback.call(thisArg, this[i], i, this); } }; } function run(selector, userOptions) { buildOverlay(); galleries = document.querySelectorAll(selector); [].forEach.call( galleries, function (galleryElement, galleryIndex) { var galleryID = imagesMap.length; imagesMap.push(galleryElement.getElementsByTagName('a')); imagesMap[galleryID].options = userOptions; [].forEach.call( imagesMap[galleryID], function (imageElement, imageIndex) { bind(imageElement, 'click', function(event) { event.preventDefault ? event.preventDefault() : event.returnValue = false; prepareOverlay(galleryID); showOverlay(imageIndex); $("#"+sliderID).delegate("img","click",function(){ var thisimgurl = $(this).attr("src"); $("#imgurl_id").attr("src",thisimgurl); addDiv.addClass("visible").show(); $("body").undelegate("#imgurl_id,.custom-close","click").delegate("#imgurl_id,.custom-close","click",function(){ removediv(); }); function removediv(){ addDiv.removeClass("visible").hide(); } }); }); } ); } ); defaults.transforms = testTransformsSupport(); var addDiv = $('<div id="baguetteBox-overlay-add"><div id="baguetteBox-adddiv"><img id="imgurl_id" src="" /></div><span class="custom-close"></span></div>'); } function buildOverlay() { overlay = document.getElementById(overlayID); if(overlay) { slider = document.getElementById(sliderID); previousButton = document.getElementById('previous-button'); nextButton = document.getElementById('next-button'); closeButton = document.getElementById('close-button'); return; } overlay = document.createElement('div'); overlay.id = overlayID; document.getElementsByTagName('body')[0].appendChild(overlay); slider = document.createElement('div'); slider.id = sliderID; overlay.appendChild(slider); previousButton = document.createElement('button'); previousButton.id = 'previous-button'; previousButton.innerHTML = leftArrow; overlay.appendChild(previousButton); nextButton = document.createElement('button'); nextButton.id = 'next-button'; nextButton.innerHTML = rightArrow; overlay.appendChild(nextButton); closeButton = document.createElement('button'); closeButton.id = 'close-button'; closeButton.innerHTML = closeX; overlay.appendChild(closeButton); tipfd = document.createElement('div'); tipfd.id = 'tipfd-div'; tipfd.innerHTML = '单击图片看大图'; overlay.appendChild(tipfd); previousButton.className = nextButton.className = closeButton.className = 'baguetteBox-button'; bindEvents(); } function bindEvents() { bind(overlay, 'click', function(event) { if(event.target && event.target.nodeName !== "IMG") hideOverlay(); }); bind(document.getElementById('previous-button'), 'click', function(event) { event.stopPropagation ? event.stopPropagation() : event.cancelBubble = true; showPreviousImage(); }); bind(document.getElementById('next-button'), 'click', function(event) { event.stopPropagation ? event.stopPropagation() : event.cancelBubble = true; showNextImage(); }); bind(document.getElementById('close-button'), 'click', function(event) { event.stopPropagation ? event.stopPropagation() : event.cancelBubble = true; hideOverlay(); }); bind(overlay, 'touchstart', function(event) { touchStartX = event.changedTouches[0].pageX; }); bind(overlay, 'touchmove', function(event) { if(touchFlag) return; event.preventDefault ? event.preventDefault() : event.returnValue = false; touch = event.touches[0] || event.changedTouches[0]; if(touch.pageX - touchStartX > 40) { touchFlag = true; showPreviousImage(); } else if (touch.pageX - touchStartX < -40) { touchFlag = true; showNextImage(); } }); bind(overlay, 'touchend', function(event) { touchFlag = false; }); bind(document, 'keydown', function(event) { switch(event.keyCode) { case 37: showPreviousImage(); break; case 39: showNextImage(); break; case 27: hideOverlay(); break; } }); } function prepareOverlay(galleryIndex) { if(currentGallery === galleryIndex) return; currentGallery = galleryIndex; setOptions(imagesMap[galleryIndex].options); while(slider.firstChild) slider.removeChild(slider.firstChild); imagesArray.length = 0; for(var i = 0; i < imagesMap[galleryIndex].length; i++) { imagesArray.push(returnImageContainer()); slider.appendChild(imagesArray[i]); } } function setOptions(newOptions) { if(!newOptions) newOptions = {}; for(var item in defaults) { options[item] = defaults[item]; if(typeof newOptions[item] !== 'undefined') options[item] = newOptions[item]; } slider.style.transition = slider.style.webkitTransition = options.animation === 'fadeIn' ? 'opacity .4s ease' : ''; if(options.buttons === 'auto' && ('ontouchstart' in window || imagesMap[currentGallery].length === 1)) options.buttons = false; previousButton.style.display = nextButton.style.display = options.buttons ? '' : 'none'; } function returnImageContainer() { var fullImage = document.createElement('div'); fullImage.className = 'full-image'; return fullImage; } function showOverlay(index) { if(overlay.style.display === 'block') return; currentIndex = index; loadImage(currentIndex, function() { preloadNext(currentIndex); preloadPrev(currentIndex); }); updateOffset(); overlay.style.display = 'block'; setTimeout(function() { overlay.className = 'visible'; }, 50); } function hideOverlay() { if(overlay.style.display === 'none') return; overlay.className = ''; setTimeout(function() { overlay.style.display = 'none'; }, 500); } function loadImage(index, callback) { var imageContainer = imagesArray[index]; if(typeof imageContainer === 'undefined') return; if(imageContainer.getElementsByTagName('img')[0]) { if(callback) callback(); return; } imageElement = imagesMap[currentGallery][index]; imageCaption = imageElement.getAttribute('data-caption') || imageElement.title; imageSrc = getImageSrc(imageElement); var figure = document.createElement('figure'); var image = document.createElement('img'); var figcaption = document.createElement('figcaption'); imageContainer.appendChild(figure); figure.innerHTML = '<div class="spinner">' + '<div class="double-bounce1"></div>' + '<div class="double-bounce2"></div>' + '</div>'; image.onload = function() { var spinner = this.parentNode.querySelector('.spinner'); this.parentNode.removeChild(spinner); if(!options.async && callback) callback(); }; image.setAttribute('src', imageSrc); figure.appendChild(image); if(options.captions && imageCaption) { figcaption.innerHTML = imageCaption; figure.appendChild(figcaption); } if(options.async && callback) callback(); } function getImageSrc(image) { var result = imageElement.getAttribute('href'); if(image.dataset) { var srcs = []; for(var item in image.dataset) { if(item.substring(0, 3) === 'at-' && !isNaN(item.substring(3))) srcs[item.replace('at-', '')] = image.dataset[item]; } keys = Object.keys(srcs).sort(function(a, b) { return parseInt(a) < parseInt(b) ? -1 : 1; }); var width = window.innerWidth * window.devicePixelRatio; for(var i = 0; i < keys.length; i++) { if(keys[i] >= width) { result = srcs[keys[i]]; break; } result = srcs[keys[i]]; } } return result; } function showNextImage() { if(currentIndex <= imagesArray.length - 2) { currentIndex++; updateOffset(); preloadNext(currentIndex); } else { slider.className = 'bounce-from-right'; setTimeout(function() { slider.className = ''; }, 400); } } function showPreviousImage() { if(currentIndex >= 1) { currentIndex--; updateOffset(); preloadPrev(currentIndex); } else { slider.className = 'bounce-from-left'; setTimeout(function() { slider.className = ''; }, 400); } } function updateOffset() { var offset = -currentIndex * 100 + '%'; if(options.animation === 'fadeIn') { slider.style.opacity = 0; setTimeout(function() { options.transforms ? slider.style.transform = slider.style.webkitTransform = 'translate3d(' + offset + ',0,0)' : slider.style.left = offset; slider.style.opacity = 1; }, 400); } else { options.transforms ? slider.style.transform = slider.style.webkitTransform = 'translate3d(' + offset + ',0,0)' : slider.style.left = offset; } } function testTransformsSupport() { var div = document.createElement('div'), support = false; support = typeof div.style.perspective !== 'undefined' || typeof div.style.webkitPerspective !== 'undefined'; return support; } function preloadNext(index) { if(index - currentIndex >= options.preload) return; loadImage(index + 1, function() { preloadNext(index + 1); }); } function preloadPrev(index) { if(currentIndex - index >= options.preload) return; loadImage(index - 1, function() { preloadPrev(index - 1); }); } function bind(element, event, callback) { if(element.addEventListener) element.addEventListener(event, callback, false); else element.attachEvent('on' + event, callback); } return { run: run }; })();var ShareView = function(){ var shareViewInit = function(opt){ MasonryUtils.shareAndLike(); MasonryUtils.editBtn(); getCommentViewList(); if($("#goods").val()==1){ sliderboxInt(); goods(); tjcp_list(); }else{ $("#sharePicImgBox").find(".mod_01").setTagPos(); $("#sharedescbox").find(".imgtag").each(function(index, element) { $(this).setTagPos(); }); } if($("#masonry-tj").size()>0){ MasonryUtils.masonryInit({ masonry:"masonry-tj", islazy:1, callback:function(){ } }); } BaseInitClass.baseInit(); }; var tjcp_list = function(){ var geturl = $("#tjcp_list").attr("data-url"); AjaxFunUtils.ajaxInit({ url: geturl, type: "GET", dataType: 'html', params: {ajax:1}, callback: function(data){ if(!data){ $("#tjcp_list_box").hide(); return false; } $("#tjcp_list").append(data); $("#tjcp_list").find("img.lazy-mas").lazyload({ effect: "fadeIn", threshold : 100, failurelimit:20 }); } }); }; var sliderboxInt = function(){ setImgHeight(); function setImgHeight(){ var bodyH = getHeightBody(); var setH = bodyH*0.7; $("#sliderbox_view").css({"height":setH}); return setH; } $("#sliderbox_view").slidepic({ autoPlay:false, scrollContId:'slide_01_view', slide_01_dot:'slide_01_dot_view', imgwcallback:function(){ var sliderboxH = $("#sliderbox_view").height(); var sliderboxW = $("#sliderbox_view").width(); $("#sliderbox_view").find("img").each(function(index, element) { $(this).addClass("img_"+index); var ImgObj = new Image(); ImgObj.src = $(this).attr("src"); ImgObj.onload = function() { var thisModH = ImgObj.height; var thisModW = ImgObj.width; var bili = thisModW/thisModH; var left = 0; if(bili>=1){ thisModH = sliderboxH; thisModW = thisModH*bili; left = -(thisModW - sliderboxW)/2; }else{ thisModW = sliderboxW; thisModH = thisModW/bili; }; $(".img_"+index).css({"height":thisModH,"width":thisModW,"margin-left":left}); }; }); $("#viewPicImgBox").find(".mod_01").each(function(index, element) { $(this).setTagPos(); }); } }); baguetteBox.run('.baguetteBoxOne'); }; var getCommentViewList = function(){ var shareid = $("#CommentList").attr("data-shareid"); $("#CommentList").loadDataUtils({ url:"/comment/read.html", isPage:true, isdz:true, isOuto:false, isEmpty:true, num_display:0, params: { 'page': 1, 'pagenum':5,"ajax":1 ,'shid':shareid}, getDataHtmlCallback:function(index,o){ if(o.isme){ var reportAndDel = '<span class="fr shareBtn reportComment delCommentBtn" data-cmmid="'+o.cmmid+'" data-shid="'+o.shid+'"><em class="ico ico-delComment"></em></span>'; }else{ var reportAndDel = '<span class="fr shareBtn reportComment reportBtn" data-type="comment" data-cmmid="'+o.cmmid+'" data-shid="'+o.shid+'"><em class="ico ico-reportComment"></em></span>'; } var reuser = ''; if(o.fsuid > 0){ reuser = ' 回复 <span class="b color-blue btn-addpl" data-fsuid="'+o.fsuid+'" data-fuid_uname="'+o.fuid_uname+'">'+o.fuid_uname+'</span>'; } var commentTem = '<li class="rowbox">'+ '<a data-role="none" rel="external" href="/share/myshares.html?fsuid='+o.suid+'&ukey='+ukey+'"><div class="rowbox avatar useravatar_bg w30 mr-5 mt-5">'+ '<img class="userThumb avatar_loading" src="'+o.avatar[2]+'" data-original="'+o.avatar[1]+'">'+ '</div></a>'+ '<div class="row-flex1 avatar-text">'+ '<div class="commenterWrapper">'+ '<span class="b color-blue btn-addpl" data-fsuid="'+o.suid+'" data-fuid_uname="'+o.fname+'">'+o.fname+'</span>'+ ''+reuser+'<span class="color-999"> • '+o.edttime+'</span>'+ ''+reportAndDel+''+ '</div>'+ '<div class="shareDesc color-555">'+o.comment+'</div>'+ '</div>'+ '</div>'; return commentTem; }, callback:function(){ $(".reportComment").hover(function(){ $(this).addClass("current"); $(this).children(".buttonText").show(); },function(){ $(this).removeClass("current"); $(this).children(".buttonText").hide(); }); $("#CommentList").find("img.avatar_loading").checkImgExists(function(obj,imgurl){ var $myopj = obj; var myimgurl = imgurl; var $thisp = $myopj.parent(".useravatar_bg"); $thisp.css({"background": "url("+myimgurl+") no-repeat","background-size": "cover"}); }); commentBtnBind(); commentDel(); snsReport(); } }); }; var goods = function(){ getNum(); var price_stock = []; selectColor(); function selectColor(){ $(".viewSub").find("li").unbind("click").bind("click",function(){ var subVal = $(this).attr("data-sub"); var thistype = $(this).attr("data-type"); var tagid = $(this).attr("data-tagid"); var isbuy = $(this).attr("data-isbuy"); var iscurrent = $(this).hasClass("current"); if(iscurrent){ if(thistype == "color" || thistype == "size" || thistype =="crowd"){ }else{ $(this).removeClass("current"); $(this).siblings(".thisval").val(''); $(this).siblings(".thisval").attr("data-tagid",''); } }else{ $(this).addClass("current"); $(this).siblings("li").removeClass("current"); $(this).siblings(".thisval").val(subVal); $(this).siblings(".thisval").attr("data-tagid",tagid); } if(thistype == "color" || thistype == "size" || thistype =="crowd" ){ var $thisviewColor = $(this).parent(".viewSub"); $thisviewColor.checkboxFn({ checkbox:'hidden' }); } calculateprice(); if(thistype !="crowd"){ crowlist(); } }); } function crowlist(){ var thisprice = Math.ceil($("#thisprice").attr("data-price")); var val_2 = Math.ceil(thisprice *0.4); var val_3 = Math.ceil(thisprice *0.5); var val_4 = Math.ceil(thisprice *0.6); var crowli = '<li data-type="crowd" data-sub="2">'+val_2+'元</li>'+ '<li data-type="crowd" data-sub="3">'+val_3+'元</li>'+ '<li data-type="crowd" data-sub="4">'+val_4+'元</li>'+ '<input class="thisval" name="reward_rate" type="hidden" value="">'+ '<p class="blank0"></p>'; $("#crowd-list").html(crowli); selectColor(); } function calculateprice(){ var thisAddprice = 0; var currentNum = $("#other_attributes").find(".current").size(); if(currentNum > 0){ $("#goods_infor_text").show(); $("#goods_infor_numbox").hide(); }else{ $("#goods_infor_text").hide(); $("#goods_infor_numbox").show(); } $("#other_attributes").find(".current").each(function(index, element) { thisAddprice += Number($(this).attr("data-addprice")); }); var combinationId = $("#viewColor-list").find(".thisval").attr("data-tagid")+"_"+$("#viewSize-list").find(".thisval").attr("data-tagid"); if(price_stock[combinationId]){ thisAddprice +=Number(price_stock[combinationId][0]); $("#thisprice").html(exrtitle+thisAddprice.toFixed(2)); $("#thisprice").attr("data-price",thisAddprice.toFixed(2)); $("#goods_infor_num").html(price_stock[combinationId][1]); $("#maxNum").attr("data-max",price_stock[combinationId][1]); getNum(); if(price_stock[combinationId][1]<=0){ $("#add-zc-btn").addClass("btn-pri-gray"); $("#add-dz-btn").addClass("btn-pri-gray"); $("#isbuy").val(0); }else{ $("#add-zc-btn").removeClass("btn-pri-gray"); $("#add-dz-btn").removeClass("btn-pri-gray"); $("#isbuy").val(1); } }else{ var defprice = $("#thisprice").attr("data-defprice"); thisAddprice +=Number(defprice); $("#thisprice").html(exrtitle+thisAddprice.toFixed(2)); $("#thisprice").attr("data-price",thisAddprice.toFixed(2)); } }; var selectCustomBodydata = function(opt){ var actionurl = $("#privateForm").attr("data-action"); if(opt.type == 'crowd'){ actionurl = '/m_raise/goodsraise_adddo.html'; } var gdid = $("#privateForm").attr("data-gdid"); getBodyDataTip(); function getBodyDataTip(){ AjaxFunUtils.ajaxInit({ url: '/common/gettpl.html?name=b_bodydata&ch=buy', type: "GET", yzlogin:true, dataType: 'html', params: {gdid:gdid}, callback: function(data){ $("body").append(data); getBodyData({gdid:gdid}); addBodyData(); $("#b_privateFrom").checkInput({ buttonDiv:'#button_submit', validatetype:0, submitBtnFn: function (subfrom) { var subdataFrom = subfrom.serializeJson(); var pindata = $.extend(true,opt.dataFrom,subdataFrom); AjaxFunUtils.ajaxInit({url: actionurl, params:pindata, callback:function(res){ if(res.status){ var locationurl = '/myorder/mycart.html'; if(opt.type == 'crowd'){ locationurl = '/myorder/uni2pay.html?type=wxh5&orderid='+res.data.orderid; } window.location=locationurl; }else{ AlertUtils.tips({ htmlmsg:'<div style="padding:30px">' + res.msg+'</div>', type:0 }); }; } }) } }); } }); } function closeBodydata(){ var num = $("#b_bodydata_info").attr("data-index"); AlertUtils.centerDivClosed({ indexNum:num, indexTipDiv:$("#b_bodydata_info"), type:1 }); } function getBodyData(options){ var settings = { bdid:'', dataFrom:'', otype:'' }; if(options){ $.extend(settings,options); } AjaxFunUtils.ajaxInit({ url:'/myorder/body_data.html', params:{act:"list"}, callback:function(res){ if(res.status == 1){ var ophtml = ''; var defhtml = '<option value="">新增定制人</option>'; $.each(res.data,function(index,o){ var op = '<option value="'+o.bdid+'" selected="selected">'+o.title+'</option>'; ophtml +=op; }); $("#datanamelist").html(defhtml + ophtml); var thisobdid = $("#datanamelist").val(); getBodyDatainfo({bdid:thisobdid,dataFrom:settings.dataFrom,otype:settings.otype}); selectBody(); }else{ AlertUtils.tips({ type:0, htmlmsg:'<div style="padding:30px">' + res.msg+'</div>', scallback:function(){ closeBodydata({closeDiv:'b_private'}); } }); } } }); } function getBodyDatainfo(options){ var settings = { bdid:'', otype:'', dataFrom:'' }; if(options){ $.extend(settings,options); } var dataUrl = '/myorder/body_data.html'; var gdid = $("#privateForm").attr("data-gdid"); AjaxFunUtils.ajaxInit({ url: dataUrl, yzlogin:true, isloading:true, params: {gdid:gdid,act:"get",bdid:settings.bdid}, callback: function(res){ if(res.status){ $("#bodydatainfo").html(res.data).show(); $("#button_submit").show(); }else{ AlertUtils.tips({ w:350, htmlmsg:'<div style="padding:30px">' + res.msg+'</div>', type:0, scallback:function(){ $("#button_submit").hide(); } }); } var isbodyid = $("#bodyid").val(); if(!isbodyid){ $("#delbodydataBtn").hide(); } getbodyTX(); $("#delbodydataBtn").unbind("click").bind("click",function(){ var actionurl = "/myorder/body_data.html"; var deltype = $(this).attr("data-type"); var bdid = $(this).attr("data-bdid"); AjaxFunUtils.ajaxInit({url: actionurl, params:{bdid:bdid,act:deltype}, callback:function(res){ if(res.status == 1){ getBodyData({bdid:res.data.bdid,otype:1}); }else{ AlertUtils.tips({ w:350, htmlmsg:'<div style="padding:30px">' + res.msg+'</div>' }); } } }); }); $("#txlist").find("dd").unbind("click").bind("click",function(){ $(this).addClass("current"); $(this).siblings("dd").removeClass("current"); var thisVal = $(this).attr("data-val"); $(this).siblings("input").val(thisVal); }); if(!settings.otype){ AlertUtils.centerDiv({ "divId":"b_private", "type":1, callback:function(){} }); } } }); } function getbodyTX(){ $("#txlist").find("dd").each(function(index, element) { var thisval = $(this).attr("data-val"); var thiinval = $(this).siblings("input").val(); if(thisval == thiinval){ $(this).addClass("current"); $(this).siblings("dd").removeClass("current"); } }); } function selectBody(){ $("#datanamelist").change(function(){ var thisobdid = $(this).val(); getBodyDatainfo({bdid:thisobdid,otype:1}); }); } function addBodyData(){ $(".bodydataBtn").unbind("click").bind("click",function(){ var type = $(this).attr("data-type"); var thisval = ''; var gdid = $(this).attr("data-gdid"); if(type == 'edt'){ thisval = $("#datanamelist").val(); } $("#datanamelist").val(""); getBodyDatainfo({otype:1}); }); }; }; var timers = $("#timerbox").attr("data-times"); $("#timerbox").countdownUtils({ timers:timers, callback:function(){ } }); function getNum(){ var maxNum = $("#maxNum").attr("data-max"); if(!maxNum){ maxNum = 99999; } $(".buynum").plus({maxNum:maxNum}); } function isbodydata(){ var opval = $("#datanamelist").find("option").size(); if(opval<=0){ $("#edtbodydataBtn").hide(); }else{ $("#edtbodydataBtn").show(); } } function dataInt(){ $("#privateForm").find(".thisval").val(''); $(".color-list").find("li").removeClass('current'); $("#privateForm").find(".viewSub").removeClass('error_validate'); }; $(".btn-cuscom").unbind("click").bind("click",function(){ dataInt(); var type = $(this).attr("data-type"); var price_stock_str = $("#price_stock").val(); var price_stock_arr = price_stock_str.split("|"); var iszc = $(this).attr("data-iszc"); $.each(price_stock_arr,function(index,oooo){ if(oooo!=''){ var oooo_arr=oooo.split("_"); price_stock[oooo_arr[0]+"_"+oooo_arr[1]]= [oooo_arr[2],oooo_arr[3]]; } }); $("#crowd-box").hide(); $("#crowd-box-btn").hide(); $("#bargain-box").hide(); $("#bargain-box-btn").hide(); $("#buy-box-btn").hide(); $("#buy-box").hide(); if(type=='buy' || type=='addcart'){ $("#buy-box-btn").show(); $("#buy-box").show(); } if(type=='crowd'){ $("#crowd-box").show(); $("#crowd-box-btn").show(); crowlist(); $("#crow-des").unbind("click").bind("click",function(){ $(this).blur(); AlertUtils.centerDiv({ divId:'des_crowdtip', position:'fixed', istop:1, w:'100%', touchmove:1, callback:function(){ var thiscrowVal = $("#sub-des").val(); var thismobileVal = $("#sub-mobile").val(); $("#crow-des-tip").val(thiscrowVal); $("#crow-des-mobile").val(thismobileVal); $("#des_crowdform").checkInput({ validatetype:0, button:'#des-tip-btn', submitBtnFn: function (from) { var thiscrowVal = $("#crow-des-tip").val(); var thismobileVal = $("#crow-des-mobile").val(); $("#crow-des").val(thiscrowVal); $("#sub-des").val(thiscrowVal); $("#sub-mobile").val(thismobileVal); $("#crowd-textarea").checkboxFn({ checkbox:'text', chird:1 }); closeTip($("#des_crowdtip"),2); } }); } }); }); } if(type=='bargain'){ $("#bargain-box").show(); $("#bargain-box-btn").show(); $("#bargain-des").unbind("click").bind("click",function(){ $(this).blur(); AlertUtils.centerDiv({ divId:'des_bargaintip', position:'fixed', istop:1, w:'100%', touchmove:1, callback:function(){ var thiscrowVal = $("#sub-des").val(); var thismobileVal = $("#sub-mobile").val(); $("#bargain-des-tip").val(thiscrowVal); $("#bargain-des-mobile").val(thismobileVal); $("#des_bargainform").checkInput({ validatetype:0, button:'#des-bargain-btn', submitBtnFn: function (from) { var thiscrowVal = $("#bargain-des-tip").val(); var thismobileVal = $("#bargain-des-mobile").val(); $("#bargain-des").val(thiscrowVal); $("#sub-des").val(thiscrowVal); $("#sub-mobile").val(thismobileVal); $("#bargaind-textarea").checkboxFn({ checkbox:'text', chird:1 }); closeTip($("#des_bargaintip"),2); } }); } }); }); } $("#custom-list-modalMask").show(); $("#custom-list").show(); document.body.style.overflow='hidden'; addCartFun({type:type}); $('#custom-list-modalMask').bind("touchmove",function(e){ e.preventDefault(); }); event.stopPropagation(); var bodyH = getHeightBody()-110; $("#custom-cont").css({"height":bodyH}); $("#custom-list-modalMask,.custom-close").unbind("click").bind("click",function(){ $("#custom-list").hide(); $("#custom-list-modalMask").hide(); document.body.style.overflow='auto'; }); }); function addCartFun(opt){ $("#privateForm").checkInput({ validatetype:0, button:'.add-submit-btn', submitBtnFn: function (from) { var isbuy = $("#isbuy").val(); if(isbuy < 1){ return false; } var addflag = $("#viewColor-list").checkboxFn({ checkbox:'hidden' }); var sizeFlag = $("#viewSize-list").checkboxFn({ checkbox:'hidden' }); if(opt.type=='crowd'){ var crowdflag = $("#crowd-list").checkboxFn({ checkbox:'hidden' }); var crowdflag_des = $("#crowd-textarea").checkboxFn({ checkbox:'text', chird:1 }); if(!crowdflag){ return false; } if(!crowdflag_des){ return false; } } if(opt.type=='bargain'){ var bargainflag_des = $("#bargain-textarea").checkboxFn({ checkbox:'text', chird:1 }); if(!bargainflag_des){ return false; } } if(!addflag){ return false; } if(!sizeFlag){ return false; } var thissize = $("#viewSize-list").find(".thisval").val(); var subdataFrom = from.serializeJson(); if(thissize == "bodydata"){ selectCustomBodydata({dataFrom:subdataFrom,type:opt.type}); return; } var actionurl = $("#privateForm").attr("data-action"); if(opt.type == 'crowd'){ actionurl = '/m_raise/goodsraise_adddo.html'; } if(opt.type=='bargain'){ actionurl = '/m_cut/goodscut_adddo.html'; } var pindata = subdataFrom; Loading.loadInit({status:1}); AjaxFunUtils.ajaxInit({url: actionurl, params:pindata, callback:function(res){ if(res.status){ var locationurl = '/myorder/mycart.html'; if(opt.type == 'crowd'){ locationurl = '/m_raise/goodsraise.html?id='+res.data.id+'&js_first=1'; } if(opt.type == 'bargain'){ locationurl = '/m_cut/goodscut.html?id='+res.data.id+'&js_first=1'; } if(opt.type == 'addcart'){ if($("#cartItemnum").size() > 0){ GetCartTop.getCartInit(); } $("#custom-list-modalMask,#custom-list").hide(); Loading.loadInit({status:0}); }else{ window.location=locationurl; } }else{ AlertUtils.tips({ htmlmsg:'<div style="padding:30px">' + res.msg+'</div>', type:0 }); Loading.loadInit({status:0}); }; } }) } }); } }; return {shareViewInit:shareViewInit} }(); (function (factory) { if (typeof define === 'function' && define.amd) { define(['jquery'], factory); } else { factory(jQuery); } }(function ($, undefined) { 'use strict'; $.infinitescroll = function infscr(options, callback, element) { this.element = $(element); if (!this._create(options, callback)) { this.failed = true; } }; $.infinitescroll.defaults = { loading: { finished: undefined, finishedMsg: "<em>Congratulations, you've reached the end of the internet.</em>", img: '', msg: null, msgText: '<em>Loading the next set of posts...</em>', selector: null, speed: 'fast', start: undefined }, state: { isDuringAjax: false, isInvalidPage: false, isDestroyed: false, isDone: false, isPaused: false, isBeyondMaxPage: false, currPage: 1 }, debug: false, behavior: undefined, binder: $(window), nextSelector: 'div.navigation a:first', navSelector: 'div.navigation', contentSelector: null, extraScrollPx: 150, itemSelector: 'div.post', animate: false, pathParse: undefined, dataType: 'html', appendCallback: true, bufferPx: 40, errorCallback: function () { }, infid: 0, pixelsFromNavToBottom: undefined, path: undefined, prefill: false, maxPage: undefined }; $.infinitescroll.prototype = { _binding: function infscr_binding(binding) { var instance = this, opts = instance.options; opts.v = '2.0b2.120520'; if (!!opts.behavior && this['_binding_'+opts.behavior] !== undefined) { this['_binding_'+opts.behavior].call(this); return; } if (binding !== 'bind' && binding !== 'unbind') { this._debug('Binding value ' + binding + ' not valid'); return false; } if (binding === 'unbind') { (this.options.binder).unbind('smartscroll.infscr.' + instance.options.infid); } else { (this.options.binder)[binding]('smartscroll.infscr.' + instance.options.infid, function () { instance.scroll(); }); } this._debug('Binding', binding); }, _create: function infscr_create(options, callback) { var opts = $.extend(true, {}, $.infinitescroll.defaults, options); this.options = opts; var $window = $(window); var instance = this; if (!instance._validate(options)) { return false; } var path = $(opts.nextSelector).attr('href'); var ispage = $(this.element).find('.item').eq(0).attr("data-page"); if(ispage){ path = ispage; } if (!path) { this._debug('Navigation selector not found'); return false; } opts.path = opts.path || this._determinepath(path); opts.contentSelector = opts.contentSelector || this.element; opts.loading.selector = opts.loading.selector || opts.contentSelector; opts.loading.msg = opts.loading.msg || $('<div id="data-loading" class="rel data-loading" style="display:none"><div class="infscr-loading" id="infscr-loading" style="text-align:center"><img alt="Loading..." src="' + opts.loadingImg + '" /></div></div>"'); (new Image()).src = opts.loading.img; if(opts.pixelsFromNavToBottom === undefined) { opts.pixelsFromNavToBottom = $(document).height() - $(opts.navSelector).offset().top; console.log(opts.pixelsFromNavToBottom); this._debug('pixelsFromNavToBottom: ' + opts.pixelsFromNavToBottom); } var self = this; opts.loading.start = opts.loading.start || function() { $(opts.navSelector).hide(); opts.loading.selector.after(opts.loading.msg); opts.loading.msg.show(opts.loading.speed, $.proxy(function() { this.beginAjax(opts); }, self)); }; opts.loading.finished = opts.loading.finished || function() { if (!opts.state.isBeyondMaxPage) opts.loading.msg.fadeOut(opts.loading.speed); }; opts.callback = function(instance, data, url) { if (!!opts.behavior && instance['_callback_'+opts.behavior] !== undefined) { instance['_callback_'+opts.behavior].call($(opts.contentSelector)[0], data, url); } if (callback) { callback.call($(opts.contentSelector)[0], data, opts, url); } if (opts.prefill) { $window.bind('resize.infinite-scroll', instance._prefill); } }; if (options.debug) { if (Function.prototype.bind && (typeof console === 'object' || typeof console === 'function') && typeof console.log === 'object') { ['log','info','warn','error','assert','dir','clear','profile','profileEnd'] .forEach(function (method) { console[method] = this.call(console[method], console); }, Function.prototype.bind); } } this._setup(); if (opts.prefill) { this._prefill(); } return true; }, _prefill: function infscr_prefill() { var instance = this; var $window = $(window); function needsPrefill() { return ( $(instance.options.contentSelector).height() <= $window.height() ); } this._prefill = function() { if (needsPrefill()) { instance.scroll(); } $window.bind('resize.infinite-scroll', function() { if (needsPrefill()) { $window.unbind('resize.infinite-scroll'); instance.scroll(); } }); }; this._prefill(); }, _debug: function infscr_debug() { if (true !== this.options.debug) { return; } if (typeof console !== 'undefined' && typeof console.log === 'function') { if ((Array.prototype.slice.call(arguments)).length === 1 && typeof Array.prototype.slice.call(arguments)[0] === 'string') { console.log( (Array.prototype.slice.call(arguments)).toString() ); } else { console.log( Array.prototype.slice.call(arguments) ); } } else if (!Function.prototype.bind && typeof console !== 'undefined' && typeof console.log === 'object') { Function.prototype.call.call(console.log, console, Array.prototype.slice.call(arguments)); } }, _determinepath: function infscr_determinepath(path) { var opts = this.options; if (!!opts.behavior && this['_determinepath_'+opts.behavior] !== undefined) { return this['_determinepath_'+opts.behavior].call(this,path); } if (path.match(/^(.*?page=)\d(.*)/)) { path = path.match(/^(.*?page=)\d(.*)/).slice(1); return path; } if ($.isFunction(opts.pathParse)) { return [path]; } else { props.isInvalidPage = true; } this._debug('determinePath', path); return path; }, _error: function infscr_error(xhr) { var opts = this.options; if (!!opts.behavior && this['_error_'+opts.behavior] !== undefined) { this['_error_'+opts.behavior].call(this,xhr); return; } if (xhr !== 'destroy' && xhr !== 'end') { xhr = 'unknown'; } this._debug('Error', xhr); if (xhr === 'end' || opts.state.isBeyondMaxPage) { this._showdonemsg(); } opts.state.isDone = true; opts.state.currPage = 1; opts.state.isPaused = false; opts.state.isBeyondMaxPage = false; this._binding('unbind'); }, _loadcallback: function infscr_loadcallback(box, data, url) { var opts = this.options, callback = this.options.callback, result = (opts.state.isDone) ? 'done' : (!opts.appendCallback) ? 'no-append' : 'append', frag; if (!!opts.behavior && this['_loadcallback_'+opts.behavior] !== undefined) { this['_loadcallback_'+opts.behavior].call(this,box,data,url); return; } switch (result) { case 'done': this._showdonemsg(); return false; case 'no-append': if (opts.dataType === 'html') { data = '<div>' + data + '</div>'; data = $(data).find(opts.itemSelector); } if (data.length === 0) { return this._error('end'); } break; case 'append': var children = box.children(); if (children.length === 0) { return this._error('end'); } frag = document.createDocumentFragment(); while (box[0].firstChild) { frag.appendChild(box[0].firstChild); } this._debug('contentSelector', $(opts.contentSelector)[0]); $(opts.contentSelector)[0].appendChild(frag); data = children.get(); var ispagecz = $($(data).find(".item").prevObject[0]).attr("data-page"); if(opts.searchflag || ispagecz){ opts.desturl = ispagecz; } break; } opts.loading.finished.call($(opts.contentSelector)[0],opts); if (opts.animate) { var scrollTo = $(window).scrollTop() + $(opts.loading.msg).height() + opts.extraScrollPx + 'px'; $('html,body').animate({ scrollTop: scrollTo }, 800, function () { opts.state.isDuringAjax = false; }); } if (!opts.animate) { opts.state.isDuringAjax = false; } callback(this, data, url); if (opts.prefill) { this._prefill(); } }, _nearbottom: function infscr_nearbottom() { var opts = this.options, pixelsFromWindowBottomToBottom = 0 + $(document).height() - (opts.binder.scrollTop()) - $(window).height(); if (!!opts.behavior && this['_nearbottom_'+opts.behavior] !== undefined) { return this['_nearbottom_'+opts.behavior].call(this); } this._debug('math:', pixelsFromWindowBottomToBottom, opts.pixelsFromNavToBottom); return (pixelsFromWindowBottomToBottom/2 - opts.bufferPx < opts.pixelsFromNavToBottom); }, _pausing: function infscr_pausing(pause) { var opts = this.options; if (!!opts.behavior && this['_pausing_'+opts.behavior] !== undefined) { this['_pausing_'+opts.behavior].call(this,pause); return; } if (pause !== 'pause' && pause !== 'resume' && pause !== null) { this._debug('Invalid argument. Toggling pause value instead'); } pause = (pause && (pause === 'pause' || pause === 'resume')) ? pause : 'toggle'; switch (pause) { case 'pause': opts.state.isPaused = true; break; case 'resume': opts.state.isPaused = false; break; case 'toggle': opts.state.isPaused = !opts.state.isPaused; break; } this._debug('Paused', opts.state.isPaused); return false; }, _setup: function infscr_setup() { var opts = this.options; if (!!opts.behavior && this['_setup_'+opts.behavior] !== undefined) { this['_setup_'+opts.behavior].call(this); return; } this._binding('bind'); return false; }, _showdonemsg: function infscr_showdonemsg() { var opts = this.options; if (!!opts.behavior && this['_showdonemsg_'+opts.behavior] !== undefined) { this['_showdonemsg_'+opts.behavior].call(this); return; } opts.loading.msg .find('img') .hide() .parent() .find('div').html(opts.loading.finishedMsg).animate({ opacity: 1 }, 2000, function () { $(this).parent().fadeOut(opts.loading.speed); }); opts.errorCallback.call($(opts.contentSelector)[0],'done'); }, _validate: function infscr_validate(opts) { for (var key in opts) { if (key.indexOf && key.indexOf('Selector') > -1 && $(opts[key]).length === 0) { this._debug('Your ' + key + ' found no elements.'); return false; } } return true; }, bind: function infscr_bind() { this._binding('bind'); }, destroy: function infscr_destroy() { this.options.state.isDestroyed = true; this.options.loading.finished(); return this._error('destroy'); }, pause: function infscr_pause() { this._pausing('pause'); }, resume: function infscr_resume() { this._pausing('resume'); }, beginAjax: function infscr_ajax(opts) { var instance = this, path = opts.path, box, desturl, method, condition; opts.state.currPage++; if ( opts.maxPage !== undefined && opts.state.currPage > opts.maxPage ){ opts.state.isBeyondMaxPage = true; this.destroy(); return; } box = $(opts.contentSelector).is('table, tbody') ? $('<tbody/>') : $('<div/>'); if(opts.searchflag && opts.desturl){ desturl = opts.desturl; }else{ desturl = (typeof path === 'function') ? path(opts.state.currPage) : path.join(opts.state.currPage); } instance._debug('heading into ajax', desturl); method = (opts.dataType === 'html' || opts.dataType === 'json' ) ? opts.dataType : 'html+callback'; if (opts.appendCallback && opts.dataType === 'html') { method += '+callback'; } switch (method) { case 'html+callback': instance._debug('Using HTML via .load() method'); box.load(desturl + ' ' + opts.itemSelector, undefined, function infscr_ajax_callback(responseText) {instance._loadcallback(box, responseText, desturl);}); break; case 'html': instance._debug('Using ' + (method.toUpperCase()) + ' via $.ajax() method'); $.ajax({ url: desturl, dataType: opts.dataType, complete: function infscr_ajax_callback(jqXHR, textStatus) { condition = (typeof (jqXHR.isResolved) !== 'undefined') ? (jqXHR.isResolved()) : (textStatus === 'success' || textStatus === 'notmodified'); if (condition) { instance._loadcallback(box, jqXHR.responseText, desturl); } else { instance._error('end'); } } }); break; case 'json': instance._debug('Using ' + (method.toUpperCase()) + ' via $.ajax() method'); $.ajax({ dataType: 'json', type: 'GET', url: desturl, success: function (data, textStatus, jqXHR) { condition = (typeof (jqXHR.isResolved) !== 'undefined') ? (jqXHR.isResolved()) : (textStatus === 'success' || textStatus === 'notmodified'); if (opts.appendCallback) { if (opts.template !== undefined) { var theData = opts.template(data); box.append(theData); if (condition) { instance._loadcallback(box, theData); } else { instance._error('end'); } } else { instance._debug('template must be defined.'); instance._error('end'); } } else { if (condition) { instance._loadcallback(box, data, desturl); } else { instance._error('end'); } } }, error: function() { instance._debug('JSON ajax request failed.'); instance._error('end'); } }); break; } }, retrieve: function infscr_retrieve(pageNum) { pageNum = pageNum || null; var instance = this, opts = instance.options; if (!!opts.behavior && this['retrieve_'+opts.behavior] !== undefined) { this['retrieve_'+opts.behavior].call(this,pageNum); return; } if (opts.state.isDestroyed) { this._debug('Instance is destroyed'); return false; } opts.state.isDuringAjax = true; opts.loading.start.call($(opts.contentSelector)[0],opts); }, scroll: function infscr_scroll() { var opts = this.options, state = opts.state; if (!!opts.behavior && this['scroll_'+opts.behavior] !== undefined) { this['scroll_'+opts.behavior].call(this); return; } if (state.isDuringAjax || state.isInvalidPage || state.isDone || state.isDestroyed || state.isPaused) { return; } if (!this._nearbottom()) { return; } this.retrieve(); }, toggle: function infscr_toggle() { this._pausing(); }, unbind: function infscr_unbind() { this._binding('unbind'); }, update: function infscr_options(key) { if ($.isPlainObject(key)) { this.options = $.extend(true,this.options,key); } } }; $.fn.infinitescroll = function infscr_init(options, callback) { var thisCall = typeof options; switch (thisCall) { case 'string': var args = Array.prototype.slice.call(arguments, 1); this.each(function () { var instance = $.data(this, 'infinitescroll'); if (!instance) { return false; } if (!$.isFunction(instance[options]) || options.charAt(0) === '_') { return false; } instance[options].apply(instance, args); }); break; case 'object': this.each(function () { var instance = $.data(this, 'infinitescroll'); if (instance) { instance = new $.infinitescroll(options, callback, this); } else { instance = new $.infinitescroll(options, callback, this); if (!instance.failed) { $.data(this, 'infinitescroll', instance); } } }); break; } return this; }; var event = $.event, scrollTimeout; event.special.smartscroll = { setup: function () { $(this).bind('scroll', event.special.smartscroll.handler); }, teardown: function () { $(this).unbind('scroll', event.special.smartscroll.handler); }, handler: function (event, execAsap) { var context = this, args = arguments; event.type = 'smartscroll'; if (scrollTimeout) { clearTimeout(scrollTimeout); } scrollTimeout = setTimeout(function () { $(context).trigger('smartscroll', args); }, execAsap === 'execAsap' ? 0 : 100); } }; $.fn.smartscroll = function (fn) { return fn ? this.bind('smartscroll', fn) : this.trigger('smartscroll', ['execAsap']); }; }));!function(a,b,c,d){var e=a(b);a.fn.lazyload=function(f){function g(){var b=0;i.each(function(){var c=a(this);if(!j.skip_invisible||c.is(":visible"))if(a.abovethetop(this,j)||a.leftofbegin(this,j));else if(a.belowthefold(this,j)||a.rightoffold(this,j)){if(++b>j.failure_limit)return!1}else c.trigger("appear"),b=0})}var h,i=this,j={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:b,data_attribute:"original",skip_invisible:!1,appear:null,load:null,placeholder:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="};return f&&(d!==f.failurelimit&&(f.failure_limit=f.failurelimit,delete f.failurelimit),d!==f.effectspeed&&(f.effect_speed=f.effectspeed,delete f.effectspeed),a.extend(j,f)),h=j.container===d||j.container===b?e:a(j.container),0===j.event.indexOf("scroll")&&h.bind(j.event,function(){return g()}),this.each(function(){var b=this,c=a(b);b.loaded=!1,(c.attr("src")===d||c.attr("src")===!1)&&c.is("img")&&c.attr("src",j.placeholder),c.one("appear",function(){if(!this.loaded){if(j.appear){var d=i.length;j.appear.call(b,d,j)}a("<img />").bind("load",function(){var d=c.attr("data-"+j.data_attribute);c.hide(),c.is("img")?c.attr("src",d):c.css("background-image","url('"+d+"')"),c[j.effect](j.effect_speed),b.loaded=!0;var e=a.grep(i,function(a){return!a.loaded});if(i=a(e),j.load){var f=i.length;j.load.call(b,f,j)}}).attr("src",c.attr("data-"+j.data_attribute))}}),0!==j.event.indexOf("scroll")&&c.bind(j.event,function(){b.loaded||c.trigger("appear")})}),e.bind("resize",function(){g()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&e.bind("pageshow",function(b){b.originalEvent&&b.originalEvent.persisted&&i.each(function(){a(this).trigger("appear")})}),a(c).ready(function(){g()}),this},a.belowthefold=function(c,f){var g;return g=f.container===d||f.container===b?(b.innerHeight?b.innerHeight:e.height())+e.scrollTop():a(f.container).offset().top+a(f.container).height(),g<=a(c).offset().top-f.threshold},a.rightoffold=function(c,f){var g;return g=f.container===d||f.container===b?e.width()+e.scrollLeft():a(f.container).offset().left+a(f.container).width(),g<=a(c).offset().left-f.threshold},a.abovethetop=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollTop():a(f.container).offset().top,g>=a(c).offset().top+f.threshold+a(c).height()},a.leftofbegin=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollLeft():a(f.container).offset().left,g>=a(c).offset().left+f.threshold+a(c).width()},a.inviewport=function(b,c){return!(a.rightoffold(b,c)||a.leftofbegin(b,c)||a.belowthefold(b,c)||a.abovethetop(b,c))},a.extend(a.expr[":"],{"below-the-fold":function(b){return a.belowthefold(b,{threshold:0})},"above-the-top":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-screen":function(b){return a.rightoffold(b,{threshold:0})},"left-of-screen":function(b){return!a.rightoffold(b,{threshold:0})},"in-viewport":function(b){return a.inviewport(b,{threshold:0})},"above-the-fold":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-fold":function(b){return a.rightoffold(b,{threshold:0})},"left-of-fold":function(b){return!a.rightoffold(b,{threshold:0})}})}(jQuery,window,document);