define(["jquery"],function(e){var t=e("#text-in"),n=e("#control"),r=e("#send"),i=function(e){var n=t.val(),r=n.length;if(r){var i=r,s=n.substring(0,i),o=n.substr(i),u=s.replace(/(\[[^\[\]]+])$/g,"");u==s&&(u=s.substring(0,i-1)),u.length,t.val(u+o),t.trigger("change"),e&&t.scrollTop(1e4)}},s=function(e,n){if(e){var r=t.val(),i=r.length;if(!(i>=parseInt(t.attr("maxlength")))){var s=i,o=r.substring(0,s),u=r.substr(s),a=o+e;a.length,t.val(a+u),t.trigger("change"),n&&t.scrollTop(1e4)}}},o=function(){r.attr("data-type")=="share"?require(["comm/comments"],function(e){e.addComment(t.val()),t.val("")}):require(["ui/message"],function(e){e.ask(t.val()),t.val("")})};return r.click(o),t.on("keydown keyup change",function(e){13==e.keyCode&&(e.preventDefault(),o())}).on("focus blur",function(e){}),{delInput:i,addInput:s}});