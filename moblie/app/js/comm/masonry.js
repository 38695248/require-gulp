define(["jquery","config","pjax","infinitescroll","lazyload"],function(e,t,n){var r=function(t){var n=e("#pagecol").val(),r=e("#isseacrch").val(),s=e("#types").val(),o=e("#isfollow").val(),u={dataType:"html",appendjsonback:null};t&&e.extend(!0,u,t);if(n==1){var a="masonry";t.div&&(a=t.div),r==1?i({masonry:a,dataType:u.dataType,issearch:!0,islazy:0,callback:function(){o==1&&require(["comm/followBtn"],function(e){e.followBtn()}),t.callback&&t.callback()},appendjsonback:u.appendjsonback}):i({masonry:a,dataType:u.dataType,issearch:!1,islazy:0,callback:function(){o&&require(["comm/followBtn"],function(e){e.followBtn()}),t.callback&&t.callback()},appendjsonback:u.appendjsonback})}else{var a="masonry_2";t.div&&(a=t.div),r==1?i({masonry:a,dataType:u.dataType,issearch:!0,islazy:1,callback:function(){o==1&&require(["comm/followBtn"],function(e){e.followBtn()}),t.callback&&t.callback()},appendjsonback:u.appendjsonback}):i({masonry:a,dataType:u.dataType,issearch:!1,islazy:1,callback:function(){o==1&&require(["comm/followBtn"],function(e){e.followBtn()}),t.callback&&t.callback()},appendjsonback:u.appendjsonback})}},i=function(t){var r={masonry:"masonry",navSelector:".pager",nextSelector:".pager .pager-next a",itemSelector:".item",resize:!0,islazy:!0,ispage:!0,threshold:1e3,failurelimit:20,issearch:!1,skip_invisible:!1,pathParse:"",dataType:"html",appendjsonback:null,w:1,h:4,callback:null};t&&e.extend(r,t);var i=e("#"+r.masonry),s,o=i.find(".item"),u=o.length;if(u<=0)return!1;n.pjaxInt();var a=function(e){i.find("img.lazy-mas").lazyload({effect:"fadeIn",threshold:r.threshold,failurelimit:r.failurelimit})},f=function(){i.find("img.lazy-mas").lazyload({effect:"fadeIn",threshold:r.threshold,failurelimit:r.failurelimit})};r.islazy==1?a():f();if(r.ispage){var l=!1;r.issearch&&(l=!0),i.infinitescroll({navSelector:r.navSelector,nextSelector:r.nextSelector,itemSelector:r.itemSelector,donetext:'<p style="padding-top:15px">No more pages to load.</p>',loadingImg:static_url+"/moblie/images/loading.gif",dataType:r.dataType,loading:{finished:function(){e("#data-loading").animate({opacity:.8},2e3).fadeOut("normal")}},bufferPx:400,pixelsFromNavToBottom:50,searchflag:l,pathParse:r.pathParse,errorCallback:function(){jQuery("#data-loading").animate({opacity:.8},2e3).fadeOut("normal")}},function(n){if(t.dataType=="json")return r.appendjsonback(n),t.callback&&r.callback(),!0;r.islazy==1?e(n).each(function(t,n){t%2==0?i.find(".rightbox").append(e(this)):i.find(".leftbox").append(e(this)),e(this).find("img.lazy-mas").lazyload({threshold:r.threshold,failurelimit:r.failurelimit})}):(e(n).appendTo(i),e("img.avatar_lazy").checkImgExists(function(e,t){var n=e,r=t,i=n.parent(".useravatar_bg");i.css({background:"url("+r+") no-repeat","background-size":"cover"})}),f()),t.callback&&r.callback()})}};return{init:r,masonryInit:i}});