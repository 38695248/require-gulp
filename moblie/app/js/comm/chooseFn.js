define(["jquery","config","ajax","mas","comm/fixedTop","stopscroll"],function(e,t,n,r){var i=function(t){var r=e("#choose_btn").size();if(r<=0)return!1;var i=e("#choose-list-modalMask").size();i<=0?n.ajaxInit({url:"/m_buy/get_cats.html",params:{catids:t.catids,price:t.price},callback:function(t){if(t.status==1){var n=t.data.cats,r=t.data.price,i="";e.each(n,function(e,t){i+='<li id="li_catids_'+e+'" class="rowbox li_click" data-index="'+e+'" data-catids=""><div class="row-flex1">'+t.name+'</div><div id="catids_'+e+'" class="catids_text">不限</div><div class="ico ico-jt"></div></li>'});var u='<div id="choose-list-modalMask" class="modalMask" style="display:block; z-index: 9998;"></div><div id="choose-list" class="custom-list choose-list" style="display:block;"><div class="choose_heard"><div class="top_l"><span id="choose-close" class="ico ico-back-h choose-close" data-type="b"></span></div><div id="choose_sub_btn" class="top_r f16" data-type="b">确定</div><h2 class="text-center line40">筛选</h2></div><div id="choose_cont" class="choose_cont"><div id="choose_cont_b"><ul id="fenlei_div" class="jsbox">'+i+"</ul>"+'<ul class="jsbox">'+'<li id="li_catids_price" class="rowbox li_click" data-index="price" data-catids="" data-min_price="" data-max_price="">'+'<div class="row-flex1">价格'+"</div>"+'<div id="li_price_text" class="catids_text">不限</div>'+'<div class="ico ico-jt"></div>'+"</li>"+"</ul>"+"</div>"+'<div id="choose_cont_s"></div>'+"</div>"+'<div class="text-center mt-10"><button type="button" id="clear_btn" class="btn w100">清除选项</button></div>'+"</div>";e("body").append(u),i||e("#fenlei_div").hide(),o({cats:n,price:r}),s()}}}):e("#choose-list-modalMask,#choose-list").show(),e("#choose-list-modalMask").stopscroll({})},s=function(){var n=t.base.getHeightBody(),r=n-50;e("#choose_cont").css({height:r})},o=function(n){e("#choose-list-modalMask").unbind("click").bind("click",function(){e("#choose-list").hide(),e("#choose-list-modalMask").hide()}),e("#clear_btn").unbind("click").bind("click",function(){e("#choose_cont_b").find(".li_click").each(function(t,n){e(this).attr("data-catids",""),e(this).attr("data-min_price",""),e(this).attr("data-max_price",""),e(this).find(".catids_text").text("不限")}),e("#choose_dh").find(".dhpjax").each(function(t,n){var r=e(this).attr("data-durl");e(this).attr("data-url",r)})}),e("#choose-list").find(".li_click").unbind("click").bind("click",function(){var r=e(this).attr("data-index");if(r=="price"){var i="";e.each(n.price,function(e,t){i+='<li class="rowbox li_click_s" data-type="price" data-catid="'+t.min_price+"-"+t.max_price+'" data-min_price="'+t.min_price+'" data-max_price="'+t.max_price+'"><div class="row-flex1">'+t.min_price+" - "+t.max_price+'</div><i class="b_ico tick"></i></li>'});var s='<ul class="jsbox">'+i+"</ul>"}else{var i="";e.each(n.cats[r].son,function(e,t){i+='<li class="rowbox li_click_s" data-type="s_type" data-catid="'+t.catid+'" data-text="'+t.name+'"><div class="row-flex1">'+t.name+'</div><i class="b_ico tick"></i></li>'});var s='<ul class="jsbox">'+i+"</ul>"}e("#choose_cont_s").html(s),e("#choose_cont_b").hide(),e("#clear_btn").hide(),e("#choose_sub_btn").attr("data-type","s"),e("#choose_sub_btn").attr("data-index",r),e("#choose-close").attr("data-type","s"),e("#choose-close").attr("data-index",r);var o=0;if(r=="price"){var u=e("#li_price_text").html();e("#choose_cont_s").find(".li_click_s").each(function(t,n){var r=e(this).attr("data-catid");r==u&&e(this).addClass("current")})}else{var a=e(this).attr("data-catids");a=a.split("|"),e("#choose_cont_s").find(".li_click_s").each(function(t,n){var r=e(this).attr("data-catid"),i=e(this);e.each(a,function(e,t){r==t&&i.addClass("current")})}),o=a.length}e("#choose_cont_s").find(".li_click_s").unbind("click").bind("click",function(){var n=e(this).attr("data-type");if(n=="price"){var r=e(this).attr("data-max_price"),i=e(this).attr("data-min_price");e("#choose_cont_s").html("").show(),e("#choose_cont_b").show(),e("#clear_btn").show(),e("#li_catids_price").attr("data-min_price",i),e("#li_catids_price").attr("data-max_price",r),e("#li_price_text").text(i+"-"+r),e("#choose_sub_btn").attr("data-type","b"),e("#choose-close").attr("data-type","b")}else{var s=e(this).hasClass("current");s?(e(this).removeClass("current"),o-=1):o<=5?(e(this).addClass("current"),o+=1):t.tip.tips({htmlmsg:'<div style="padding:30px">最多只能选择5项</div>',type:0})}})}),e("#choose-close").unbind("click").bind("click",function(){var t=e(this).attr("data-type");t=="s"?(e("#choose_cont_s").html("").show(),e("#choose_cont_b").show(),e("#clear_btn").show(),e("#choose_sub_btn").attr("data-type","b"),e("#choose-close").attr("data-type","b")):(e("#choose-list").hide(),e("#choose-list-modalMask").hide())}),e("#choose_sub_btn").unbind("click").bind("click",function(){var t=e(this).attr("data-type");if(t=="s"){var n=e(this).attr("data-index"),i="",s="";e("#choose_cont_s").find(".li_click_s").each(function(t,n){var r=e(this).hasClass("current"),o=e(this).attr("data-catid"),u=e(this).attr("data-text");r&&(i+=o+"|",s+=u+",")}),s||(s="不限"),e("#choose_cont_s").html("").show(),e("#choose_cont_b").show(),e("#clear_btn").show(),e("#li_catids_"+n).attr("data-catids",i),e("#catids_"+n).text(s),e("#choose_sub_btn").attr("data-type","b"),e("#choose-close").attr("data-type","b")}else{var o="",u=e("#li_catids_price").attr("data-min_price"),a=e("#li_catids_price").attr("data-max_price");e("#choose_cont_b").find(".li_click").each(function(t,n){var r=e(this).attr("data-catids");o+=r}),e("#choose-list-modalMask,#choose-list").hide();var f=e("#li_price_text").text();!o&&f=="不限";var l=e("#choose_dh").find(".current").attr("data-durl")+"&catids_choose="+o+"&min_price_choose="+u+"&max_price_choose="+a+"&ajax=true";e("#choose_dh").find(".dhpjax").each(function(t,n){var r=e(this).attr("data-durl")+"&catids_choose="+o+"&min_price_choose="+u+"&max_price_choose="+a+"&ajax=true";e(this).attr("data-url",r)}),e.ajax({url:l,dataType:"html",beforeSend:function(t){e(window).unbind(".infscr");var n=e("#masonry_2").offset().top;e("#data-loading").remove(),e("#masonry_2").html('<div class="imgloading" style="height:180px; width:100%"></div>')},success:function(t){e("#masonry_2").html(t),r.masonryInit({masonry:"masonry_2",issearch:!0,islazy:1,callback:function(){}})}})}})};return{chooseInt:i}});