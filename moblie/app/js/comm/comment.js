define(["jquery","config"],function(e,t){var n=function(){e(".btn-addpl").unbind("click").bind("click",function(){event.stopPropagation();var n=e(this).attr("data-fsuid"),s=e(this).parents(".byshid").attr("data-shid"),o=e(this).parents(".byshid"),u=o.find(".pl-list"),a=o.find(".plnum"),f=Number(a.attr("data-plnum")),l=e(this).attr("data-fuid_uname");l?l="回复"+e(this).attr("data-fuid_uname"):l="亲，请输入您的评论内容",e("#sns_pltip").show(),e("#sns_pltip").find(".closeBtnHtml").unbind("click").bind("click",function(){e("#sns_pltip").hide()}),t.upcontainer({callback:function(){e("#sns_pltip").hide()}}),e("#myeditable").size()<=0&&editorInit(l),e("#myeditable").contents().find("#message").focus();var c=e("#sns_plform");r({addCommentForm:c,fsuid:n,shid:s,callback:function(){e("#sns_pltip").hide(),e("#meditortxt").val(""),e("#myeditable").contents().find("#message").html("&nbsp;"),f+=1,i({shareid:s,pl_list:u,pl_box:o,plnum:a,pl_num:f})}}),e(document).unbind("click").bind("click",function(t){var n=e(t.target);n.closest("#sns_pltip").length==0&&e("#sns_pltip").hide()})})},r=function(n){var r={addCommentForm:".addCommentForm",commentBtn:".commentBtn",shid:"",fsuid:"",callback:function(){}};n&&e.extend(r,n);var i=e(r.addCommentForm);i.checkInput({button:r.commentBtn,inputs:{comment:{isempty:[0],focusMsg:"",rightMsg:"",errorMsg:"valid"}},submitBtnFn:function(e){var s=e.serializeJson();s.shid=r.shid,s.shareid=r.shid,s.fsuid=r.fsuid,i.find(".btn-danger").removeClass("commentBtn").addClass("btn-danger-gray"),AjaxFunUtils.ajaxInit({url:"/comment/add_comment.html",yzlogin:!0,params:s,callback:function(e){i.find(".btn-danger").addClass("commentBtn").removeClass("btn-danger-gray"),e.status?(i.find("textarea").val(""),n.callback&&r.callback()):t.tip.tips({w:"96%",htmlmsg:'<div style="padding:30px">'+e.msg+"</div>"})}})}})},i=function(t){var r={shareid:"",plnum:"",pl_num:"",num:2,pl_list:"",pl_box:e(".test"),type:""};t&&e.extend(r,t),shareView&&(r.num=4),AjaxFunUtils.ajaxInit({url:"/comment/read.html",params:{page:1,pagenum:r.num,ajax:1,shid:r.shareid},callback:function(t){var i="",s='<li class="text-right mt-15"><p class="blank5"></p><a href="/share/sharepage.html?shid='+r.shareid+'" class="color-blue">查看所有更多评论</a></li>';shareView&&(s=""),e.each(t.data.rows,function(e,t){if(t.isme)var n='<span class="fr shareBtn reportComment delCommentBtn" data-cmmid="'+t.cmmid+'" data-shid="'+t.shid+'"><em class="ico ico-delComment"></em></span>';else var n='<span class="fr shareBtn reportComment reportBtn" data-type="comment" data-cmmid="'+t.cmmid+'" data-shid="'+t.shid+'"><em class="ico ico-reportComment"></em></span>';var r="";t.fsuid>0&&(r=' 回复 <span class="color-blue btn-addpl" data-fsuid="'+t.fsuid+'" data-fuid_uname="'+t.fuid_uname+'">'+t.fuid_uname+"</span>");var s='<li class="rowbox"><a href="/share/myshares.html?fsuid='+t.suid+"&ukey="+ukey+'"><div class="rowbox avatar useravatar_bg w30 mr-5 mt-5">'+'<img class="userThumb avatar_loading" src="'+t.avatar[2]+'" data-original="'+t.avatar[1]+'">'+"</div></a>"+'<div class="row-flex1 avatar-text">'+'<div class="commenterWrapper">'+'<span class="color-blue btn-addpl" data-fsuid="'+t.suid+'" data-fuid_uname="'+t.fname+'">'+t.fname+"</span>"+""+r+'<span class="color-999"> • '+t.edttime+"</span>"+""+n+""+"</div>"+'<div class="shareDesc color-555">'+t.comment+"</div>"+"</div>"+"</div>";i+=s}),r.pl_list.html(i+s),r.plnum.text(r.pl_num).attr("data-plnum",r.pl_num),r.pl_list.find("img.avatar_loading").checkImgExists(function(e,t){var n=e,r=t,i=n.parent(".useravatar_bg");i.css({background:"url("+r+") no-repeat","background-size":"cover"})}),n(),commentDel()}})};return{getcommentlist:i}});