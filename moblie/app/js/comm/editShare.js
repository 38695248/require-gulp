define(["jquery","config","ajax"],function(e,t,n){var r=function(r){var s={thisParent:"",shid:"",boradid:"",callback:function(){}};r&&e.extend(s,r);var o=window.location.href;n.ajaxInit({url:"/share/show_f_page.html?page=editShareTip&shid="+s.shid,type:"GET",isloading:!0,dataType:"html",params:{},callback:function(u){e("body").append(u),r.callback&&s.callback(),t.tip.centerDiv({divId:"editShareTipbox",type:1,callback:function(){e("#editShareFrom").checkInput({button:".editShareBtn",submitBtnFn:function(r,i){t.base.loadInit({status:1});var u=e(i).attr("data-type"),a=r.serializeJson();a.shid=s.shid;if(u=="del")var f="/share/del_pin.html";if(u=="edit")var f="/share/edit_pin.html";n.ajaxInit({url:f,params:a,callback:function(n){t.base.loadInit({status:0});if(n.status){var r=e("#editShareTipbox").attr("data-index");t.tip.centerDivClosed({indexTipDiv:e("#editShareTipbox"),indexNum:r,type:1}),t.tip.tips({htmlmsg:'<div style="padding:30px">'+n.msg+"</div>",type:0,scallback:function(){window.location.href=o}})}else t.tip.tips({type:0,htmlmsg:'<div style="padding:30px">'+n.msg+"</div>"}),t.base.loadInit({status:0})}})}})}}),i({boradid:s.boradid,ishid:s.ishid,shid:s.shid,ismjx:s.ismjx})}})},i=function(r){var i={boradid:"",share:"",ishid:"",shid:"",ismjx:0,maxNum:15};r&&e.extend(!0,i,r);var s=i.dataFrom,o=i.boradid,u=function(){n.ajaxInit({url:"/share/get_share_typename.html",callback:function(t){var n=t.data.rows,r="",i=0;e.each(n,function(e,t){var n='<li data-value="'+t.ucatid+'" class="boardprintitem">'+t.bname+"</li>";o==t.ucatid&&(i=e),r+=n}),e("#shareboard").find(".board_items").empty().append(r),e("#shareboard").selectUtils({deNum:i,isDef:!0,callback:function(){var t=e(".select_box").find(".select_analog");checkInputFun.initContext(t,checkInputFun.myIt),t.siblings("p").show(),checkInputFun.mycheckIn(t)}})}})};e("#description").unbind("input").bind("input",function(){var t=e(this).val().length,n=300-t;e("#descNum").text(n)}),e("#boardname").bind("input",function(){var r=e(this).val();r==""?(e(".creatbtn").unbind("click"),e(this).parents(".boardnamebox").siblings("button").removeClass("creatbtn")):(e(this).parents(".boardnamebox").siblings("button").addClass("creatbtn"),e(".creatbtn").unbind("click").bind("click",function(){$this=e(this);var r=e(this).siblings(".boardnamebox").find("#boardname").val();n.ajaxInit({url:"/share/add_share.html",params:{name:r},callback:function(n){n.status?e("#shareboard").find(".select_option").hide():t.tip.tips({htmlmsg:'<div style="padding:30px">'+n.msg+"</div>"})}})}))}),e("#bigcategoryBtn").unbind("click").bind("click",function(){function u(){e("#categorySub").unbind("click").bind("click",function(){var n=e("#categoryFrom").find("li.current").size();if(n<=0)e("#categoryText").html(lang.js_base_categorytext);else{var r="";e("#categoryFrom").find("li.current").each(function(t,n){var i=","+e(this).text();t==0&&(i=e(this).text()),r+=i}),e("#categoryText").html(r)}var i=e("#bigcategorybox").attr("data-index");t.tip.centerDivClosed({indexNum:i,indexTipDiv:e("#bigcategorybox"),type:0})}),e("#categoryFrom").undelegate("li.current","hover").delegate("li.current","hover",function(){e(this).toggleClass("hover")}),e("#categoryFrom").undelegate(".icoCurrent","click").delegate(".icoCurrent","click",function(){var t=e(this).attr("data-type");e(this).parent("li").removeClass("current"),e(this).parent("li").attr("data-isload",0);if(t==0){var n=e(this).parent("li").index();e("#smallDiv_"+n).remove()}}),e("#bigcategory").find("li").unbind("click").bind("click",function(){var t=e(this),r=t.attr("data-tagid"),i=t.attr("data-catid"),s=t.attr("data-attid"),o=t.attr("data-name"),u=t.attr("data-isload"),f=t.text(),l=t.index(),c=e(this).hasClass("current");c||a(t);if(u==0){var h=e("<div class='s_loadin_bg' style='position: relative;'></div>"),p=e("<div id='smallDiv_"+l+"' class='small_category' style='display:none'></div>");p.html(h),e("#sns_small_category").append(p),n.ajaxInit({url:"/share/show_f_page.html?page=sns_category_son&ch=sns",type:"GET",dataType:"html",params:{tagid:r,catid:i,attid:s,catname:f},callback:function(n){p.html(n).show(),t.attr("data-isload",1),e("#smallDiv_"+l).siblings(".small_category").hide(),e(".scategory").find("li").unbind("click").bind("click",function(){var t=e(this),n=e(this).hasClass("current");n||a(t)})},errCallback:function(){p.html("").hide(),t.attr("data-isload",1),e("#smallDiv_"+l).siblings(".small_category").hide()}})}else e("#smallDiv_"+l).siblings(".small_category").hide(),e("#smallDiv_"+l).show()})}function a(n){var r=n,s=e("#categoryFrom").find("li.current").size();s>=i.maxNum?t.tip.tips({htmlmsg:'<div style="padding:30px">'+lang.maxCategoryNum+"</div>",type:0}):f(r)}function f(t){var n=t,r=n.parent("ul");n.addClass("current hover"),n.find(".currentico").addClass("icoCurrent");var i="";r.find("li").each(function(t,n){var r=e(this).hasClass("current");if(r){var s=e(this).attr("data-tagid"),o=e(this).attr("data-catid"),u=e(this).attr("data-attid"),a=e(this).attr("data-name");if(o){var f=s+"|"+o+"|"+a+"_";i+=f}else if(u){var f=s+"|"+u+"|"+a+"_";i+=f}}}),n.siblings("input").val(i)}var r=e(this).parent(".select_box"),s=e("#bigcategorybox").size();if(s<=0)n.ajaxInit({url:"/share/show_f_page.html?page=sns_category&ch=sns",type:"GET",isloading:!0,dataType:"html",params:{},callback:function(n){e("body").append(n),t.tip.centerDiv({divId:"bigcategorybox",type:1,w:"95%"}),u()}});else{e("#bigcategorybox").show();var o=e("#bigcategorybox").attr("data-index");e("#modalMask_"+o).show(),u()}}),e("#shareFrom").checkInput({inputs:{Category:{isempty:[0],focusMsg:"",rightMsg:"",errorMsg:"valid"}},submitBtnFn:function(r){t.base.loadInit({status:1});var o=BaseInitClass.getQueryString("js_debug"),u=r.serializeJson(),a=e("#categoryFrom").serializeJson(),f=e.extend(!0,u,a),l=e("#upcontainer").attr("data-specialid"),c=e("#upcontainer").attr("data-gpid"),h="/share/add_pin.html";o&&(h="/share/add_pin.html?js_debug=1"),n.ajaxInit({url:h,params:{imgdata:s,board:f,share:i.share,shid:i.shid,ishid:i.ishid,special_id:l,gpid:c,is_mjx:i.ismjx},callback:function(n){o&&(alert(h),alert(n.status),alert(n.msg));if(n.status){t.base.loadInit({status:0});var r=e("#shareTipbox").attr("data-index");t.tip.centerDivClosed({indexNum:r,indexTipDiv:e("#shareTipbox"),type:1,w:600});var r=e("#bigcategorybox").attr("data-index");t.tip.centerDivClosed({indexNum:r,indexTipDiv:e("#bigcategorybox"),type:1});var s=n.data.shid,u=n.data.title,a=n.data.pic;shareSuccess({shid:s,share:i.share,title:u,pic:a})}else t.base.loadInit({status:0}),t.tip.tips({htmlmsg:'<div style="padding:30px">'+n.msg+"</div>"})}})}})};return{editShareInit:r}});