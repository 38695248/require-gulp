define(["jquery","config","ajax","comm/gzweixin","plugin/checkImgExists","lazyload"],function(e,t,n,r){var i=function(){if(e("#viewpage").size()<=0&&e("#index_ad").size()<=0){var t=e(".headerbox").height();e(".mainbox").css({"padding-top":t})}e("img.lazy,img.avatar_lazy").lazyload({effect:"fadeIn",threshold:500,failurelimit:100,skip_invisible:!1}),e("body").delegate(".back-btn","click",function(){window.history.back()}),e(".cartItemnum").size()>0&&a(),s(),c(),f(),u({topdiv:e("#topButton")}),r.gzweixin({}),l(),o()},s=function(){function t(t){var o=e('<div id="search-modalMask" class="modalMask" style="z-index:9996;display: block"></div>');e("body").append(o);var u="/common/gettpl.html?name=sns_searchinput&ch=sns";t.searchtype=="weixingroup"&&(u="/common/gettpl.html?name=sns_searchgroup&ch=sns"),n.ajaxInit({url:u,type:"GET",dataType:"html",params:{},callback:function(t){e("body").append(t);var o="goods";e("#searchinput").addClass("loaded"),e("#newsearchInt").focus(),e("#searchtyleval").val(o),r(),s(),i(),e("#qingkong_btn").unbind("click").bind("click",function(){n.ajaxInit({url:"/m_search/clearwords.html",params:"",callback:function(t){t.status==1&&(e("#searchTagbox").html(""),e("#qingkong_btn").hide())}})})}})}function r(){e("#s-input-tab-txt").unbind("click").bind("click",function(){var t=e("#J_TabNav").is(":hidden");t?e("#J_TabNav").show():e("#J_TabNav").hide()}),e("#s-input-tab-txt").find("li").unbind("click").bind("click",function(){var t=e(this).text(),n=e(this).attr("data-val");e("#s-input-val").text(t),e("#s-input-val").attr("data-type",n),e("#searchtyleval").val(n),s()})}function i(){e("#closeSearch,#search-modalMask").unbind("click").bind("click",function(){e("#searchinput").remove(),e("#search-modalMask").remove()})}function s(t){function s(){n.ajaxInit({url:"/m_search/getwordlists.html?t="+r+"&s="+i+"",params:{},callback:function(t){if(t.status){e("#searchTagbox").show();var n=t.data.keyword,s='<li class="li-title">历史记录</li>';i==""&&(s='<li class="li-title">历史记录</li>',e("#qingkong_btn").show()),e.each(n,function(e,t){s+='<li><a href="/m_search/search.html?t='+r+"&s="+encodeURIComponent(t.val)+'" data-val='+t.val+">"+t.val+"</a></li>"}),e("#searchTagbox").html(s)}else e("#searchTagbox").hide(),e("#qingkong_btn").hide()}})}var r=e("#searchtyleval").val(),i="";e("#newsearchInt").unbind("input").bind("input",function(){var t=e(this);r=e("#s-input-val").attr("data-type"),i=e.trim(t.val()),s()}),s()}e(".searchstart").unbind("focus").bind("focus",function(){var n=e(this).attr("data-placeholder"),r=e(this).attr("data-searchtype");t({placeholder:n,searchtype:r})}),e(".searchtop").unbind("click").bind("click",function(){var n=e(this).attr("data-placeholder"),r=e(this).attr("data-searchtype");t({placeholder:n,searchtype:r})})},o=function(){function n(e){var t=document.body.scrollTop,e=e||function(){};window.addEventListener("scroll",function(){var n=document.body.scrollTop,r=n-t;if(r===0)return!1;e(r>0?"down":"up"),t=n},!1)}var t=e("#carfooter").size()>0?1:0;n(function(n){var r=n;r=="up"?(e("#headerbox").show(),t||e("#footerbox").show()):r=="down"&&(t||e("#footerbox").hide(),e("#headerbox").hide())})},u=function(t){var n=t.topdiv;n.bind("click",function(){e("html,body").animate({scrollTop:0},100),n.hide()});var r=function(){return document.body.scrollTop+document.documentElement.scrollTop},i=function(e){navigator.appName=="Netscape"&&navigator.userAgent.toUpperCase().indexOf("CHROME")>0?document.body.scrollTop=e:document.documentElement.scrollTop=e};window.onscroll=function(){r()>0?n.fadeIn():n.fadeOut()}},a=function(){if(islogin==0)return e(".cartItemnum").hide(),!1;n.ajaxInit({url:"/myorder/getcart.html",params:{partdata:"goods"},callback:function(t){var n=t.data.itemnum;n>0?(e(".cartItemnum").html(n).show(),e(".cartItemnum").html(n).show()):(e(".cartItemnum").hide(),e(".cartItemnum").html(n).show())}})},f=function(){var t=e("#send").attr("data-suid");n.ajaxInit({url:"/message/getmsgnum.html",params:{suid:t},callback:function(t){t.status==1&&e(".infomore_num,.infomnum").text(t.data.num).show()}}),e(".infomore_btn").unbind("click").bind("click",function(){var t=e(this).parents(".top_r"),n=t.find(".infomore").is(":hidden");n?t.find(".infomore").show():t.find(".infomore").hide(),e(document).unbind("click").bind("click",function(n){var r=e(n.target);r.closest(e(".infomore_btn")).length==0&&t.find(".infomore").hide()})})},l=function(){if(urlfee_fromsuid&&urlfee_url){setTimeout(e,5e3);function e(){n.ajaxInit({url:"/mk_market/urlfee.html",params:{fromsuid:urlfee_fromsuid,url:urlfee_url},callback:function(e){}})}}},c=function(){e(".shareUpload").unbind("click").bind("click",function(){e("#addbox").show(),e("body").css({overflow:"hidden"}),e("#addbox_bg,#addbox_btn").unbind("click").bind("click",function(){e("#addbox").hide(),e("body").css({overflow:"auto"})})}),e(".add-share").unbind("click").bind("click",function(){var n=e(this).attr("data-ismjx"),r=t.loginCheck();if(!r)return!1;require(["up"],function(e){e.uploadInit({tip:!0,uptitle:"请选择1~5张图片上传",yzlogin:!0,container:"allcontainer",browse_button:"allpickfiles",drop_element:"allcontainer",isarray:!0,bucket:"share",isarray:!0,multi_selection:!0,auto_start:!0,fileNumLimit:5,callback:function(t){var r=t;e.successFun(r,{ismjx:n})},bcallback:function(){}})})})};return{init:i,getCartInit:a}});